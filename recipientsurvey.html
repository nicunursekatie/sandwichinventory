<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipient Organization Survey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .header-logo img {
            max-width: 120px;
            height: auto;
        }

        h1 {
            color: #236383;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 15px;
            line-height: 1.6;
        }

        .subtitle p {
            margin-bottom: 12px;
        }

        .subtitle strong {
            color: #236383;
            font-weight: 600;
        }

        .form-note {
            background: #f7fafc;
            padding: 12px 16px;
            border-radius: 6px;
            border-left: 3px solid #47B3CB;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }

        .section-header {
            color: #236383;
            font-size: 18px;
            font-weight: 600;
            margin-top: 35px;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #FBAD3F;
        }

        .section-header:first-of-type {
            margin-top: 0;
        }

        .footer {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .footer p {
            margin-bottom: 8px;
        }

        .footer a {
            color: #236383;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.hidden {
            display: none;
        }

        .hidden {
            display: none;
        }

        label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .helper-text {
            color: #718096;
            font-size: 13px;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #FBAD3F;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .checkbox-group,
        .radio-group {
            margin-top: 10px;
        }
        
        .radio-group.horizontal {
            display: flex;
            flex-direction: row;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }
        
        .form-row.address-row {
            grid-template-columns: 2fr 1fr 1fr;
        }

        .checkbox-item,
        .radio-item {
            margin-bottom: 10px;
        }

        .checkbox-item label,
        .radio-item label {
            font-weight: 400;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"],
        .radio-item input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .time-input {
            margin-left: 28px;
            margin-top: 8px;
            font-size: 14px;
        }

        .time-input.hidden {
            display: none;
        }

        .same-time-option {
            margin-bottom: 15px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #FBAD3F;
        }

        .same-time-option label {
            font-weight: 400;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .same-time-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .same-time-option .time-input {
            margin-left: 0;
        }

        button {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(35, 99, 131, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FBAD3F 0%, #236383 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-message h2 {
            color: #48bb78;
            margin-bottom: 10px;
        }

        .success-message.hidden {
            display: none;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .save-status {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .error-message.show {
            display: block;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            /* Stack all form rows on mobile */
            .form-row {
                display: block !important;
                margin-bottom: 0;
            }
            
            .form-row .form-group {
                margin-bottom: 20px !important;
            }
            
            .radio-group.horizontal {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="header-logo">
            <img src="sandwich logo.png" alt="The Sandwich Project Logo">
        </div>

        <h1>The Sandwich Project Recipient Survey</h1>
        <div class="subtitle">
            <p><strong>Why we're asking:</strong> This short survey helps us better understand the organizations we partner with.</p>

            <p><strong>What won't change:</strong> Your responses will not affect what we're currently providing or how we provide it.</p>

            <p><strong>Have more to share?</strong> Use the "Anything else we should know?" section at the end.</p>

            <p style="margin-top: 15px; color: #236383;">Your work is incredible and invaluable to your community, and we're honored to support your efforts.</p>
        </div>

        <div class="form-note">
            <strong>Estimated time:</strong> 5-7 minutes â€¢ <strong>*</strong> Required fields
        </div>

        <div class="error-message" id="errorMessage"></div>
        
        <div class="save-status" id="saveStatus" style="display: none;">
            <span>ðŸ’¾ Progress saved automatically</span>
        </div>

        <form id="surveyForm" action="https://script.google.com/macros/s/AKfycbzSeKM9FHQslxbmQmx4yZ9GwzbvCExJtX1f1QIjnQGh8J5DQZNiOfTlHpNffeNfPvDwwA/exec" method="POST">
            <h2 class="section-header">Contact Information</h2>
            
            <!-- Organization & Contact Info Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="orgName">Organization Name *</label>
                    <input type="text" id="orgName" name="orgName" required>
                </div>
                <div class="form-group">
                    <label for="contactName">Primary Contact Name *</label>
                    <input type="text" id="contactName" name="contactName" required>
                </div>
            </div>

            <!-- Email & Phone Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="contactEmail">Email *</label>
                    <input type="email" id="contactEmail" name="contactEmail" required>
                </div>
                <div class="form-group">
                    <label for="contactPhone">Phone Number *</label>
                    <input type="tel" id="contactPhone" name="contactPhone" required>
                </div>
            </div>

            <!-- Address Section -->
            <div class="form-group">
                <label for="streetAddress">Street Address *</label>
                <input type="text" id="streetAddress" name="streetAddress" placeholder="123 Main Street" required>
            </div>

            <div class="form-group">
                <label for="addressLine2">Address Line 2</label>
                <input type="text" id="addressLine2" name="addressLine2" placeholder="Apt, Suite, Building, etc. (Optional)">
            </div>

            <!-- City, State, Zip Row -->
            <div class="form-row address-row">
                <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" name="city" placeholder="Atlanta" required>
                </div>
                <div class="form-group">
                    <label for="state">State *</label>
                    <input type="text" id="state" name="state" placeholder="GA" required maxlength="2" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label for="zipCode">Zip Code *</label>
                    <input type="text" id="zipCode" name="zipCode" placeholder="30303" required pattern="[0-9]{5}" maxlength="5" inputmode="numeric">
                </div>
            </div>

            <!-- Backup Contact & Preferred Method Row -->
            <div class="form-row" style="margin-top: 30px;">
                <div class="form-group">
                    <label for="backupContactName">Backup Contact Name</label>
                    <input type="text" id="backupContactName" name="backupContactName" placeholder="Optional but recommended">
                </div>
                <div class="form-group">
                    <label for="backupContactInfo">Backup Contact Email/Phone</label>
                    <input type="text" id="backupContactInfo" name="backupContactInfo" placeholder="Email or phone number">
                </div>
            </div>

            <!-- Preferred Contact Method Row -->
            <div class="form-group">
                <label>Preferred Contact Method *</label>
                <div class="radio-group horizontal">
                    <label><input type="radio" name="contactMethod" value="Email" required> Email</label>
                    <label><input type="radio" name="contactMethod" value="Text"> Text</label>
                    <label><input type="radio" name="contactMethod" value="Phone"> Phone</label>
                </div>
            </div>

            <!-- Organization Profile -->
            <h2 class="section-header">Organization Profile</h2>
            
            <!-- Website & Social Media Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="website">Website</label>
                    <input type="text" id="website" name="website" placeholder="www.yourorganization.org">
                </div>
                <div class="form-group">
                    <label for="socialMedia">Social Media Handle</label>
                    <input type="text" id="socialMedia" name="socialMedia" placeholder="@yourorganization">
                </div>
            </div>

            <!-- Population & Service Area Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="populationFocus">Specific population focus?</label>
                    <input type="text" id="populationFocus" name="populationFocus" placeholder="E.g., youth, veterans, families">
                </div>
                <div class="form-group">
                    <label for="serviceArea">Service area *</label>
                    <input type="text" id="serviceArea" name="serviceArea" placeholder="E.g., Downtown Atlanta" required>
                </div>
            </div>

            <!-- Operations -->
            <h2 class="section-header">Operations</h2>
            
            <div class="form-group">
                <label>When do you serve meals to your community? *</label>
                <p class="helper-text">Choose how you'd like to provide this information</p>

                <div class="radio-group horizontal" style="margin-bottom: 15px;">
                    <label><input type="radio" name="feedingInputType" value="structured" checked> Select days & times</label>
                    <label><input type="radio" name="feedingInputType" value="text"> Write my answer</label>
                </div>

                <div id="feedingStructured">
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Monday" name="feedingDays" value="Monday"> Monday</label>
                            <div class="time-inputs hidden" id="feedingMonday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingMondayStart" placeholder="Start">
                                <input type="time" name="feedingMondayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Tuesday" name="feedingDays" value="Tuesday"> Tuesday</label>
                            <div class="time-inputs hidden" id="feedingTuesday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingTuesdayStart" placeholder="Start">
                                <input type="time" name="feedingTuesdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Wednesday" name="feedingDays" value="Wednesday"> Wednesday</label>
                            <div class="time-inputs hidden" id="feedingWednesday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingWednesdayStart" placeholder="Start">
                                <input type="time" name="feedingWednesdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Thursday" name="feedingDays" value="Thursday"> Thursday</label>
                            <div class="time-inputs hidden" id="feedingThursday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingThursdayStart" placeholder="Start">
                                <input type="time" name="feedingThursdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Friday" name="feedingDays" value="Friday"> Friday</label>
                            <div class="time-inputs hidden" id="feedingFriday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingFridayStart" placeholder="Start">
                                <input type="time" name="feedingFridayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Saturday" name="feedingDays" value="Saturday"> Saturday</label>
                            <div class="time-inputs hidden" id="feedingSaturday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingSaturdayStart" placeholder="Start">
                                <input type="time" name="feedingSaturdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Sunday" name="feedingDays" value="Sunday"> Sunday</label>
                            <div class="time-inputs hidden" id="feedingSunday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="feedingSundayStart" placeholder="Start">
                                <input type="time" name="feedingSundayEnd" placeholder="End">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="feedingText" class="hidden">
                    <textarea id="feedingScheduleText" name="feedingScheduleText" placeholder="E.g., Monday-Friday 12pm-2pm, or Tuesdays and Thursdays 11am, or Varies by week" rows="3"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>What day(s) and time(s) can you accept food donations? *</label>
                <p class="helper-text">Choose how you'd like to provide this information</p>

                <div class="radio-group horizontal" style="margin-bottom: 15px;">
                    <label><input type="radio" name="donationInputType" value="structured" checked> Select days & times</label>
                    <label><input type="radio" name="donationInputType" value="text"> Write my answer</label>
                </div>

                <div id="donationStructured">
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Monday" name="donationDays" value="Monday"> Monday</label>
                            <div class="time-inputs hidden" id="donationMonday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationMondayStart" placeholder="Start">
                                <input type="time" name="donationMondayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Tuesday" name="donationDays" value="Tuesday"> Tuesday</label>
                            <div class="time-inputs hidden" id="donationTuesday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationTuesdayStart" placeholder="Start">
                                <input type="time" name="donationTuesdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Wednesday" name="donationDays" value="Wednesday"> Wednesday</label>
                            <div class="time-inputs hidden" id="donationWednesday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationWednesdayStart" placeholder="Start">
                                <input type="time" name="donationWednesdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Thursday" name="donationDays" value="Thursday"> Thursday</label>
                            <div class="time-inputs hidden" id="donationThursday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationThursdayStart" placeholder="Start">
                                <input type="time" name="donationThursdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Friday" name="donationDays" value="Friday"> Friday</label>
                            <div class="time-inputs hidden" id="donationFriday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationFridayStart" placeholder="Start">
                                <input type="time" name="donationFridayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Saturday" name="donationDays" value="Saturday"> Saturday</label>
                            <div class="time-inputs hidden" id="donationSaturday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationSaturdayStart" placeholder="Start">
                                <input type="time" name="donationSaturdayEnd" placeholder="End">
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" class="day-checkbox" data-day="Sunday" name="donationDays" value="Sunday"> Sunday</label>
                            <div class="time-inputs hidden" id="donationSunday" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-left: 28px; margin-top: 8px;">
                                <input type="time" name="donationSundayStart" placeholder="Start">
                                <input type="time" name="donationSundayEnd" placeholder="End">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="donationText" class="hidden">
                    <textarea id="donationScheduleText" name="donationScheduleText" placeholder="E.g., Anytime Monday-Friday 9am-5pm, or by appointment only, or Tuesdays before 10am" rows="3"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>What's the average number of people you serve? *</label>
                <p class="helper-text">Provide whichever statistic you track (daily, weekly, or monthly average).</p>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <input type="number" id="peopleCount" name="peopleCount" min="1" placeholder="Enter number" required style="flex: 0 0 150px; margin-bottom: 0;">
                    <div class="radio-group" style="margin-top: 0; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="countFrequency" value="Per Day" required> Per Day</label>
                        </div>
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="countFrequency" value="Per Week"> Per Week</label>
                        </div>
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="countFrequency" value="Per Month"> Per Month</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dietary & Preferences -->
            <h2 class="section-header">Food Preferences</h2>
            
            <div class="form-group">
                <label for="sandwichRestrictions">Are there any types of sandwiches you cannot serve?</label>
                <p class="helper-text">For example: dietary restrictions, allergies, religious/cultural considerations, etc.</p>
                <textarea id="sandwichRestrictions" name="sandwichRestrictions" placeholder="E.g., No pork for religious reasons, no nuts due to allergies (Leave blank if none)" rows="2"></textarea>
            </div>

            <div class="form-group hidden" id="restrictionReasonGroup">
                <label for="restrictionReason">Can you tell us why? (Optional)</label>
                <p class="helper-text">This helps us understand and plan better for future partnerships.</p>
                <textarea id="restrictionReason" name="restrictionReason" placeholder="E.g., Religious dietary laws, allergy concerns in our facility, cultural preferences of our community, etc." rows="2"></textarea>
            </div>

            <!-- Open Feedback -->
            <div class="form-group">
                <label for="additionalInfo">Anything else we should know?</label>
                <textarea id="additionalInfo" name="additionalInfo" placeholder="Optional"></textarea>
            </div>

            <button type="submit" id="submitBtn">Submit Survey</button>
        </form>

        <div class="success-message hidden" id="successMessage">
            <h2>âœ“ Thank you!</h2>
            <p style="margin-bottom: 10px;">Your responses have been submitted successfully.</p>
            <p style="font-size: 14px; color: #666;">We'll review your information and may reach out if we have any questions. If you need to make changes or have additional information to share, please email us directly.</p>
        </div>

        <div class="footer">
            <p><strong>Questions?</strong></p>
            <p>Email us at <a href="mailto:info@sandwichproject.org">info@sandwichproject.org</a></p>
            <p style="margin-top: 12px; font-size: 13px; color: #999;">Â© 2025 The Sandwich Project</p>
        </div>
    </div>

    <script>
        // Auto-save functionality
        const SAVE_KEY = 'sandwich_recipient_survey_progress';
        const saveStatus = document.getElementById('saveStatus');
        let saveTimeout;
        
        function saveFormProgress() {
            const form = document.getElementById('surveyForm');
            const formData = new FormData(form);
            const data = {};
            
            // Collect all form data
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Handle multiple values (like checkboxes)
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }
            
            // Save to localStorage
            localStorage.setItem(SAVE_KEY, JSON.stringify(data));
            
            // Show save indicator
            saveStatus.style.display = 'block';
            setTimeout(() => {
                saveStatus.style.display = 'none';
            }, 2000);
        }
        
        function restoreFormProgress() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                const form = document.getElementById('surveyForm');
                
                // Restore form fields
                Object.keys(data).forEach(key => {
                    const element = form.querySelector(`[name="${key}"]`);
                    if (element) {
                        if (element.type === 'checkbox' || element.type === 'radio') {
                            // Handle checkboxes and radio buttons
                            const values = Array.isArray(data[key]) ? data[key] : [data[key]];
                            values.forEach(value => {
                                const checkbox = form.querySelector(`[name="${key}"][value="${value}"]`);
                                if (checkbox) checkbox.checked = true;
                            });
                        } else {
                            // Handle text inputs, textareas, selects
                            element.value = Array.isArray(data[key]) ? data[key][0] : data[key];
                        }
                    }
                });
                
                // Show restoration message
                const restoreMessage = document.createElement('div');
                restoreMessage.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;';
                restoreMessage.innerHTML = 'ðŸ”„ Your previous progress has been restored. You can continue where you left off!';
                form.parentNode.insertBefore(restoreMessage, form);
                
                // Remove message after 5 seconds
                setTimeout(() => {
                    restoreMessage.remove();
                }, 5000);
                
            } catch (error) {
                console.error('Error restoring form progress:', error);
            }
        }
        
        function clearSavedProgress() {
            localStorage.removeItem(SAVE_KEY);
        }
        
        // Auto-save on form input (with debouncing)
        function setupAutoSave() {
            const form = document.getElementById('surveyForm');
            
            form.addEventListener('input', () => {
                // Clear existing timeout
                if (saveTimeout) {
                    clearTimeout(saveTimeout);
                }
                
                // Set new timeout (save after 2 seconds of no activity)
                saveTimeout = setTimeout(() => {
                    saveFormProgress();
                }, 2000);
            });
            
            form.addEventListener('change', () => {
                // Save immediately on dropdown/checkbox changes
                saveFormProgress();
            });
        }
        
        // Initialize auto-save and restore on page load
        setupAutoSave();
        restoreFormProgress();

        // Auto-capitalize contact name and organization name
        function toTitleCase(str) {
            return str.replace(/\w\S*/g, function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        }

        const orgNameField = document.getElementById('orgName');
        const contactNameField = document.getElementById('contactName');

        orgNameField.addEventListener('blur', function() {
            if (this.value.trim()) {
                this.value = toTitleCase(this.value);
            }
        });

        contactNameField.addEventListener('blur', function() {
            if (this.value.trim()) {
                this.value = toTitleCase(this.value);
            }
        });

        // Toggle between structured and text input for feeding schedule
        const feedingInputTypeRadios = document.querySelectorAll('input[name="feedingInputType"]');
        const feedingStructured = document.getElementById('feedingStructured');
        const feedingText = document.getElementById('feedingText');

        feedingInputTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'structured') {
                    feedingStructured.classList.remove('hidden');
                    feedingText.classList.add('hidden');
                } else {
                    feedingStructured.classList.add('hidden');
                    feedingText.classList.remove('hidden');
                }
            });
        });

        // Toggle between structured and text input for donation schedule
        const donationInputTypeRadios = document.querySelectorAll('input[name="donationInputType"]');
        const donationStructured = document.getElementById('donationStructured');
        const donationText = document.getElementById('donationText');

        donationInputTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'structured') {
                    donationStructured.classList.remove('hidden');
                    donationText.classList.add('hidden');
                } else {
                    donationStructured.classList.add('hidden');
                    donationText.classList.remove('hidden');
                }
            });
        });

        // Show/hide time pickers when day checkboxes are checked
        document.querySelectorAll('#feedingStructured .day-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const day = this.getAttribute('data-day');
                const timeInputs = document.getElementById('feeding' + day);
                if (this.checked) {
                    timeInputs.classList.remove('hidden');
                } else {
                    timeInputs.classList.add('hidden');
                    // Clear time values when unchecked
                    timeInputs.querySelectorAll('input[type="time"]').forEach(input => input.value = '');
                }
            });
        });

        document.querySelectorAll('#donationStructured .day-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const day = this.getAttribute('data-day');
                const timeInputs = document.getElementById('donation' + day);
                if (this.checked) {
                    timeInputs.classList.remove('hidden');
                } else {
                    timeInputs.classList.add('hidden');
                    // Clear time values when unchecked
                    timeInputs.querySelectorAll('input[type="time"]').forEach(input => input.value = '');
                }
            });
        });

        // Show/hide "why" field when restrictions are mentioned
        const sandwichRestrictions = document.getElementById('sandwichRestrictions');
        const restrictionReasonGroup = document.getElementById('restrictionReasonGroup');
        const restrictionReason = document.getElementById('restrictionReason');

        sandwichRestrictions.addEventListener('input', function() {
            if (this.value.trim() !== '') {
                restrictionReasonGroup.classList.remove('hidden');
            } else {
                restrictionReasonGroup.classList.add('hidden');
                restrictionReason.value = '';
            }
        });

        // Progress bar
        const form = document.getElementById('surveyForm');
        const progressFill = document.getElementById('progressFill');
        const allInputs = form.querySelectorAll('input, select, textarea');

        function updateProgress() {
            const requiredInputs = Array.from(allInputs).filter(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    return input.required || input.name === 'feedingDays' || input.name === 'donationDays';
                }
                return input.required;
            });

            const filledInputs = requiredInputs.filter(input => {
                if (input.type === 'checkbox') {
                    const checkboxGroup = document.querySelectorAll(`input[name="${input.name}"]`);
                    return Array.from(checkboxGroup).some(cb => cb.checked);
                }
                if (input.type === 'radio') {
                    return document.querySelector(`input[name="${input.name}"]:checked`) !== null;
                }
                return input.value.trim() !== '';
            });

            const uniqueRequired = new Set();
            requiredInputs.forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    uniqueRequired.add(input.name);
                } else {
                    uniqueRequired.add(input.id);
                }
            });

            const uniqueFilled = new Set();
            filledInputs.forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    uniqueFilled.add(input.name);
                } else {
                    uniqueFilled.add(input.id);
                }
            });

            const progress = (uniqueFilled.size / uniqueRequired.size) * 100;
            progressFill.style.width = progress + '%';
        }

        allInputs.forEach(input => {
            input.addEventListener('change', updateProgress);
            input.addEventListener('input', updateProgress);
        });

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');

            // Validate feeding schedule
            const feedingInputType = document.querySelector('input[name="feedingInputType"]:checked').value;
            if (feedingInputType === 'structured') {
                const feedingDaysChecked = document.querySelectorAll('input[name="feedingDays"]:checked').length > 0;
                if (!feedingDaysChecked) {
                    errorMessage.textContent = 'Please select at least one day for when you serve meals.';
                    errorMessage.classList.add('show');
                    return;
                }
            } else {
                const feedingTextValue = document.getElementById('feedingScheduleText').value.trim();
                if (!feedingTextValue) {
                    errorMessage.textContent = 'Please describe when you serve meals.';
                    errorMessage.classList.add('show');
                    return;
                }
            }

            // Validate donation schedule
            const donationInputType = document.querySelector('input[name="donationInputType"]:checked').value;
            if (donationInputType === 'structured') {
                const donationDaysChecked = document.querySelectorAll('input[name="donationDays"]:checked').length > 0;
                if (!donationDaysChecked) {
                    errorMessage.textContent = 'Please select at least one day for when you can accept donations.';
                    errorMessage.classList.add('show');
                    return;
                }
            } else {
                const donationTextValue = document.getElementById('donationScheduleText').value.trim();
                if (!donationTextValue) {
                    errorMessage.textContent = 'Please describe when you can accept donations.';
                    errorMessage.classList.add('show');
                    return;
                }
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            errorMessage.classList.remove('show');

            // Collect all form data
            const formData = new FormData(form);
            const data = {};

            // Handle regular inputs and combine multiple checkbox values
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // If key already exists, convert to array or append to array
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // Convert arrays to comma-separated strings for easier storage
            Object.keys(data).forEach(key => {
                if (Array.isArray(data[key])) {
                    data[key] = data[key].join(', ');
                }
            });

            // Add timestamp
            data.timestamp = new Date().toISOString();

            try {
                // Submit to Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbzSeKM9FHQslxbmQmx4yZ9GwzbvCExJtX1f1QIjnQGh8J5DQZNiOfTlHpNffeNfPvDwwA/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // Show success message
                form.style.display = 'none';
                document.getElementById('successMessage').classList.remove('hidden');
                
                // Clear saved progress after successful submission
                clearSavedProgress();
                
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = 'There was an error submitting the form. Please try again or contact us directly.';
                errorMessage.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Survey';
            }
        });

        // Initial progress update
        updateProgress();
    </script>
</body>
</html>