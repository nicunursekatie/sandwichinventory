<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipient Organization Survey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .header-logo img {
            max-width: 120px;
            height: auto;
        }

        h1 {
            color: #236383;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 15px;
            line-height: 1.6;
        }

        .subtitle p {
            margin-bottom: 12px;
        }

        .subtitle strong {
            color: #236383;
            font-weight: 600;
        }

        .form-note {
            background: #f7fafc;
            padding: 12px 16px;
            border-radius: 6px;
            border-left: 3px solid #47B3CB;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }

        .section-header {
            color: #236383;
            font-size: 18px;
            font-weight: 600;
            margin-top: 35px;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #FBAD3F;
        }

        .section-header:first-of-type {
            margin-top: 0;
        }

        .footer {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .footer p {
            margin-bottom: 8px;
        }

        .footer a {
            color: #236383;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.hidden {
            display: none;
        }

        .hidden {
            display: none;
        }

        label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .helper-text {
            color: #718096;
            font-size: 13px;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #FBAD3F;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .checkbox-group,
        .radio-group {
            margin-top: 10px;
        }
        
        .radio-group.horizontal {
            display: flex;
            flex-direction: row;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }
        
        .form-row.address-row {
            grid-template-columns: 2fr 1fr 1fr;
        }

        .checkbox-item,
        .radio-item {
            margin-bottom: 10px;
        }

        .checkbox-item label,
        .radio-item label {
            font-weight: 400;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"],
        .radio-item input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Enhanced day/time styling */
        .checkbox-group .checkbox-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .checkbox-group .checkbox-item:last-child {
            border-bottom: none;
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
            margin-left: 28px;
            margin-top: 8px;
        }

        .time-inputs.hidden {
            display: none;
        }

        .time-inputs span {
            color: #718096;
            font-size: 14px;
            text-align: center;
        }

        .time-inputs input[type="time"] {
            padding: 8px;
            font-size: 14px;
        }

        .time-input {
            margin-left: 28px;
            margin-top: 8px;
            font-size: 14px;
        }

        /* Add day/time button styling */
        .add-day-btn {
            background: white;
            color: #236383;
            border: 2px dashed #236383;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 8px;
            width: auto;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .add-day-btn:hover {
            background: #f7fafc;
            border-color: #007E8C;
            color: #007E8C;
            transform: none;
            box-shadow: none;
        }

        /* Day/time row styling */
        .day-time-row {
            display: grid;
            grid-template-columns: 150px 1fr auto 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: #f7fafc;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
        }

        .day-time-row select {
            padding: 8px;
            font-size: 14px;
        }

        .day-time-row input[type="time"] {
            padding: 8px;
            font-size: 14px;
        }

        .day-time-row span {
            color: #718096;
            font-size: 14px;
            text-align: center;
        }

        .remove-day-btn {
            background: transparent;
            color: #e53e3e;
            border: none;
            padding: 4px 8px;
            font-size: 18px;
            cursor: pointer;
            width: auto;
            line-height: 1;
        }

        .remove-day-btn:hover {
            color: #c53030;
            background: transparent;
            transform: none;
            box-shadow: none;
        }

        .time-input.hidden {
            display: none;
        }

        .same-time-option {
            margin-bottom: 15px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #FBAD3F;
        }

        .same-time-option label {
            font-weight: 400;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .same-time-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .same-time-option .time-input {
            margin-left: 0;
        }

        button {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(35, 99, 131, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FBAD3F 0%, #236383 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-message h2 {
            color: #48bb78;
            margin-bottom: 10px;
        }

        .success-message.hidden {
            display: none;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .save-status {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .error-message.show {
            display: block;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 24px;
            }

            /* Stack all form rows on mobile */
            .form-row {
                display: block !important;
                margin-bottom: 0;
            }

            .form-row .form-group {
                margin-bottom: 20px !important;
            }

            .radio-group.horizontal {
                flex-direction: column;
                gap: 10px;
            }

            /* Stack day/time rows on mobile */
            .day-time-row {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 8px;
            }

            .day-time-row span:first-of-type {
                display: none;
            }

            .remove-day-btn {
                justify-self: end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="header-logo">
            <img src="sandwich logo.png" alt="The Sandwich Project Logo">
        </div>

        <h1>Annual Recipient Organization Survey</h1>
        <div class="subtitle">
            <p><strong>Why we're asking:</strong> This short survey helps us better understand the organizations we partner with.</p>

            <p><strong>What won't change:</strong> Your responses will not affect what we're currently providing or how we provide it.</p>

            <p><strong>Have more to share?</strong> Use the "Anything else we should know?" section at the end.</p>

            <p style="margin-top: 15px; color: #236383;">Your work is incredible and invaluable to your community, and we're honored to support your efforts.</p>
        </div>

        <div class="form-note">
            <strong>Estimated time:</strong> 7-10 minutes â€¢ <strong>*</strong> Required fields
        </div>

        <div class="error-message" id="errorMessage"></div>
        
        <div class="save-status" id="saveStatus" style="display: none;">
            <span>ðŸ’¾ Progress saved automatically</span>
        </div>

        <form id="surveyForm" action="https://script.google.com/macros/s/AKfycbzSeKM9FHQslxbmQmx4yZ9GwzbvCExJtX1f1QIjnQGh8J5DQZNiOfTlHpNffeNfPvDwwA/exec" method="POST">
            <h2 class="section-header">Contact Information</h2>
            
            <!-- Organization & Contact Info Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="orgName">Organization Name *</label>
                    <input type="text" id="orgName" name="orgName" required>
                </div>
                <div class="form-group">
                    <label for="contactName">Primary Contact Name *</label>
                    <input type="text" id="contactName" name="contactName" required>
                </div>
            </div>

            <!-- Email & Phone Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="contactEmail">Email *</label>
                    <input type="email" id="contactEmail" name="contactEmail" required>
                </div>
                <div class="form-group">
                    <label for="contactPhone">Phone Number *</label>
                    <input type="tel" id="contactPhone" name="contactPhone" required>
                </div>
            </div>

            <!-- Address Section -->
            <div class="form-group">
                <label for="streetAddress">Street Address *</label>
                <input type="text" id="streetAddress" name="streetAddress" placeholder="123 Main Street" required>
            </div>

            <div class="form-group">
                <label for="addressLine2">Address Line 2</label>
                <input type="text" id="addressLine2" name="addressLine2" placeholder="Apt, Suite, Building, etc. (Optional)">
            </div>

            <!-- City, State, Zip Row -->
            <div class="form-row address-row">
                <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" name="city" placeholder="Atlanta" required>
                </div>
                <div class="form-group">
                    <label for="state">State *</label>
                    <input type="text" id="state" name="state" placeholder="GA" required maxlength="2" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label for="zipCode">Zip Code *</label>
                    <input type="text" id="zipCode" name="zipCode" placeholder="30303" required pattern="[0-9]{5}" maxlength="5" inputmode="numeric">
                </div>
            </div>

            <!-- Backup Contact Row -->
            <div class="form-group" style="margin-top: 30px;">
                <label for="backupContactName">Backup Contact Name</label>
                <input type="text" id="backupContactName" name="backupContactName" placeholder="Optional but recommended">
            </div>

            <!-- Backup Contact Email & Phone Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="backupContactEmail">Backup Contact Email</label>
                    <input type="email" id="backupContactEmail" name="backupContactEmail" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label for="backupContactPhone">Backup Contact Phone</label>
                    <input type="tel" id="backupContactPhone" name="backupContactPhone" placeholder="Optional">
                </div>
            </div>

            <!-- Preferred Contact Method Row -->
            <div class="form-group">
                <label>Which communication methods do you regularly monitor? *</label>
                <p class="helper-text">Check all that apply</p>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="contactMethod" value="Text"> Text</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="contactMethod" value="Email"> Email</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="contactMethod" value="Phone"> Phone</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="contactMethod" value="WhatsApp"> WhatsApp</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="contactMethod" value="Facebook Messenger"> Facebook Messenger</label>
                    </div>
                </div>
            </div>

            <!-- Organization Profile -->
            <h2 class="section-header">Organization Profile</h2>
            
            <!-- Website & Social Media Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="website">Website</label>
                    <input type="text" id="website" name="website" placeholder="www.yourorganization.org">
                </div>
                <div class="form-group">
                    <label for="socialMedia">Social Media Handle</label>
                    <input type="text" id="socialMedia" name="socialMedia" placeholder="@yourorganization">
                </div>
            </div>

            <!-- Population & Service Area Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="populationFocus">Specific population focus?</label>
                    <input type="text" id="populationFocus" name="populationFocus" placeholder="E.g., youth, veterans, families">
                </div>
                <div class="form-group">
                    <label for="serviceArea">Where does your organization primarily serve meals or distribute food? *</label>
                    <p class="helper-text">Please list specific neighborhoods, zip codes, or the nearest major intersection.</p>
                    <input type="text" id="serviceArea" name="serviceArea" placeholder='Example: "West End, Vine City, and 30314" or "Near North Avenue & Boulevard"' required>
                </div>
            </div>

            <!-- Operations -->
            <h2 class="section-header">Operations</h2>
            
            <div class="form-group">
                <label>When do you serve meals to your community? *</label>
                <p class="helper-text">Select your regular days and times, or describe your schedule below.</p>

                <div class="radio-group horizontal" style="margin-bottom: 15px;">
                    <label><input type="radio" name="feedingInputType" value="structured" checked> Select days & times</label>
                    <label><input type="radio" name="feedingInputType" value="text"> Describe my schedule</label>
                </div>

                <div id="feedingStructured">
                    <div id="feedingDaysList"></div>
                    <button type="button" class="add-day-btn" id="addFeedingDay">+ Add a day/time</button>
                </div>

                <div id="feedingText" class="hidden">
                    <textarea id="feedingScheduleText" name="feedingScheduleText" placeholder="If your schedule varies, you can describe it here (e.g., 'First and third Saturdays, 9amâ€“noon' or 'Monday-Friday 12pm-2pm')" rows="3"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>What day(s) and time(s) can you accept food donations? *</label>
                <p class="helper-text">Select your regular days and times, or describe your availability below.</p>

                <div class="radio-group horizontal" style="margin-bottom: 15px;">
                    <label><input type="radio" name="donationInputType" value="structured" checked> Select days & times</label>
                    <label><input type="radio" name="donationInputType" value="text"> Describe my availability</label>
                </div>

                <div id="donationStructured">
                    <div id="donationDaysList"></div>
                    <button type="button" class="add-day-btn" id="addDonationDay">+ Add a day/time</button>
                </div>

                <div id="donationText" class="hidden">
                    <textarea id="donationScheduleText" name="donationScheduleText" placeholder="If your availability varies, you can describe it here (e.g., 'By appointment only' or 'Anytime Monday-Friday 9am-5pm' or 'Tuesdays before 10am')" rows="3"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>What's the average number of people you serve? *</label>
                <p class="helper-text">Provide whichever statistic you track (daily, weekly, or monthly average). If your numbers vary, feel free to enter a range (e.g., 20â€“40).</p>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <input type="text" id="peopleCount" name="avgPeopleServed" placeholder="e.g., 30 or 20-40" required style="flex: 0 0 150px; margin-bottom: 0;" pattern="[0-9â€“\-\s]+" title="Enter a number or range (e.g., 30 or 20-40)">
                    <div class="radio-group" style="margin-top: 0; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="frequency" value="Per Day" required> Per Day</label>
                        </div>
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="frequency" value="Per Week"> Per Week</label>
                        </div>
                        <div class="radio-item" style="margin-bottom: 0;">
                            <label><input type="radio" name="frequency" value="Per Month"> Per Month</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dietary & Preferences -->
            <h2 class="section-header">Food Preferences</h2>

            <div class="form-group">
                <label>Are there any sandwiches you can NOT serve?</label>
                <p class="helper-text">Check all that apply (leave blank if you can serve all types)</p>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="cannotServeSandwich" value="Turkey" class="sandwich-checkbox"> Turkey</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="cannotServeSandwich" value="Ham" class="sandwich-checkbox"> Ham</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" name="cannotServeSandwich" value="Peanut Butter & Jelly" class="sandwich-checkbox"> Peanut Butter & Jelly</label>
                    </div>
                </div>
            </div>

            <div class="form-group hidden" id="restrictionReasonGroup" style="margin-left: 28px; padding-left: 12px; border-left: 3px solid #47B3CB; background: #f7fafc;">
                <label for="restrictionReason">Why can't you serve these sandwiches?</label>
                <p class="helper-text">This helps us understand and plan better for future partnerships.</p>
                <textarea id="restrictionReason" name="restrictionReason" placeholder="E.g., Religious dietary laws, allergy concerns in our facility, cultural preferences of our community, etc." rows="2"></textarea>
            </div>

            <!-- Partnership & Impact -->
            <h2 class="section-header">Partnership & Impact</h2>
            
            <p class="helper-text" style="margin-bottom: 25px; color: #236383;">These questions help us secure funding, improve our delivery process, and connect you with additional resources. Most take just a few seconds.</p>
            
            <!-- Partnership Length & Fruit/Snacks Row -->
            <div class="form-row">
                <div class="form-group">
                    <label>How long have you been receiving sandwiches from TSP?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <label><input type="radio" name="yearsReceivingSandwiches" value="Less than 1 year"> Less than 1 year</label>
                        </div>
                        <div class="radio-item">
                            <label><input type="radio" name="yearsReceivingSandwiches" value="1-2 years"> 1-2 years</label>
                        </div>
                        <div class="radio-item">
                            <label><input type="radio" name="yearsReceivingSandwiches" value="2-5 years"> 2-5 years</label>
                        </div>
                        <div class="radio-item">
                            <label><input type="radio" name="yearsReceivingSandwiches" value="5+ years"> 5+ years</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Do you also receive fruit and snacks from TSP?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <label><input type="radio" name="receivesFruitSnacks" value="Yes"> Yes</label>
                        </div>
                        <div class="radio-item">
                            <label><input type="radio" name="receivesFruitSnacks" value="No"> No</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group hidden" id="fruitSnacksInterestGroup" style="margin-left: 28px; padding-left: 12px; border-left: 3px solid #FBAD3F; background: #f7fafc;">
                <label>Would you like to receive fruit and snacks from TSP?</label>
                <div class="radio-group horizontal">
                    <label><input type="radio" name="fruitSnacksInterest" value="Yes"> Yes</label>
                    <label><input type="radio" name="fruitSnacksInterest" value="No"> No</label>
                </div>
            </div>

            <!-- Delivery Process Rating -->
            <div class="form-group">
                <label>How would you rate the ease and efficiency of our delivery process?</label>
                <div class="radio-group horizontal" style="gap: 15px;">
                    <label><input type="radio" name="deliveryRating" value="1"> 1 - Poor</label>
                    <label><input type="radio" name="deliveryRating" value="2"> 2</label>
                    <label><input type="radio" name="deliveryRating" value="3"> 3</label>
                    <label><input type="radio" name="deliveryRating" value="4"> 4</label>
                    <label><input type="radio" name="deliveryRating" value="5"> 5 - Excellent</label>
                </div>
            </div>

            <div class="form-group hidden" id="deliveryFeedbackGroup" style="margin-left: 28px; padding-left: 12px; border-left: 3px solid #A31C41; background: #f7fafc;">
                <label for="deliveryFeedback">Any suggestions to improve our delivery process?</label>
                <p class="helper-text">Help us serve you betterâ€”what could make deliveries smoother?</p>
                <textarea id="deliveryFeedback" name="deliveryFeedback" placeholder="E.g., different delivery times, communication preferences, access instructions, etc." rows="2"></textarea>
            </div>

            <!-- Seasonal Needs -->
            <div class="form-group">
                <label>Do your organizational needs change throughout the year?</label>
                <p class="helper-text">For example, greater needs during extreme temperatures, weather emergencies, school breaks, holidays, etc.</p>
                <div class="radio-group horizontal">
                    <label><input type="radio" name="seasonalNeeds" value="Yes"> Yes</label>
                    <label><input type="radio" name="seasonalNeeds" value="No"> No</label>
                </div>
            </div>

            <div class="form-group hidden" id="seasonalDetailsGroup" style="margin-left: 28px; padding-left: 12px; border-left: 3px solid #007E8C; background: #f7fafc;">
                <label for="seasonalDetails">Please describe when your needs increase or decrease</label>
                <p class="helper-text">E.g., greater needs during winter months or during local school breaks</p>
                <textarea id="seasonalDetails" name="seasonalDetails" placeholder="E.g., Need doubles during summer months, increased demand during holiday season, higher numbers during extreme cold weather, etc." rows="3"></textarea>
            </div>

            <!-- Organization Referrals -->
            <div class="form-group">
                <label for="orgReferrals">Are there other organizations you recommend we partner with?</label>
                <p class="helper-text">Help us expand our reachâ€”share names and contact info if you know organizations that could benefit.</p>
                <textarea id="orgReferrals" name="orgReferrals" placeholder="E.g., Hope Center Atlanta (contact: Jane Smith, jane@hopecenter.org, 404-555-1234)" rows="3"></textarea>
            </div>

            <!-- Grant Funding Interest -->
            <div class="form-group">
                <label>Would you be interested in exploring grant funding opportunities collaboratively?</label>
                <p class="helper-text">We occasionally identify funding opportunities that could benefit partner organizations.</p>
                <div class="radio-group horizontal">
                    <label><input type="radio" name="grantInterest" value="Yes"> Yes</label>
                    <label><input type="radio" name="grantInterest" value="No"> No</label>
                </div>
            </div>

            <!-- Impact Stories -->
            <h2 class="section-header">Share Your Impact</h2>
            
            <p class="helper-text" style="margin-bottom: 25px; color: #236383;">Stories and visuals help us communicate the importance of this work to funders and volunteers. Anything you can share is valuable.</p>

            <div class="form-group">
                <label for="impactStory">Do you have a story, quote, or example that shows the impact of sandwiches on the people you serve?</label>
                <p class="helper-text">This could be a testimonial, an observation, or a specific moment that stood out.</p>
                <textarea id="impactStory" name="impactStory" placeholder="E.g., 'One of our regulars told us these sandwiches are often his only meal of the day...' or 'During the last cold snap, we saw our numbers double and the sandwiches were critical...'" rows="4"></textarea>
            </div>

            <div class="form-group">
                <label for="impactPhotos">Do you have photos you'd be willing to share?</label>
                <p class="helper-text">You can share links to photos, or let us know you have them and we'll follow up. (No personally identifiable images without consent.)</p>
                <textarea id="impactPhotos" name="impactPhotos" placeholder="E.g., Google Drive link, Dropbox link, or just 'Yes, we have photosâ€”please contact us'" rows="2"></textarea>
            </div>

            <!-- Open Feedback -->
            <div class="form-group">
                <label for="additionalInfo">Anything else we should know?</label>
                <p class="helper-text">Including expected increased need in the coming weeks/months due to food assistance cutbacks</p>
                <textarea id="additionalInfo" name="additionalInfo" placeholder="Optional"></textarea>
            </div>

            <button type="submit" id="submitBtn">Submit Survey</button>
        </form>

        <div class="success-message hidden" id="successMessage">
            <h2 style="color: #236383;">ðŸŽ‰ Thank you so much!</h2>
            <p style="margin-bottom: 15px; font-size: 18px; font-weight: 600; color: #007E8C;">Your response has been submitted successfully!</p>
            <p style="margin-bottom: 12px; line-height: 1.6;">We're so grateful for the time you took to share this information with us. Your insights help us serve you better and demonstrate the incredible impact of this partnership to our supporters and funders.</p>
            <p style="margin-bottom: 12px; line-height: 1.which; color: #236383; font-weight: 500;">The work you do in your community is invaluable, and we're honored to support your efforts!</p>
            <p style="font-size: 14px; color: #666; line-height: 1.6;">We'll review your responses and reach out if we have any questions. Need to make changes or share additional information? Just email us at <a href="mailto:info@sandwichproject.org" style="color: #007E8C; font-weight: 600;">info@sandwichproject.org</a></p>
        </div>

        <div class="footer">
            <p><strong>Questions?</strong></p>
            <p>Email us at <a href="mailto:info@sandwichproject.org">info@sandwichproject.org</a></p>
            <p style="margin-top: 12px; font-size: 13px; color: #999;">Â© 2025 The Sandwich Project</p>
        </div>
    </div>

    <script>
        // Auto-save functionality
        const SAVE_KEY = 'sandwich_recipient_survey_progress';
        const saveStatus = document.getElementById('saveStatus');
        let saveTimeout;
        
        function saveFormProgress() {
            const form = document.getElementById('surveyForm');
            const formData = new FormData(form);
            const data = {};

            // Collect all form data
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Handle multiple values (like checkboxes and arrays)
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // Save feeding and donation schedule structure
            data.feedingSchedule = Array.from(document.querySelectorAll('#feedingDaysList .day-time-row')).map(row => ({
                day: row.querySelector('select').value,
                start: row.querySelectorAll('input[type="time"]')[0].value,
                end: row.querySelectorAll('input[type="time"]')[1].value
            }));

            data.donationSchedule = Array.from(document.querySelectorAll('#donationDaysList .day-time-row')).map(row => ({
                day: row.querySelector('select').value,
                start: row.querySelectorAll('input[type="time"]')[0].value,
                end: row.querySelectorAll('input[type="time"]')[1].value
            }));

            // Save to localStorage
            localStorage.setItem(SAVE_KEY, JSON.stringify(data));

            // Show save indicator
            saveStatus.style.display = 'block';
            setTimeout(() => {
                saveStatus.style.display = 'none';
            }, 2000);
        }
        
        function restoreFormProgress() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (!saved) return;

            try {
                const data = JSON.parse(saved);
                const form = document.getElementById('surveyForm');

                // Restore feeding schedule rows
                if (data.feedingSchedule && Array.isArray(data.feedingSchedule)) {
                    data.feedingSchedule.forEach(schedule => {
                        if (schedule.day) {
                            const list = document.getElementById('feedingDaysList');
                            const row = createDayTimeRow('feeding', feedingRowCount++, schedule.day, schedule.start, schedule.end);
                            list.appendChild(row);
                        }
                    });
                }

                // Restore donation schedule rows
                if (data.donationSchedule && Array.isArray(data.donationSchedule)) {
                    data.donationSchedule.forEach(schedule => {
                        if (schedule.day) {
                            const list = document.getElementById('donationDaysList');
                            const row = createDayTimeRow('donation', donationRowCount++, schedule.day, schedule.start, schedule.end);
                            list.appendChild(row);
                        }
                    });
                }

                // Restore form fields
                Object.keys(data).forEach(key => {
                    // Skip schedule arrays as they're handled above
                    if (key === 'feedingSchedule' || key === 'donationSchedule') return;

                    const element = form.querySelector(`[name="${key}"]`);
                    if (element) {
                        if (element.type === 'checkbox' || element.type === 'radio') {
                            // Handle checkboxes and radio buttons
                            const values = Array.isArray(data[key]) ? data[key] : [data[key]];
                            values.forEach(value => {
                                const checkbox = form.querySelector(`[name="${key}"][value="${value}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                }
                            });
                        } else {
                            // Handle text inputs, textareas, selects
                            element.value = Array.isArray(data[key]) ? data[key][0] : data[key];
                        }
                    }
                });

                // Show restoration message
                const restoreMessage = document.createElement('div');
                restoreMessage.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;';
                restoreMessage.innerHTML = 'ðŸ”„ Your previous progress has been restored. You can continue where you left off!';
                form.parentNode.insertBefore(restoreMessage, form);

                // Remove message after 5 seconds
                setTimeout(() => {
                    restoreMessage.remove();
                }, 5000);

            } catch (error) {
                console.error('Error restoring form progress:', error);
            }
        }
        
        function clearSavedProgress() {
            localStorage.removeItem(SAVE_KEY);
        }
        
        // Auto-save on form input (with debouncing)
        function setupAutoSave() {
            const form = document.getElementById('surveyForm');
            
            form.addEventListener('input', () => {
                // Clear existing timeout
                if (saveTimeout) {
                    clearTimeout(saveTimeout);
                }
                
                // Set new timeout (save after 2 seconds of no activity)
                saveTimeout = setTimeout(() => {
                    saveFormProgress();
                }, 2000);
            });
            
            form.addEventListener('change', () => {
                // Save immediately on dropdown/checkbox changes
                saveFormProgress();
            });
        }
        
        // Day/time row management variables (must be declared before restore)
        let feedingRowCount = 0;
        let donationRowCount = 0;

        // Initialize auto-save and restore on page load
        setupAutoSave();
        restoreFormProgress();

        // Auto-capitalize contact name and organization name
        function toTitleCase(str) {
            return str.replace(/\w\S*/g, function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        }

        const orgNameField = document.getElementById('orgName');
        const contactNameField = document.getElementById('contactName');

        orgNameField.addEventListener('blur', function() {
            if (this.value.trim()) {
                this.value = toTitleCase(this.value);
            }
        });

        contactNameField.addEventListener('blur', function() {
            if (this.value.trim()) {
                this.value = toTitleCase(this.value);
            }
        });

        // Toggle between structured and text input for feeding schedule
        const feedingInputTypeRadios = document.querySelectorAll('input[name="feedingInputType"]');
        const feedingStructured = document.getElementById('feedingStructured');
        const feedingText = document.getElementById('feedingText');

        feedingInputTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'structured') {
                    feedingStructured.classList.remove('hidden');
                    feedingText.classList.add('hidden');
                } else {
                    feedingStructured.classList.add('hidden');
                    feedingText.classList.remove('hidden');
                }
            });
        });

        // Toggle between structured and text input for donation schedule
        const donationInputTypeRadios = document.querySelectorAll('input[name="donationInputType"]');
        const donationStructured = document.getElementById('donationStructured');
        const donationText = document.getElementById('donationText');

        donationInputTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'structured') {
                    donationStructured.classList.remove('hidden');
                    donationText.classList.add('hidden');
                } else {
                    donationStructured.classList.add('hidden');
                    donationText.classList.remove('hidden');
                }
            });
        });

        // Day/time row management functions
        function createDayTimeRow(type, rowId, day = '', startTime = '', endTime = '') {
            const row = document.createElement('div');
            row.className = 'day-time-row';
            row.dataset.rowId = rowId;

            row.innerHTML = `
                <select name="${type}Day[]">
                    <option value="">Select day</option>
                    <option value="Monday" ${day === 'Monday' ? 'selected' : ''}>Monday</option>
                    <option value="Tuesday" ${day === 'Tuesday' ? 'selected' : ''}>Tuesday</option>
                    <option value="Wednesday" ${day === 'Wednesday' ? 'selected' : ''}>Wednesday</option>
                    <option value="Thursday" ${day === 'Thursday' ? 'selected' : ''}>Thursday</option>
                    <option value="Friday" ${day === 'Friday' ? 'selected' : ''}>Friday</option>
                    <option value="Saturday" ${day === 'Saturday' ? 'selected' : ''}>Saturday</option>
                    <option value="Sunday" ${day === 'Sunday' ? 'selected' : ''}>Sunday</option>
                </select>
                <input type="time" name="${type}Start[]" value="${startTime}">
                <span>to</span>
                <input type="time" name="${type}End[]" value="${endTime}">
                <button type="button" class="remove-day-btn" onclick="removeRow(this, '${type}')">Ã—</button>
            `;

            return row;
        }

        function removeRow(button, type) {
            button.closest('.day-time-row').remove();
        }

        // Add feeding day/time row
        document.getElementById('addFeedingDay').addEventListener('click', function() {
            const list = document.getElementById('feedingDaysList');
            const row = createDayTimeRow('feeding', feedingRowCount++);
            list.appendChild(row);
        });

        // Add donation day/time row
        document.getElementById('addDonationDay').addEventListener('click', function() {
            const list = document.getElementById('donationDaysList');
            const row = createDayTimeRow('donation', donationRowCount++);
            list.appendChild(row);
        });


        // Show/hide restriction reason field when sandwich restrictions are checked
        const sandwichCheckboxes = document.querySelectorAll('.sandwich-checkbox');
        const restrictionReasonGroup = document.getElementById('restrictionReasonGroup');
        const restrictionReason = document.getElementById('restrictionReason');

        sandwichCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const anyChecked = Array.from(sandwichCheckboxes).some(cb => cb.checked);
                if (anyChecked) {
                    restrictionReasonGroup.classList.remove('hidden');
                } else {
                    restrictionReasonGroup.classList.add('hidden');
                    restrictionReason.value = '';
                }
            });
        });

        // Show delivery feedback field when rating is less than 5
        const deliveryRatingInputs = document.querySelectorAll('input[name="deliveryRating"]');
        const deliveryFeedbackGroup = document.getElementById('deliveryFeedbackGroup');
        const deliveryFeedback = document.getElementById('deliveryFeedback');

        deliveryRatingInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.value && parseInt(this.value) < 5) {
                    deliveryFeedbackGroup.classList.remove('hidden');
                } else {
                    deliveryFeedbackGroup.classList.add('hidden');
                    deliveryFeedback.value = '';
                }
            });
        });

        // Show seasonal details field when "Yes" is selected
        const seasonalNeedsInputs = document.querySelectorAll('input[name="seasonalNeeds"]');
        const seasonalDetailsGroup = document.getElementById('seasonalDetailsGroup');
        const seasonalDetails = document.getElementById('seasonalDetails');

        seasonalNeedsInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.value === 'Yes') {
                    seasonalDetailsGroup.classList.remove('hidden');
                } else {
                    seasonalDetailsGroup.classList.add('hidden');
                    seasonalDetails.value = '';
                }
            });
        });

        // Show fruit/snacks interest question when "No" or "Not Sure" is selected
        const fruitSnacksInputs = document.querySelectorAll('input[name="receivesFruitSnacks"]');
        const fruitSnacksInterestGroup = document.getElementById('fruitSnacksInterestGroup');

        fruitSnacksInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.value === 'No' || this.value === 'Not Sure') {
                    fruitSnacksInterestGroup.classList.remove('hidden');
                } else {
                    fruitSnacksInterestGroup.classList.add('hidden');
                    // Clear the selection when hiding
                    document.querySelectorAll('input[name="fruitSnacksInterest"]').forEach(radio => {
                        radio.checked = false;
                    });
                }
            });
        });

        // Progress bar
        const form = document.getElementById('surveyForm');
        const progressFill = document.getElementById('progressFill');
        const allInputs = form.querySelectorAll('input, select, textarea');

        function updateProgress() {
            const requiredInputs = Array.from(allInputs).filter(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    return input.required || input.name === 'contactMethod';
                }
                return input.required;
            });

            const filledInputs = requiredInputs.filter(input => {
                if (input.type === 'checkbox') {
                    const checkboxGroup = document.querySelectorAll(`input[name="${input.name}"]`);
                    return Array.from(checkboxGroup).some(cb => cb.checked);
                }
                if (input.type === 'radio') {
                    return document.querySelector(`input[name="${input.name}"]:checked`) !== null;
                }
                return input.value.trim() !== '';
            });

            const uniqueRequired = new Set();
            requiredInputs.forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    uniqueRequired.add(input.name);
                } else {
                    uniqueRequired.add(input.id);
                }
            });

            const uniqueFilled = new Set();
            filledInputs.forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    uniqueFilled.add(input.name);
                } else {
                    uniqueFilled.add(input.id);
                }
            });

            const progress = (uniqueFilled.size / uniqueRequired.size) * 100;
            progressFill.style.width = progress + '%';
        }

        allInputs.forEach(input => {
            input.addEventListener('change', updateProgress);
            input.addEventListener('input', updateProgress);
        });

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            const errors = [];
            let firstErrorElement = null;

            // Validate contact methods
            const contactMethodsChecked = document.querySelectorAll('input[name="contactMethod"]:checked').length > 0;
            if (!contactMethodsChecked) {
                errors.push('Select at least one communication method you regularly monitor');
                if (!firstErrorElement) firstErrorElement = document.querySelector('input[name="contactMethod"]');
            }

            // Validate sandwich restrictions reason
            const sandwichRestrictionsChecked = document.querySelectorAll('input[name="cannotServeSandwich"]:checked').length > 0;
            if (sandwichRestrictionsChecked) {
                const restrictionReason = document.getElementById('restrictionReason').value.trim();
                if (!restrictionReason) {
                    errors.push('Explain why you cannot serve certain sandwiches');
                    if (!firstErrorElement) firstErrorElement = document.getElementById('restrictionReason');
                }
            }

            // Validate feeding schedule
            const feedingInputType = document.querySelector('input[name="feedingInputType"]:checked').value;
            if (feedingInputType === 'structured') {
                const feedingRows = document.querySelectorAll('#feedingDaysList .day-time-row').length;
                if (feedingRows === 0) {
                    errors.push('Add at least one day/time for when you serve meals');
                    if (!firstErrorElement) firstErrorElement = document.getElementById('addFeedingDay');
                }
            } else {
                const feedingTextValue = document.getElementById('feedingScheduleText').value.trim();
                if (!feedingTextValue) {
                    errors.push('Describe when you serve meals');
                    if (!firstErrorElement) firstErrorElement = document.getElementById('feedingScheduleText');
                }
            }

            // Validate donation schedule
            const donationInputType = document.querySelector('input[name="donationInputType"]:checked').value;
            if (donationInputType === 'structured') {
                const donationRows = document.querySelectorAll('#donationDaysList .day-time-row').length;
                if (donationRows === 0) {
                    errors.push('Add at least one day/time for when you can accept donations');
                    if (!firstErrorElement) firstErrorElement = document.getElementById('addDonationDay');
                }
            } else {
                const donationTextValue = document.getElementById('donationScheduleText').value.trim();
                if (!donationTextValue) {
                    errors.push('Describe when you can accept donations');
                    if (!firstErrorElement) firstErrorElement = document.getElementById('donationScheduleText');
                }
            }

            // If there are errors, show them all and scroll to first one
            if (errors.length > 0) {
                errorMessage.innerHTML = '<strong>Please complete the following:</strong><ul style="margin: 10px 0 0 20px; text-align: left;">' +
                    errors.map(err => `<li>${err}</li>`).join('') +
                    '</ul>';
                errorMessage.classList.add('show');
                if (firstErrorElement) {
                    firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    if (firstErrorElement.tagName === 'INPUT' || firstErrorElement.tagName === 'TEXTAREA') {
                        setTimeout(() => firstErrorElement.focus(), 500);
                    }
                }
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            errorMessage.classList.remove('show');

            // Collect all form data including hidden fields
            const formData = new FormData(form);
            const data = {};

            // Handle regular inputs and combine multiple checkbox values
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // If key already exists, convert to array or append to array
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // Explicitly collect textarea values to ensure they're not missed
            form.querySelectorAll('textarea').forEach(textarea => {
                const name = textarea.name;
                const value = textarea.value;
                if (name && !data.hasOwnProperty(name)) {
                    data[name] = value;
                }
            });

            // Format feeding schedule
            if (feedingInputType === 'structured') {
                let feedingDays = data['feedingDay[]'] || [];
                let feedingStarts = data['feedingStart[]'] || [];
                let feedingEnds = data['feedingEnd[]'] || [];

                // Ensure they're arrays
                if (!Array.isArray(feedingDays)) feedingDays = [feedingDays];
                if (!Array.isArray(feedingStarts)) feedingStarts = [feedingStarts];
                if (!Array.isArray(feedingEnds)) feedingEnds = [feedingEnds];

                const feedingSchedule = feedingDays.map((day, index) =>
                    `${day} ${feedingStarts[index]} to ${feedingEnds[index]}`
                ).join('; ');

                data.feedingSchedule = feedingSchedule;
                delete data['feedingDay[]'];
                delete data['feedingStart[]'];
                delete data['feedingEnd[]'];
            } else {
                // Text mode: use feedingScheduleText as feedingSchedule
                data.feedingSchedule = data.feedingScheduleText || '';
                delete data.feedingScheduleText;
            }

            // Format donation schedule
            if (donationInputType === 'structured') {
                let donationDays = data['donationDay[]'] || [];
                let donationStarts = data['donationStart[]'] || [];
                let donationEnds = data['donationEnd[]'] || [];

                // Ensure they're arrays
                if (!Array.isArray(donationDays)) donationDays = [donationDays];
                if (!Array.isArray(donationStarts)) donationStarts = [donationStarts];
                if (!Array.isArray(donationEnds)) donationEnds = [donationEnds];

                const donationSchedule = donationDays.map((day, index) =>
                    `${day} ${donationStarts[index]} to ${donationEnds[index]}`
                ).join('; ');

                data.donationSchedule = donationSchedule;
                delete data['donationDay[]'];
                delete data['donationStart[]'];
                delete data['donationEnd[]'];
            } else {
                // Text mode: use donationScheduleText as donationSchedule
                data.donationSchedule = data.donationScheduleText || '';
                delete data.donationScheduleText;
            }

            // Clean up input type selectors (not needed in submission)
            delete data.feedingInputType;
            delete data.donationInputType;

            // Convert arrays to comma-separated strings for easier storage
            Object.keys(data).forEach(key => {
                if (Array.isArray(data[key])) {
                    data[key] = data[key].join(', ');
                }
            });

            // Add timestamp
            data.timestamp = new Date().toISOString();

            // Debug logging
            console.log('===== FORM SUBMISSION DEBUG =====');
            console.log('Total fields being submitted:', Object.keys(data).length);
            console.log('All fields:', Object.keys(data).sort());
            console.log('Full data object:', data);
            console.log('================================');

            try {
                // Submit to Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbzSeKM9FHQslxbmQmx4yZ9GwzbvCExJtX1f1QIjnQGh8J5DQZNiOfTlHpNffeNfPvDwwA/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // Show success message
                form.style.display = 'none';
                document.getElementById('successMessage').classList.remove('hidden');
                
                // Clear saved progress after successful submission
                clearSavedProgress();
                
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = 'There was an error submitting the form. Please try again or contact us directly.';
                errorMessage.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Survey';
            }
        });

        // Initial progress update
        updateProgress();
    </script>
</body>
</html>