<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSP Sandwich Planning Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-weight: 400;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            min-height: 100vh;
            font-size: 16px;
        }
        
        h1 {
            font-weight: 700;
            font-size: 2.5em;
        }
        
        h2 {
            font-weight: 500;
            font-size: 1.8em;
        }
        
        h3 {
            font-weight: 500;
            font-size: 1.3em;
        }
        
        h4 {
            font-weight: 500;
            font-size: 1.1em;
        }
        
        p, li, span {
            font-weight: 400;
            font-size: 1.1em;
        }
        
        .number, strong {
            font-weight: 500;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .logo {
            display: inline-block;
            background: linear-gradient(45deg, #FBAD3F, #A31C41);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .section {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 35px;
        }
        
        .section h2 {
            color: #1a4d66;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 4px solid #FBAD3F;
            font-size: 2em;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .quick-ref {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2.5em; /* Increased gap for more space between cards */
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .quick-ref {
                grid-template-columns: 1fr;
            }
        }
        
        .ref-card {
            background: #fff;
            color: #333;
            padding: 30px 25px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(35, 99, 131, 0.15);
            border: 2px solid #f0f0f0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .ref-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #007E8C, #47B3CB);
            border-radius: 16px 16px 0 0;
        }
        
        .ref-card:nth-child(1) {
            border-top-color: #007E8C;
        }
        
        .ref-card:nth-child(2) {
            border-top-color: #47B3CB;
        }
        
        .ref-card:nth-child(3) {
            border-top-color: #FBAD3F;
        }
        
        .ref-card:nth-child(4) {
            border-top-color: #A31C41;
        }
        
        @media (max-width: 900px) {
          .quick-ref {
            gap: 1.2em;
          }
          .ref-card {
            margin-bottom: 18px;
          }
        }
        
        .ref-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(35, 99, 131, 0.2);
        }
        
        .ref-card h3 {
            font-size: 2.2em;
            margin-bottom: 12px;
            font-weight: 700;
            color: #1a4d66;
        }
        
        .ref-card .serves {
            background: #f8f9fa;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 1em;
            margin-bottom: 18px;
            display: inline-block;
            font-weight: 500;
            color: #666;
            border: 1px solid #e9ecef;
        }
        
        .cost-display {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 18px 0 0 0;
        }
        
        .cost-item {
            background: #f8f9fa;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            color: #333;
            border: 1px solid #e9ecef;
            transition: all 0.2s ease;
        }
        
        .cost-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .shopping-calculator {
            background: linear-gradient(135deg, #007E8C 0%, #47B3CB 100%);
            padding: 40px;
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(0,126,140,0.3);
        }
        
        .calc-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 28px;
            margin-bottom: 30px;
            align-items: start;
        }
        
        /* PB&J Calculator specific layout fixes */
        #pbj-calculator .calc-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            align-items: start;
        }
        
        #pbj-calculator .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }
        
        #pbj-calculator .calc-input-group input,
        #pbj-calculator .calc-input-group select {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            #pbj-calculator .calc-form {
                grid-template-columns: 1fr;
                gap: 25px;
            }
        }
        
        .calc-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        
        .calc-input-group label {
            font-weight: 600;
            font-size: 1.05em;
            color: rgba(255,255,255,0.95);
            text-transform: none;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.15);
            line-height: 1.4;
        }
        
        .calc-input-group input {
            padding: 14px 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 400;
            background: rgba(255,255,255,0.98);
            color: #2c3e50;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
            border: 2px solid transparent;
            width: 100%;
            box-sizing: border-box;
            font-family: inherit;
        }

        .calc-input-group select {
            padding: 14px 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 400;
            color: #2c3e50;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
            border: 2px solid transparent;
            width: 100%;
            box-sizing: border-box;
            font-family: inherit;
            /* Custom dropdown arrow - background set in separate rule below */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.98) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23236383' d='M6 9L1 4h10z'/%3E%3C/svg%3E") no-repeat right 16px center;
            background-size: 12px;
            padding-right: 45px;
            cursor: pointer;
        }

        .calc-input-group input:focus {
            outline: none;
            background: white;
            border-color: #FBAD3F;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .calc-input-group select:focus {
            outline: none;
            background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23FBAD3F' d='M6 9L1 4h10z'/%3E%3C/svg%3E") no-repeat right 16px center;
            background-size: 12px;
            border-color: #FBAD3F;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        
        .calc-input-group input::placeholder {
            color: #95a5a6;
            font-style: normal;
            opacity: 0.7;
        }
        
        .calc-input-group span {
            font-size: 0.9em;
            color: rgba(255,255,255,0.85);
            margin-top: 2px;
            line-height: 1.4;
            font-weight: 400;
        }
        
        .calc-button {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(35,99,131,0.4);
            margin-top: 10px;
            width: 100%;
            max-width: 200px;
            justify-self: center;
        }
        
        .calc-button:hover {
            background: linear-gradient(135deg, #007E8C 0%, #236383 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(35,99,131,0.6);
        }
        
        .calc-button:active {
            transform: translateY(-1px);
        }
        
        .export-button {
            background: linear-gradient(135deg, #FBAD3F 0%, #F39C12 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(251,173,63,0.4);
            margin: 15px auto;
            display: block;
            max-width: 250px;
        }
        
        .export-button:hover {
            background: linear-gradient(135deg, #F39C12 0%, #FBAD3F 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(251,173,63,0.6);
        }
        
        .export-button:active {
            transform: translateY(-1px);
        }
        
        /* Print styles for PDF export */
        @media print {
            body * {
                visibility: hidden;
            }
            .pdf-content, .pdf-content * {
                visibility: visible;
            }
            .pdf-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .pdf-header {
                text-align: center;
                margin-bottom: 30px;
            }
            
            .pdf-section {
                margin-bottom: 20px;
                page-break-inside: avoid;
            }
            
            .pdf-section h3 {
                border-bottom: 2px solid #236383;
                padding-bottom: 5px;
                margin-bottom: 15px;
            }
            
            .pdf-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .pdf-checklist {
                list-style: none;
                padding: 0;
            }
            
            .pdf-checklist li {
                margin: 8px 0;
                font-size: 11px;
            }
            
            .no-print {
                display: none !important;
            }
        }
        
        .calc-button-container {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            padding-top: 10px;
            gap: 12px;
        }

        .validation-hint {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.95);
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.95em;
            text-align: center;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.25);
        }

        .validation-hint.error {
            background: rgba(220, 53, 69, 0.2);
            border-color: rgba(220, 53, 69, 0.4);
        }
        
        .calc-result {
            background: rgba(255,255,255,0.25);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            display: none;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .result-item {
            background: rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .result-item h4 {
            color: #FBAD3F;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .result-item .number {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 12px;
            display: block;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .result-item .description {
            font-size: 1.2em;
            font-weight: 500;
            color: rgba(255,255,255,0.95);
            line-height: 1.4;
        }
        
        .shopping-list {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #FBAD3F;
        }
        
        .shopping-list h3 {
            color: #236383;
            margin-bottom: 15px;
        }
        
        .checklist {
            list-style: none;
        }
        
        .checklist li {
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
        }
        
        .checklist input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
        }
        
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .tip-card {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }
        
        .tip-card h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .tip-card ul {
            list-style: none;
        }
        
        .tip-card li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .tip-card li:before {
            content: "✓";
            position: absolute;
            left: 0;
            top: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            text-align: center;
            font-size: 12px;
            line-height: 16px;
        }
        
        .safety-banner {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            font-size: 1em;
            margin: 20px 0;
        }
        
        .safety-banner > div {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            text-align: left;
        }
        
        @media (max-width: 900px) {
            .safety-banner > div {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 500px) {
            .safety-banner > div {
                grid-template-columns: 1fr;
            }
        }
        
        .recipe-card {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }
        
        .recipe-ingredients {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        /* PB&J Calculator ingredient alignment fix */
        #pbj-calculator .recipe-ingredients {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
            max-width: 100%;
        }
        
        @media (max-width: 768px) {
            #pbj-calculator .recipe-ingredients {
                grid-template-columns: 1fr;
            }
        }
        
        /* Additional PB&J Calculator improvements */
        #pbj-calculator .calc-input-group label {
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: left;
        }
        
        #pbj-calculator .calc-input-group input,
        #pbj-calculator .calc-input-group select {
            padding: 16px 20px;
            font-size: 1.1em;
            width: 100%;
            box-sizing: border-box;
        }
        
        #pbj-calculator .calc-input-group input::placeholder {
            color: #7f8c8d;
            font-style: italic;
        }
        
        #pbj-calculator .calc-input-group span {
            font-size: 0.95em;
            color: white;
            margin-top: 5px;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            font-weight: 500;
        }
        
        .ingredient {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            line-height: 1.4;
        }
        
        .ingredient .amount {
            font-size: 1.4em;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .ingredient .item {
            font-size: 1.1em;
            font-weight: 400;
        }
        
        @media (max-width: 768px) {
            body {
                font-size: 18px;
            }
            
            .calc-form {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .calc-input-group input, .calc-input-group select {
                padding: 14px 16px;
                font-size: 1em;
            }
            
            .calc-input-group label {
                font-size: 1em;
            }
            
            .calc-input-group label {
                font-size: 1.1em;
            }
            
            .calc-button {
                padding: 18px 35px;
                font-size: 1.2em;
                max-width: none;
            }
            
            .recipe-ingredients {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .section h2 {
                font-size: 1.7em;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .result-item .number {
                font-size: 2.5em;
            }
            
            .result-item .description {
                font-size: 1.1em;
            }
        }
        .plan-mode-label {
            color: #236383 !important;
            background: rgba(255,255,255,0.95) !important;
            border-radius: 8px;
            padding: 12px 16px;
            font-weight: 500;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }
        
        .plan-mode-label:hover {
            background: rgba(255,255,255,1) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .plan-mode-label:has(input:checked) {
            background: rgba(35, 99, 131, 0.1) !important;
            border-color: rgba(35, 99, 131, 0.3);
        }
        .plan-mode-label input[type="radio"] {
            accent-color: #236383;
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        /* Mode card styling for new calculator */
        .mode-card:hover {
            border-color: #47B3CB !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .mode-card input[type="radio"]:checked + * {
            /* This will be handled by JavaScript, but keeping for reference */
        }
        
        /* Select option styling */
        .calc-input-group select option {
            background: white;
            padding: 10px;
        }

        /* Meat type tabs */
        .meat-type-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .meat-type-tab {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.9);
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .meat-type-tab:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
        }

        .meat-type-tab.active {
            background: rgba(255,255,255,0.95);
            color: #236383;
            border-color: #FBAD3F;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .meat-type-tab .tab-icon {
            font-size: 1.2em;
        }

        @media (max-width: 500px) {
            .meat-type-tabs {
                flex-wrap: wrap;
            }
            .meat-type-tab {
                flex: 1 1 calc(50% - 4px);
                padding: 10px 12px;
                font-size: 0.9em;
            }
        }

        /* LLM Validation Feedback Styles */
        .llm-validation {
            margin-top: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            animation: fadeIn 0.3s ease;
        }

        .llm-validation.loading {
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255,255,255,0.8);
            font-size: 0.95em;
        }

        .llm-validation.valid {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 163, 74, 0.15) 100%);
            border: 2px solid rgba(34, 197, 94, 0.4);
        }

        .llm-validation.warning {
            background: linear-gradient(135deg, rgba(251, 173, 63, 0.2) 0%, rgba(245, 158, 11, 0.15) 100%);
            border: 2px solid rgba(251, 173, 63, 0.4);
        }

        .llm-validation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.05em;
            color: rgba(255,255,255,0.95);
        }

        .llm-status-icon {
            font-size: 1.3em;
        }

        .llm-validation.valid .llm-status-icon { color: #4ade80; }
        .llm-validation.warning .llm-status-icon { color: #fbbf24; }

        .llm-warnings {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.15);
        }

        .llm-warning-item {
            color: #fef3c7;
            font-size: 0.95em;
            margin-bottom: 6px;
            padding-left: 4px;
        }

        .llm-tips {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.15);
        }

        .llm-tip-item {
            color: rgba(255,255,255,0.85);
            font-size: 0.95em;
            margin-bottom: 6px;
            padding-left: 4px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2, .shopping-calculator h3 {
            color: #236383;
            text-shadow: none;
        }
        .price-badge {
            background: #fffbe8;
            color: #A31C41;
            border-radius: 4px;
            padding: 2px 7px;
            font-weight: 700;
            font-size: 1em;
            margin-left: 2px;
            display: inline-block;
        }

        .cta-banner {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 24px 32px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(35, 99, 131, 0.35);
            margin-bottom: 28px;
            text-align: center;
            border: 3px solid rgba(251, 173, 63, 0.5);
        }

        .cta-banner h2 {
            color: white !important;
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 12px;
            border: none;
            padding: 0;
        }

        .cta-banner p {
            font-size: 1.15em;
            margin-bottom: 18px;
            line-height: 1.5;
        }

        .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #FBAD3F 0%, #F39C12 100%);
            color: #fff;
            text-decoration: none;
            padding: 16px 40px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 6px 20px rgba(251, 173, 63, 0.4);
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            background: linear-gradient(135deg, #F39C12 0%, #FBAD3F 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(251, 173, 63, 0.6);
        }

        @media (max-width: 768px) {
            .cta-banner {
                padding: 20px 24px;
            }

            .cta-banner h2 {
                font-size: 1.5em;
            }

            .cta-banner p {
                font-size: 1.05em;
            }

            .cta-button {
                padding: 14px 32px;
                font-size: 1.1em;
            }
        }

        .nav-menu {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            text-align: center;
        }

        .nav-menu h3 {
            color: #1a4d66;
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-dropdown {
            position: relative;
            display: inline-block;
        }

        .nav-dropdown-btn {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(35,99,131,0.3);
            text-transform: none;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 220px;
            justify-content: center;
        }

        .nav-dropdown-btn:hover {
            background: linear-gradient(135deg, #007E8C 0%, #236383 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(35,99,131,0.4);
        }

        .nav-dropdown-btn.active {
            background: linear-gradient(135deg, #007E8C 0%, #236383 100%);
            box-shadow: 0 8px 25px rgba(35,99,131,0.4);
        }

        .nav-dropdown-btn::after {
            content: '▼';
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .nav-dropdown-btn.active::after {
            transform: rotate(180deg);
        }

        .nav-dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            padding: 8px;
            border: 2px solid #e8f5f9;
        }

        .nav-dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .nav-dropdown-item {
            display: block;
            padding: 14px 20px;
            color: #236383;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: left;
            margin-bottom: 4px;
        }

        .nav-dropdown-item:hover {
            background: linear-gradient(135deg, #e8f5f9 0%, #f0f9fb 100%);
            color: #1a4d66;
            transform: translateX(4px);
        }

        .nav-dropdown-item:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-dropdown {
                width: 100%;
            }

            .nav-dropdown-btn {
                width: 100%;
            }

            .nav-dropdown-menu {
                left: 0;
                transform: translateY(-10px);
                width: 100%;
            }

            .nav-dropdown-menu.show {
                transform: translateY(0);
            }
        }

        /* Calculator Guide Styles */
        html {
            scroll-behavior: smooth;
        }

        .calculator-guide {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .calculator-guide {
                grid-template-columns: 1fr;
            }
        }

        .guide-card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .guide-card.deli {
            border-color: #007E8C;
            background: linear-gradient(135deg, #fff 0%, #e8f5f9 100%);
        }

        .guide-card.deli:hover {
            border-color: #47B3CB;
        }

        .guide-card.custom {
            border-color: #A31C41;
            background: linear-gradient(135deg, #fff 0%, #fdf2f4 100%);
        }

        .guide-card.custom:hover {
            border-color: #c94168;
        }

        .guide-card.pbj {
            border-color: #FBAD3F;
            background: linear-gradient(135deg, #fff 0%, #fef9f0 100%);
        }

        .guide-card.pbj:hover {
            border-color: #f7c56e;
        }

        .guide-card-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .guide-card-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1a4d66;
            margin-bottom: 6px;
        }

        .guide-card-purpose {
            font-size: 1em;
            color: #236383;
            font-weight: 500;
            margin-bottom: 14px;
            line-height: 1.4;
            font-style: italic;
        }

        .guide-card-situation {
            font-size: 0.95em;
            color: #64748b;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .guide-card-situation strong {
            color: #236383;
        }

        .guide-card-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 0.95em;
            padding: 8px 14px;
            border-radius: 20px;
            margin-top: 8px;
        }

        .guide-card.deli .guide-card-action {
            background: #007E8C;
            color: #fff;
        }

        .guide-card.custom .guide-card-action {
            background: #A31C41;
            color: #fff;
        }

        .guide-card.pbj .guide-card-action {
            background: #FBAD3F;
            color: #fff;
        }
        
        /* Table of Contents Styles */
        .toc-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .toc-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: #fff;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            text-decoration: none;
            color: #236383;
            transition: all 0.2s ease;
        }
        
        .toc-item:hover {
            border-color: #47B3CB;
            background: #f8f9fa;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(35, 99, 131, 0.1);
        }
        
        .toc-icon {
            font-size: 1.8em;
            flex-shrink: 0;
            width: 40px;
            text-align: center;
        }
        
        .toc-text {
            flex: 1;
            font-size: 1.05em;
            font-weight: 500;
        }
        
        .toc-arrow {
            color: #47B3CB;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        @media (max-width: 768px) {
            .toc-item {
                padding: 14px 16px;
            }
            .toc-icon {
                font-size: 1.5em;
                width: 35px;
            }
            .toc-text {
                font-size: 0.95em;
            }
        }
        
        /* Quick Access Link Styles */
        .quick-access-link {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 24px 28px;
            background: linear-gradient(135deg, #fffbf0 0%, #fef3e2 100%);
            border: 3px solid #f4a261;
            border-radius: 16px;
            text-decoration: none;
            color: #1a4d66;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.2);
            margin-bottom: 28px;
        }
        
        .quick-access-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
            border-color: #fb8500;
            background: linear-gradient(135deg, #fffbf0 0%, #ffe5cc 100%);
        }
        
        .quick-access-icon {
            font-size: 3em;
            flex-shrink: 0;
        }
        
        .quick-access-content {
            flex: 1;
        }
        
        .quick-access-label {
            font-size: 0.85em;
            color: #d97706;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        
        .quick-access-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1a4d66;
            margin-bottom: 4px;
        }
        
        .quick-access-description {
            font-size: 1em;
            color: #64748b;
        }
        
        .quick-access-arrow {
            font-size: 2em;
            color: #f4a261;
            flex-shrink: 0;
        }
        
        @media (max-width: 768px) {
            .quick-access-link {
                padding: 20px;
                gap: 16px;
            }
            .quick-access-icon {
                font-size: 2.5em;
            }
            .quick-access-title {
                font-size: 1.15em;
            }
            .quick-access-description {
                font-size: 0.9em;
            }
        }
        
        /* Multi-step wizard styles */
        .wizard-container {
            position: relative;
        }
        
        .wizard-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .wizard-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
            font-size: 0.95em;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .wizard-step.active {
            background: rgba(255,255,255,0.95);
            color: #236383;
            border-color: #FBAD3F;
            font-weight: 600;
        }
        
        .wizard-step.completed {
            background: rgba(251,173,63,0.3);
            color: rgba(255,255,255,0.9);
            border-color: rgba(251,173,63,0.5);
        }
        
        .wizard-step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            font-weight: 700;
            font-size: 0.9em;
        }
        
        .wizard-step.active .wizard-step-number {
            background: #236383;
            color: white;
        }
        
        .wizard-step.completed .wizard-step-number {
            background: #FBAD3F;
            color: #1a4d66;
        }
        
        .wizard-content {
            min-height: 300px;
        }
        
        .wizard-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .wizard-panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .wizard-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .wizard-btn {
            padding: 14px 32px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 140px;
        }
        
        .wizard-btn-back {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .wizard-btn-back:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .wizard-btn-next {
            background: linear-gradient(135deg, #FBAD3F 0%, #F39C12 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(251,173,63,0.4);
        }
        
        .wizard-btn-next:hover {
            background: linear-gradient(135deg, #F39C12 0%, #FBAD3F 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251,173,63,0.5);
        }
        
        .wizard-btn-calculate {
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(35,99,131,0.4);
        }
        
        .wizard-btn-calculate:hover {
            background: linear-gradient(135deg, #007E8C 0%, #236383 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(35,99,131,0.5);
        }
        
        .wizard-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wizard-step-title {
            font-size: 1.5em;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .wizard-step-description {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.05em;
        }
        
        @media (max-width: 768px) {
            .wizard-steps {
                flex-direction: column;
                align-items: stretch;
            }
            
            .wizard-step {
                justify-content: center;
            }
            
            .wizard-navigation {
                flex-direction: column;
            }
            
            .wizard-btn {
                width: 100%;
            }
        }
        
        /* Section Divider Styles */
        .section-divider {
            margin: 50px 0;
            text-align: center;
            position: relative;
        }
        
        .section-divider::before,
        .section-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: calc(50% - 100px);
            height: 2px;
            background: linear-gradient(90deg, transparent, #47B3CB, transparent);
        }
        
        .section-divider::before {
            left: 0;
        }
        
        .section-divider::after {
            right: 0;
        }
        
        .section-divider-content {
            display: inline-block;
            background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(35, 99, 131, 0.3);
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 768px) {
            .section-divider {
                margin: 40px 0;
            }
            
            .section-divider::before,
            .section-divider::after {
                width: calc(50% - 80px);
            }
            
            .section-divider-content {
                padding: 12px 24px;
                font-size: 1em;
            }
        }

        /* ==========================================
           UI/UX POLISH - Design System Variables
           ========================================== */
        :root {
            /* Spacing Scale */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Colors - Brand */
            --color-primary: #236383;
            --color-primary-dark: #1a4d66;
            --color-secondary: #007E8C;
            --color-accent: #47B3CB;
            --color-gold: #FBAD3F;
            --color-gold-dark: #F39C12;
            --color-burgundy: #A31C41;
            --color-warning: #d97706;

            /* Colors - Neutral */
            --color-text: #2c3e50;
            --color-text-muted: #64748b;
            --color-text-light: #94a3b8;
            --color-bg-light: #f8f9fa;
            --color-border: #e9ecef;
            --color-border-light: #f0f0f0;

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 20px;

            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.25s ease;
            --transition-slow: 0.35s ease;
        }

        /* ==========================================
           Reusable Component Classes (replacing inline styles)
           ========================================== */

        /* Flex utilities */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .items-start { align-items: start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-xs { gap: var(--space-xs); }
        .gap-sm { gap: var(--space-sm); }
        .gap-md { gap: var(--space-md); }
        .gap-lg { gap: var(--space-lg); }
        .gap-xl { gap: var(--space-xl); }

        /* Text utilities */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-muted { color: var(--color-text-muted); }
        .text-gold { color: var(--color-gold); }
        .text-primary { color: var(--color-primary); }
        .text-warning { color: var(--color-warning); }
        .text-white { color: white; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        /* Spacing utilities */
        .mt-sm { margin-top: var(--space-sm); }
        .mt-md { margin-top: var(--space-md); }
        .mt-lg { margin-top: var(--space-lg); }
        .mt-xl { margin-top: var(--space-xl); }
        .mb-sm { margin-bottom: var(--space-sm); }
        .mb-md { margin-bottom: var(--space-md); }
        .mb-lg { margin-bottom: var(--space-lg); }
        .mb-xl { margin-bottom: var(--space-xl); }
        .p-md { padding: var(--space-md); }
        .p-lg { padding: var(--space-lg); }

        /* ==========================================
           Improved Form Feedback System
           ========================================== */

        /* Inline validation messages */
        .form-feedback {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            font-size: 0.9em;
            font-weight: 500;
            margin-top: var(--space-sm);
            animation: slideIn 0.2s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-feedback.success {
            background: rgba(34, 197, 94, 0.15);
            color: #15803d;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .form-feedback.error {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .form-feedback.warning {
            background: rgba(251, 173, 63, 0.15);
            color: #b45309;
            border: 1px solid rgba(251, 173, 63, 0.3);
        }

        .form-feedback.info {
            background: rgba(71, 179, 203, 0.15);
            color: var(--color-primary);
            border: 1px solid rgba(71, 179, 203, 0.3);
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Button loading state */
        .btn-loading {
            position: relative;
            color: transparent !important;
            pointer-events: none;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }

        /* Improved disabled button state */
        .calc-button:disabled,
        .calc-button[disabled] {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
            transform: none;
        }

        .calc-button:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* ==========================================
           Accessibility Improvements
           ========================================== */

        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--color-primary);
            color: white;
            padding: var(--space-sm) var(--space-md);
            z-index: 9999;
            transition: top var(--transition-fast);
            text-decoration: none;
            font-weight: 600;
            border-radius: 0 0 var(--radius-sm) 0;
        }

        .skip-link:focus {
            top: 0;
            outline: 3px solid var(--color-gold);
            outline-offset: 2px;
        }

        /* Improved focus states */
        *:focus-visible {
            outline: 3px solid var(--color-gold);
            outline-offset: 2px;
        }

        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 3px solid var(--color-gold);
            outline-offset: 2px;
        }

        /* ARIA live region for announcements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Improved color contrast for gold text */
        .gold-contrast {
            color: #b45309;
            font-weight: 600;
        }

        /* Better placeholder contrast */
        .calc-input-group input::placeholder {
            color: #6b7280;
            opacity: 1;
        }

        /* ==========================================
           Standardized Section Components
           ========================================== */

        /* Info banner component */
        .info-banner {
            display: flex;
            align-items: flex-start;
            gap: var(--space-lg);
            padding: var(--space-lg);
            background: linear-gradient(135deg, #fffbf0 0%, #fef3e2 100%);
            border: 2px solid #f4a261;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .info-banner-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .info-banner-content {
            flex: 1;
        }

        .info-banner-title {
            color: var(--color-warning);
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        /* Note card component */
        .note-card {
            display: flex;
            gap: var(--space-lg);
            align-items: flex-start;
            padding: var(--space-md);
            background: rgba(255,255,255,0.6);
            border-radius: var(--radius-md);
            border-left: 4px solid #f4a261;
        }

        .note-card-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .note-card-content {
            flex: 1;
        }

        .note-card-title {
            color: var(--color-text);
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .note-card-text {
            font-size: 1em;
            color: #666;
            line-height: 1.5;
        }

        /* Mode selection cards - improved */
        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            max-width: 800px;
            margin: 0 auto var(--space-lg);
        }

        @media (max-width: 600px) {
            .mode-selection {
                grid-template-columns: 1fr;
            }
        }

        .mode-card-improved {
            display: flex;
            flex-direction: column;
            padding: var(--space-lg);
            border: 3px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            background: var(--color-bg-light);
            position: relative;
        }

        .mode-card-improved:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .mode-card-improved.selected {
            border-color: var(--color-secondary);
            background: rgba(0, 126, 140, 0.08);
            box-shadow: 0 0 0 3px rgba(0, 126, 140, 0.15);
        }

        .mode-card-improved input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mode-card-icon {
            font-size: 2em;
            margin-bottom: var(--space-sm);
        }

        .mode-card-title {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--color-primary);
            margin-bottom: var(--space-sm);
        }

        .mode-card-description {
            font-size: 0.95em;
            color: var(--color-text-muted);
        }

        /* Selected package info display */
        .selected-package-info {
            margin-top: var(--space-md);
            padding: var(--space-md);
            background: rgba(251,173,63,0.2);
            border-radius: var(--radius-sm);
            font-size: 0.9em;
            color: rgba(255,255,255,0.95);
        }

        /* Custom entry form */
        .custom-entry-form {
            display: none;
        }

        .custom-entry-form.visible {
            display: block;
        }

        .custom-entry-input {
            width: 100%;
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.95);
            margin-bottom: var(--space-sm);
            font-size: 1em;
        }

        .custom-entry-actions {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .parse-button {
            padding: var(--space-sm) var(--space-md);
            background: var(--color-gold);
            color: #333;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .parse-button:hover {
            background: var(--color-gold-dark);
            transform: translateY(-1px);
        }

        .parse-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .manual-entry-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }

        .manual-entry-input {
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.95);
            font-size: 0.95em;
        }

        /* Results display improvements */
        .calc-result {
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            animation: scaleIn 0.3s ease-out;
            animation-fill-mode: both;
        }

        .result-item:nth-child(1) { animation-delay: 0.1s; }
        .result-item:nth-child(2) { animation-delay: 0.2s; }
        .result-item:nth-child(3) { animation-delay: 0.3s; }
        .result-item:nth-child(4) { animation-delay: 0.4s; }
        .result-item:nth-child(5) { animation-delay: 0.5s; }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Download button component */
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: var(--color-warning);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: all var(--transition-normal);
            font-size: 1.05em;
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
        }

        .download-btn:hover {
            background: #b86505;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4);
        }

        /* Advanced options details */
        .advanced-options {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-sm);
        }

        .advanced-options summary {
            cursor: pointer;
            font-weight: 600;
            color: rgba(255,255,255,0.95);
            font-size: 1em;
            padding: var(--space-sm) 0;
            list-style: none;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .advanced-options summary::-webkit-details-marker {
            display: none;
        }

        .advanced-options summary::before {
            content: '▶';
            font-size: 0.75em;
            transition: transform var(--transition-fast);
        }

        .advanced-options[open] summary::before {
            transform: rotate(90deg);
        }

        .advanced-options-content {
            padding-top: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        /* Help tooltip styles */
        .help-tip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            font-size: 0.75em;
            font-weight: 700;
            cursor: help;
            margin-left: var(--space-xs);
        }

        .help-tip:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ==========================================
           Streamlined Hero Section
           ========================================== */
        .hero-streamlined {
            text-align: center;
            padding: 40px 30px;
        }

        .hero-title {
            color: var(--color-primary-dark);
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .hero-subtitle {
            color: var(--color-text-muted);
            font-size: 1.15em;
            max-width: 600px;
            margin: 0 auto 28px;
            line-height: 1.5;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 100%);
            color: white;
            text-decoration: none;
            padding: 18px 48px;
            border-radius: var(--radius-lg);
            font-size: 1.3em;
            font-weight: 700;
            box-shadow: 0 8px 30px rgba(0, 126, 140, 0.35);
            transition: all var(--transition-normal);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hero-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 126, 140, 0.45);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-secondary) 100%);
        }

        .hero-cta:focus-visible {
            outline: 3px solid var(--color-gold);
            outline-offset: 3px;
        }

        .hero-cta-arrow {
            font-size: 1.1em;
            transition: transform var(--transition-fast);
        }

        .hero-cta:hover .hero-cta-arrow {
            transform: translateX(4px);
        }

        .hero-links {
            display: flex;
            justify-content: center;
            gap: var(--space-lg);
            margin-top: var(--space-xl);
            flex-wrap: wrap;
        }

        .hero-link {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 0.95em;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
            border: 1px solid transparent;
        }

        .hero-link:hover {
            background: var(--color-bg-light);
            border-color: var(--color-border);
        }

        @media (max-width: 768px) {
            .hero-streamlined {
                padding: 30px 20px;
            }

            .hero-title {
                font-size: 1.8em;
            }

            .hero-subtitle {
                font-size: 1.05em;
            }

            .hero-cta {
                padding: 16px 36px;
                font-size: 1.15em;
            }

            .hero-links {
                flex-direction: column;
                gap: var(--space-md);
            }
        }

        /* ==========================================
           Sandwich Type Toggle (Deli vs PB&J)
           ========================================== */
        .sandwich-type-toggle {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: var(--space-xl);
            background: var(--color-bg-light);
            border-radius: var(--radius-lg);
            padding: 6px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            border: 2px solid var(--color-border);
        }

        .sandwich-type-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            background: transparent;
            color: var(--color-text-muted);
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .sandwich-type-btn:hover:not(.active) {
            background: rgba(0, 126, 140, 0.08);
            color: var(--color-primary);
        }

        .sandwich-type-btn.active {
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .sandwich-type-btn .btn-icon {
            font-size: 1.2em;
        }

        /* ==========================================
           Recipe Sections (below calculator)
           ========================================== */
        .recipe-section {
            margin-top: var(--space-xl);
            padding: var(--space-lg);
            background: linear-gradient(135deg, #f8fffe 0%, #f0fdf9 100%);
            border-radius: var(--radius-lg);
            border: 2px solid var(--color-accent);
        }

        .recipe-section .recipe-card {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .recipe-section .recipe-card h3 {
            color: var(--color-primary);
            font-size: 1.4em;
            margin-bottom: var(--space-md);
            text-align: center;
        }

        .recipe-section .recipe-ingredients {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-sm);
            margin: var(--space-md) 0;
        }

        .recipe-section .ingredient {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--color-bg-light);
            border-radius: var(--radius-sm);
        }

        .recipe-section .ingredient .amount {
            font-weight: 700;
            color: var(--color-secondary);
            min-width: 80px;
        }

        .recipe-section .ingredient .item {
            color: var(--color-text);
        }

        .recipe-section .assembly-tip {
            margin-top: var(--space-md);
            padding: var(--space-md);
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-gold);
            font-size: 0.95em;
        }

        .recipe-section .recipe-downloads {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
            justify-content: center;
        }

        .recipe-section .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--color-secondary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .recipe-section .download-btn:hover {
            background: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ==========================================
           Collapsible Resource Sections
           ========================================== */
        .resource-accordion {
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            overflow: hidden;
            background: white;
        }

        .resource-accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg);
            background: var(--color-bg-light);
            cursor: pointer;
            transition: background var(--transition-fast);
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
        }

        .resource-accordion-header:hover {
            background: #eef1f4;
        }

        .resource-accordion-title {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 1.15em;
            font-weight: 600;
            color: var(--color-primary-dark);
        }

        .resource-accordion-title .accordion-icon {
            font-size: 1.3em;
        }

        .resource-accordion-chevron {
            font-size: 1em;
            color: var(--color-text-muted);
            transition: transform var(--transition-fast);
        }

        .resource-accordion.open .resource-accordion-chevron {
            transform: rotate(180deg);
        }

        .resource-accordion-content {
            display: none;
            padding: var(--space-lg);
            border-top: 1px solid var(--color-border);
        }

        .resource-accordion.open .resource-accordion-content {
            display: block;
            animation: slideDown 0.25s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Shopping notes - compact version for below calculator */
        .shopping-notes-compact {
            background: linear-gradient(135deg, #fffbf0 0%, #fef3e2 100%);
            border: 2px solid #f4a261;
            border-radius: var(--radius-md);
            padding: var(--space-md) var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .shopping-notes-compact .notes-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            color: var(--color-warning);
            margin-bottom: var(--space-sm);
        }

        .shopping-notes-compact ul {
            margin: 0;
            padding-left: var(--space-lg);
            color: var(--color-text);
        }

        .shopping-notes-compact li {
            margin-bottom: var(--space-xs);
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <!-- Accessibility: Skip to main content -->
    <a href="#calculator" class="skip-link">Skip to calculator</a>

    <!-- ARIA live region for screen reader announcements -->
    <div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <div class="container">
        <!-- Compact Header -->
        <header class="header" role="banner" style="padding: 24px 20px; text-align: center;">
            <img src="CMYK_PRINT_TSP-01-01.jpg" alt="The Sandwich Project Logo" style="max-width: 280px; width: 100%; height: auto; margin-bottom: 8px;">
            <p style="color: var(--color-text-muted); font-size: 0.95em; margin: 0;">
                Calculate costs and quantities for your sandwich-making event
                <span style="margin: 0 8px;">•</span>
                <a href="eventestimator/sandwichprojecteventestimator.html" style="color: var(--color-secondary);">Group Estimator</a>
                <span style="margin: 0 8px;">•</span>
                <a href="toolkit.html" style="color: var(--color-secondary);">Toolkit</a>
            </p>
        </header>

        <!-- Unified Calculator Section -->
        <div class="section" id="calculator">
            <h2 id="calculator-heading">🧮 Sandwich Calculator</h2>

            <!-- Sandwich Type Toggle -->
            <div class="sandwich-type-toggle" role="tablist" aria-label="Sandwich type">
                <button class="sandwich-type-btn active" role="tab" aria-selected="true" aria-controls="deli-calculator-panel" id="deli-tab" onclick="switchSandwichType('deli')">
                    <span class="btn-icon" aria-hidden="true">🥪</span>
                    Deli Meat
                </button>
                <button class="sandwich-type-btn" role="tab" aria-selected="false" aria-controls="pbj-calculator-panel" id="pbj-tab" onclick="switchSandwichType('pbj')">
                    <span class="btn-icon" aria-hidden="true">🥜</span>
                    PB&J
                </button>
            </div>

            <!-- Shopping Notes - Compact -->
            <div class="shopping-notes-compact" id="deli-shopping-notes">
                <div class="notes-title">
                    <span aria-hidden="true">📝</span> Quick Shopping Reminders
                </div>
                <ul>
                    <li><strong>Meat:</strong> Buy pre-packaged only (not sliced at deli counter)</li>
                    <li><strong>Cheese:</strong> Get deli-style sliced cheese, NOT individually wrapped singles — those are "cheese product," not real cheese, and they turn into a gross mess on sandwiches</li>
                </ul>
            </div>

            <!-- Deli Calculator Panel -->
            <div id="deli-calculator-panel" role="tabpanel" aria-labelledby="deli-tab">
            <p style="color: #64748b; margin-bottom: 25px; font-size: 1.1em;">Calculate costs or quantities for your sandwich project.</p>

            <!-- Mode Selection -->
            <fieldset class="mode-selection-container" style="background: rgba(255,255,255,0.95); border: 2px solid #47B3CB; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                <legend class="sr-only">What do you want to calculate?</legend>
                <h3 style="color: #1a4d66; margin-bottom: 20px; font-size: 1.3em; text-align: center;">What do you want to calculate?</h3>
                <div class="mode-selection" role="radiogroup" aria-label="Calculation type">
                    <label class="mode-card-improved" id="mode-card-sandwiches" tabindex="0" role="radio" aria-checked="true">
                        <input type="radio" name="calcMode" value="sandwiches" checked onchange="updateCalculatorMode()">
                        <div class="mode-card-icon" aria-hidden="true">🥪</div>
                        <div class="mode-card-title">I know how many sandwiches I need</div>
                        <div class="mode-card-description">Enter your sandwich count to see the estimated total cost.</div>
                    </label>
                    <label class="mode-card-improved" id="mode-card-budget" tabindex="0" role="radio" aria-checked="false">
                        <input type="radio" name="calcMode" value="budget" onchange="updateCalculatorMode()">
                        <div class="mode-card-icon" aria-hidden="true">💵</div>
                        <div class="mode-card-title">I have a set budget to spend</div>
                        <div class="mode-card-description">Enter your budget and we'll calculate the number of sandwiches.</div>
                    </label>
                </div>
            </fieldset>

            <div class="shopping-calculator" id="calculatorForm">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="color: #fff; text-shadow: 0 2px 8px rgba(35,99,131,0.18); margin: 0;" id="calculatorTitle">Enter Your Sandwich Details</h3>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <button onclick="fetchLivePrices()" id="refreshPricesBtnMain" style="padding: 8px 14px; background: linear-gradient(135deg, #FBAD3F, #f59e0b); color: #333; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.85em; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🔄 Update Prices with AI
                        </button>
                        <a href="#pricing-info" style="font-size: 0.9em; color: rgba(255,255,255,0.9); text-decoration: underline; padding: 6px 12px; background: rgba(255,255,255,0.15); border-radius: 6px; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.25)';" onmouseout="this.style.background='rgba(255,255,255,0.15)';">📊 View Pricing Info</a>
                    </div>
                </div>
                <div id="livePriceStatusMain" style="display: none; padding: 12px; margin-bottom: 15px; border-radius: 8px; text-align: center; font-size: 0.9em;"></div>
                    
                <div class="calc-form">
                    <!-- Target Input (sandwiches or budget) -->
                    <div class="calc-input-group" id="targetInputGroup">
                        <label for="targetValue" id="targetLabel">How many sandwiches do you need?</label>
                        <input type="number" id="targetValue" min="1" max="5000" placeholder="e.g., 100" oninput="validateInputs()">
                        <span style="font-size: 0.95em; color: rgba(255,255,255,0.9); margin-top: 4px;" id="targetHint">We'll calculate the cost and shopping list for you</span>
                    </div>
                    
                    <!-- Meat Selection -->
                    <div class="calc-input-group">
                        <label>Meat</label>

                        <!-- Meat Type Tabs -->
                        <div class="meat-type-tabs" role="tablist" aria-label="Select meat type">
                            <button type="button" class="meat-type-tab" data-meat-type="turkey" onclick="selectMeatType('turkey')" role="tab" aria-selected="false">
                                <span class="tab-icon">🦃</span> Turkey
                            </button>
                            <button type="button" class="meat-type-tab" data-meat-type="ham" onclick="selectMeatType('ham')" role="tab" aria-selected="false">
                                <span class="tab-icon">🐷</span> Ham
                            </button>
                            <button type="button" class="meat-type-tab" data-meat-type="chicken" onclick="selectMeatType('chicken')" role="tab" aria-selected="false">
                                <span class="tab-icon">🐔</span> Chicken
                            </button>
                        </div>

                        <!-- Brand Dropdown (filtered by meat type) -->
                        <select id="meatSelection" onchange="handleMeatSelection()">
                            <option value="">First select a meat type above</option>
                            <!-- Turkey options (hidden until turkey tab selected) -->
                            <option value="kroger-turkey-family" data-type="turkey" style="display: none;">Kroger Turkey Family Size (16 oz) - $4.39</option>
                            <option value="kroger-turkey-thin" data-type="turkey" style="display: none;">Kroger Turkey Thin Sliced (9 oz) - $3.99</option>
                            <option value="publix-turkey" data-type="turkey" style="display: none;">Publix Turkey Breast (16 oz) - $7.07</option>
                            <option value="kirkland-turkey" data-type="turkey" style="display: none;">Kirkland Turkey (2 lb) - $13.99</option>
                            <option value="land-o-frost-turkey" data-type="turkey" style="display: none;">Land O'Frost Turkey (16 oz) - $9.53</option>
                            <option value="hillshire-turkey" data-type="turkey" style="display: none;">Hillshire Farm Turkey (9 oz) - $6.07</option>
                            <option value="oscar-mayer-turkey" data-type="turkey" style="display: none;">Oscar Mayer Turkey (2 lb) - $9.97 (Sam's Club)</option>
                            <!-- Ham options (hidden until ham tab selected) -->
                            <option value="kirkland-ham" data-type="ham" style="display: none;">Kirkland Ham (2 lb, 48 slices) - $9.89</option>
                            <option value="kroger-ham" data-type="ham" style="display: none;">Kroger Ham (16 oz) - $4.99</option>
                            <option value="hillshire-ham" data-type="ham" style="display: none;">Hillshire Farm Ham (9 oz) - $5.49</option>
                            <!-- Chicken options (hidden until chicken tab selected) -->
                            <option value="kroger-chicken-thin" data-type="chicken" style="display: none;">Kroger Chicken Thin (9 oz) - $3.50</option>
                            <option value="oscar-mayer-chicken-rotisserie" data-type="chicken" style="display: none;">Oscar Mayer Rotisserie Chicken (16 oz) - $7.99</option>
                            <option value="oscar-mayer-chicken-blackened" data-type="chicken" style="display: none;">Oscar Mayer Blackened Chicken (8 oz) - $4.49</option>
                            <!-- Custom option (hidden until meat type selected) -->
                            <option value="custom" style="display: none;">Enter custom package →</option>
                        </select>

                        <!-- Custom Entry (hidden by default) -->
                        <div id="meatCustomEntry" style="display: none; margin-top: 12px;">
                            <input type="text" id="meatCustomText" placeholder="Paste package description (e.g., 'Publix turkey breast 16 oz $7.99')" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95); margin-bottom: 10px;">
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <button onclick="parseMeatPackage()" style="padding: 8px 16px; background: #FBAD3F; color: #333; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Parse Package</button>
                                <span style="font-size: 0.9em; color: rgba(255,255,255,0.8);">or enter manually:</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <input type="number" id="meatWeightOz" placeholder="Weight (oz)" step="0.1" min="1" oninput="validateInputs()" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                                <input type="number" id="meatPrice" placeholder="Price ($)" step="0.01" min="0" oninput="validateInputs()" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                            </div>
                        </div>

                        <!-- Selected package info -->
                        <div style="margin-top: 12px; padding: 12px; background: rgba(251,173,63,0.2); border-radius: 8px; display: none;" id="meatInfo">
                            <div style="font-size: 0.9em; color: rgba(255,255,255,0.95);">
                                <strong>Selected:</strong> <span id="meatInfoText">-</span>
                            </div>
                        </div>
                    </div>
            
                    <!-- Cheese Selection -->
                        <div class="calc-input-group">
                        <label for="cheeseSelection">Cheese</label>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <select id="cheeseSelection" onchange="handleCheeseSelection()" style="margin-bottom: 10px;">
                                <option value="">Choose from suggested packages (optional)</option>
                                <optgroup label="🧀 American Cheese (Deli Style)">
                                    <option value="boars-head-american">Boar's Head American (24 slices, $8.99)</option>
                                    <option value="land-o-lakes-american">Land O'Lakes American (24 slices, $6.49)</option>
                                    <option value="sargento-american">Sargento Sliced American (22 slices, $4.99)</option>
                                    <option value="great-value-american">Great Value American - Walmart (24 slices, $3.98)</option>
                                    <option value="kroger-american">Kroger Deli American (24 slices, $4.29)</option>
                                </optgroup>
                                <option value="custom">Enter custom package →</option>
                            </select>
                            <div id="cheeseCustomEntry" style="display: none;">
                                <input type="text" id="cheeseCustomText" placeholder="Paste package description" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95); margin-bottom: 10px;">
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button onclick="parseCheesePackage()" style="padding: 8px 16px; background: #FBAD3F; color: #333; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Parse Package</button>
                                    <span style="font-size: 0.9em; color: rgba(255,255,255,0.8);">or enter manually:</span>
                        </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <input type="number" id="cheeseSlices" placeholder="Slices" min="1" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                                    <input type="number" id="cheesePrice" placeholder="Price ($)" step="0.01" min="0" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                        </div>
                    </div>
                    </div>
                        <div style="margin-top: 12px; padding: 12px; background: rgba(251,173,63,0.2); border-radius: 8px; display: none;" id="cheeseInfo">
                            <div style="font-size: 0.9em; color: rgba(255,255,255,0.95);">
                                <strong>Selected:</strong> <span id="cheeseInfoText">-</span>
                    </div>
                </div>
            </div>

                    <!-- Bread Selection -->
                    <div class="calc-input-group">
                        <label for="breadSelection">Bread</label>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                            <select id="breadSelection" onchange="handleBreadSelection()" style="margin-bottom: 10px;">
                                <option value="">Choose from suggested packages (optional)</option>
                                <option value="natures-own-double">Nature's Own Double Loaf (20 sandwiches, $4.49)</option>
                                <option value="sunbeam-single">Sunbeam Single Loaf (10 sandwiches, $2.70)</option>
                                <option value="sunbeam-double">Sunbeam Double Loaf (20 sandwiches, $5.39)</option>
                                <option value="custom">Enter custom package →</option>
                        </select>
                            <div id="breadCustomEntry" style="display: none;">
                                <input type="text" id="breadCustomText" placeholder="Paste package description" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95); margin-bottom: 10px;">
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button onclick="parseBreadPackage()" style="padding: 8px 16px; background: #FBAD3F; color: #333; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Parse Package</button>
                                    <span style="font-size: 0.9em; color: rgba(255,255,255,0.8);">or enter manually:</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <input type="number" id="breadSandwiches" placeholder="Sandwiches per loaf" min="1" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                                    <input type="number" id="breadPrice" placeholder="Price ($)" step="0.01" min="0" style="padding: 10px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95);">
                            </div>
                                </div>
                                </div>
                        <div style="margin-top: 12px; padding: 12px; background: rgba(251,173,63,0.2); border-radius: 8px; display: none;" id="breadInfo">
                            <div style="font-size: 0.9em; color: rgba(255,255,255,0.95);">
                                <strong>Selected:</strong> <span id="breadInfoText">-</span>
                            </div>
                            </div>
                        </div>

                    <!-- Advanced Options (Progressive Disclosure) -->
                    <details style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: 600; color: rgba(255,255,255,0.95); font-size: 1em; margin-bottom: 10px;">⚙️ Advanced Options & Custom Package Settings</summary>
                        <div style="padding-top: 15px; display: flex; flex-direction: column; gap: 15px;">
                                <div class="calc-input-group">
                                <label for="meatOzPerSandwich">Meat per sandwich (oz)</label>
                                <input type="number" id="meatOzPerSandwich" value="2.5" min="2" max="3" step="0.1" style="max-width: 200px;">
                                <span style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-top: 4px;">Default: 2.5 oz (adjust if using thicker/thinner slices or non-standard items)</span>
                                </div>
                                <div class="calc-input-group">
                                <label for="breadUsableSlices">Bread usable slices per loaf</label>
                                <input type="number" id="breadUsableSlices" value="20" min="10" max="26" style="max-width: 200px;">
                                <span style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-top: 4px;">Default: 20 (total slices minus 2 heels). Adjust for non-standard loaf sizes.</span>
                                </div>
                                <div style="padding: 12px; background: rgba(251,173,63,0.2); border-radius: 8px; margin-top: 10px;">
                                    <div style="font-size: 0.9em; color: rgba(255,255,255,0.95);">
                                        <strong>💡 Custom Package Support:</strong> The calculator supports arbitrary package sizes and non-standard items. Enter any weight (oz), slice count, or price manually if the suggested packages don't match what you're using.
                            </div>
                            </div>
                        </div>
                </details>

                    <div class="calc-button-container">
                        <button class="calc-button" onclick="calculateSimplified()" id="calculateBtn" disabled>Calculate</button>
                        <div id="validationHint" class="validation-hint" style="display: none;"></div>
                                </div>
                                </div>

                <div class="calc-result" id="calcResult" style="display: none;"></div>

                <!-- LLM Validation Feedback -->
                <div id="llmValidation" style="display: none;"></div>
                </div>
            </div>
            </div> <!-- End deli-calculator-panel -->

            <!-- PB&J Calculator Panel (hidden by default) -->
            <div id="pbj-calculator-panel" role="tabpanel" aria-labelledby="pbj-tab" style="display: none;">

            <!-- Mode Selection for PB&J -->
            <fieldset class="mode-selection-container" style="background: rgba(255,255,255,0.95); border: 2px solid #47B3CB; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                <legend class="sr-only">What do you want to calculate?</legend>
                <h3 style="color: #1a4d66; margin-bottom: 20px; font-size: 1.3em; text-align: center;">What do you want to calculate?</h3>
                <div class="mode-selection" role="radiogroup" aria-label="PB&J calculation type">
                    <label class="mode-card-improved" id="pbj-mode-card-sandwiches" tabindex="0" role="radio" aria-checked="true">
                        <input type="radio" name="pbjCalcMode" value="sandwiches" checked onchange="updatePBJCalculatorMode()">
                        <div class="mode-card-icon" aria-hidden="true">🥜</div>
                        <div class="mode-card-title">I know how many sandwiches I need</div>
                        <div class="mode-card-description">Enter your sandwich count to see the estimated total cost.</div>
                    </label>
                    <label class="mode-card-improved" id="pbj-mode-card-budget" tabindex="0" role="radio" aria-checked="false">
                        <input type="radio" name="pbjCalcMode" value="budget" onchange="updatePBJCalculatorMode()">
                        <div class="mode-card-icon" aria-hidden="true">💵</div>
                        <div class="mode-card-title">I have a set budget to spend</div>
                        <div class="mode-card-description">Enter your budget and we'll calculate the number of sandwiches.</div>
                    </label>
                </div>
            </fieldset>

            <div class="shopping-calculator" id="pbjCalculatorForm">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #fff; text-shadow: 0 2px 8px rgba(35,99,131,0.18); margin: 0;" id="pbjCalculatorTitle">Enter Your PB&J Details</h3>
                </div>
                <div class="calc-form" id="pbj-calculator">
                    <!-- Target Input (sandwiches or budget) -->
                    <div class="calc-input-group">
                        <label for="pbjTargetValue" id="pbjTargetLabel">How many sandwiches do you need?</label>
                        <input type="number" id="pbjTargetValue" min="1" placeholder="e.g., 100" aria-label="Number of sandwiches needed">
                        <span style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-top: 4px;" id="pbjTargetHint">We'll calculate the cost and shopping list for you</span>
                    </div>

                    <div class="calc-input-group">
                        <label>Peanut butter type</label>
                        <select id="pbType">
                            <option value="jif-40">🥜 Jif Creamy 40 oz (~75 tbsp) - $7.99</option>
                            <option value="skippy-40">🥜 Skippy Creamy 40 oz (~75 tbsp) - $7.99</option>
                            <option value="jif-16">🥜 Jif Creamy 16 oz (~30 tbsp) - $3.59</option>
                            <option value="skippy-16">🥜 Skippy Creamy 16.3 oz (~31 tbsp) - $3.59</option>
                        </select>
                    </div>

                    <div class="calc-input-group">
                        <label>Jelly type</label>
                        <select id="jellyType">
                            <option value="smuckers-32">🍇 Smucker's Grape Jelly 32 oz (~60 tbsp) - $4.99</option>
                            <option value="welchs-30">🍇 Welch's Grape Jelly 30 oz (~56 tbsp) - $3.59</option>
                            <option value="smuckers-squeeze-20">🍇 Smucker's Squeeze Jelly 20 oz (~38 tbsp) - $3.59</option>
                            <option value="welchs-squeeze-18">🍇 Welch's Squeeze Jelly 18 oz (~34 tbsp) - $3.83</option>
                        </select>
                        <span style="font-size: 0.9em; color: rgba(255,255,255,0.9); margin-top: 4px; font-weight: 500;">⚠️ Use JELLY only - no jam, preserves, or fruit spread!</span>
                    </div>

                    <!-- Spatula Option -->
                    <div class="calc-input-group" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <a href="https://www.amazon.com/4-Piece-Silicone-Jar-Spatula-Set/dp/B0FDGY1R58" target="_blank" rel="noopener noreferrer">
                                <img src="pb-spreaders.png" alt="4-Piece Silicone Jar Spatula Set - Long handle for reaching bottom of jars" style="max-width: 120px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer;">
                            </a>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="includeSpatulas" onchange="toggleSpatulaQuantity()" style="width: 20px; height: 20px; cursor: pointer;">
                                <span>Include spreading spatulas in calculation</span>
                            </label>
                        </div>
                        <div id="spatulaQuantitySection" style="display: none; margin-top: 10px;">
                            <label for="spatulaPackCount" style="font-size: 0.95em;">How many 4-packs do you need?</label>
                            <input type="number" id="spatulaPackCount" min="1" value="1" placeholder="1" style="margin-top: 5px;">
                            <div style="font-size: 0.85em; color: rgba(255,255,255,0.85); margin-top: 8px; padding: 10px; background: rgba(251,173,63,0.2); border-radius: 8px;">
                                <strong>💡 Tip:</strong> You need 2 spatulas per group/table making sandwiches — one for peanut butter and one for jelly. Each pack contains 4 spatulas ($5.99/pack).<br>
                                <strong>📦 Overnight shipping available on Amazon!</strong>
                            </div>
                        </div>
                    </div>

                    <div class="calc-button-container">
                        <button class="calc-button" onclick="calculatePBJ()" id="pbjCalculateBtn">Calculate</button>
                        <div id="pbjValidationHint" class="validation-hint" style="display: none;"></div>
                    </div>
                </div>

                <div class="calc-result" id="pbjResult"></div>

                <!-- LLM Insights for PB&J -->
                <div id="pbjLlmValidation" style="display: none;"></div>
            </div>
            </div> <!-- End pbj-calculator-panel -->

            <!-- Deli Recipe Section (shows when deli calculator is active) -->
            <div id="deli-recipe-section" class="recipe-section">
                <div class="recipe-card">
                    <h3>🥪 Deli Sandwich Assembly</h3>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <img src="sandwich assembly with ounces.png" alt="Deli sandwich assembly guide showing layers: bread, cheese, meat, cheese, bread" style="width: 100%; max-width: 450px; height: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    </div>
                    <div class="recipe-ingredients">
                        <div class="ingredient">
                            <span class="amount">2</span><span class="item">slices bread (no heels)</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">2</span><span class="item">slices cheese (one per bread slice)</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">2-3</span><span class="item">slices deli meat (follow package serving size)</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">1</span><span class="item">zip-lock sandwich bag</span>
                        </div>
                    </div>
                    <div class="assembly-tip">
                        <strong>Meat tip:</strong> Check the package label—if serving size = 2 slices (thick cut), use 2. If serving size = 3 slices (thin cut), use 3. Goal is ~2.5 oz per sandwich.
                    </div>
                    <div class="assembly-tip" style="margin-top: 8px;">
                        <strong>Assembly Order:</strong> Bread → Cheese → Meat → Cheese → Bread
                    </div>
                    <div class="recipe-downloads">
                        <a href="toolkit/20250205-TSP-Deli Sandwich Making 101-Groups (2).pdf" target="_blank" class="download-btn">
                            📥 Deli Sandwich Making 101 (PDF)
                        </a>
                        <a href="toolkit/Deli labels_1749341916236.pdf" target="_blank" class="download-btn">
                            🏷️ Deli Sandwich Labels (PDF)
                        </a>
                    </div>
                </div>
            </div>

            <!-- PB&J Recipe Section (shows when PB&J calculator is active) -->
            <div id="pbj-recipe-section" class="recipe-section" style="display: none;">
                <div class="recipe-card">
                    <h3>🥜 PB&J Sandwich Assembly</h3>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <img src="PBJ & ASSEMBLY PEANUT BUTTER ON BOTH SIDES, JELLY ON ONE (1).png" alt="PB&J sandwich assembly guide showing peanut butter on both slices and jelly on one" style="width: 100%; max-width: 450px; height: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    </div>
                    <div class="recipe-ingredients">
                        <div class="ingredient">
                            <span class="amount">2</span><span class="item">slices bread (no heels)</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">1 heaping tbsp</span><span class="item">peanut butter on each slice</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">1 tbsp</span><span class="item">jelly on one side only (not too close to edges)</span>
                        </div>
                        <div class="ingredient">
                            <span class="amount">1</span><span class="item">zip-lock sandwich bag</span>
                        </div>
                    </div>
                    <div class="assembly-tip">
                        <strong>Pro Tip:</strong> Spread peanut butter on both slices first - it creates a barrier that keeps the jelly from making the bread soggy!
                    </div>
                    <div class="recipe-downloads">
                        <a href="toolkit/20250205-TSP- PBJ Making 101 (1).pdf" target="_blank" class="download-btn">
                            📥 PB&J Making 101 (PDF)
                        </a>
                        <a href="toolkit/Pbj labels.pdf" target="_blank" class="download-btn">
                            🏷️ PB&J Labels (PDF)
                        </a>
                    </div>
                </div>
            </div>

        </div> <!-- End unified calculator section -->

        <!-- Resources Section - Collapsible Accordions -->
        <div class="section" id="resources-section">
            <h2>📚 Resources & Guides</h2>
            <p class="text-muted mb-lg">Expand any section below for detailed information on pricing, recipes, and food safety.</p>

            <!-- Pricing Information Accordion -->
            <div class="resource-accordion" id="pricing-accordion">
                <button class="resource-accordion-header" onclick="toggleAccordion(this)" aria-expanded="false" aria-controls="pricing-content">
                    <span class="resource-accordion-title">
                        <span class="accordion-icon" aria-hidden="true">📊</span>
                        Pricing Information
                        <span style="font-size: 0.75em; font-weight: 400; color: var(--color-text-muted);">(Updated 9/17/2025)</span>
                    </span>
                    <span class="resource-accordion-chevron" aria-hidden="true">▼</span>
                </button>
                <div class="resource-accordion-content" id="pricing-content">
            
            <!-- Pricing cards - clean, no wild gradients -->
            <!-- Pricing Section - Compact & Colorful -->
<style>
    .pricing-section {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .pricing-header {
        text-align: center;
        margin-bottom: 24px;
    }
    
    .pricing-header h2 {
        color: #236383;
        font-size: 1.8em;
        margin-bottom: 4px;
        font-weight: 700;
    }
    
    .pricing-meta {
        color: #007E8C;
        font-size: 0.9em;
    }
    
    /* Shopping requirements banner */
    .shopping-requirements {
        background: #e8f5f9;
        border: 2px solid #47B3CB;
        color: #236383;
        padding: 14px 20px;
        border-radius: 8px;
        margin-bottom: 24px;
        font-weight: 500;
    }
    
    .requirements-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 12px;
    }
    
    .requirement-item {
        font-size: 0.95em;
    }
    
    .requirement-header {
        font-weight: 700;
        color: #A31C41;
        margin-bottom: 4px;
        font-size: 1.05em;
    }
    
    .requirement-text {
        color: #555;
        line-height: 1.3;
    }
    
    /* Category sections */
    .price-category {
        margin-bottom: 20px;
    }
    
    .category-label {
        color: #236383;
        font-weight: 700;
        font-size: 1.1em;
        margin-bottom: 10px;
        padding-left: 4px;
    }
    
    /* Product grid */
    .price-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 10px;
    }
    
    .price-card {
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        color: white;
        transition: transform 0.2s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 3px;
    }
    
    .price-card:hover {
        transform: translateY(-3px);
    }
    
    /* Card colors using brand palette */
    .card-meat {
        background: linear-gradient(135deg, #A31C41 0%, #8B1639 100%);
        box-shadow: 0 4px 12px rgba(163, 28, 65, 0.3);
    }
    
    .card-cheese {
        background: linear-gradient(135deg, #236383 0%, #007E8C 100%);
        box-shadow: 0 4px 12px rgba(35, 99, 131, 0.3);
    }
    
    .card-bread {
        background: linear-gradient(135deg, #FBAD3F 0%, #F39C12 100%);
        box-shadow: 0 4px 12px rgba(251, 173, 63, 0.3);
    }
    
    .card-supplies {
        background: linear-gradient(135deg, #47B3CB 0%, #007E8C 100%);
        box-shadow: 0 4px 12px rgba(71, 179, 203, 0.3);
    }
    
    .product-emoji {
        font-size: 1.5em;
        margin-bottom: 4px;
    }
    
    .product-title {
        font-size: 1.05em;
        font-weight: 700;
        line-height: 1.3;
        border-bottom: 1px solid rgba(255,255,255,0.4);
        padding-bottom: 8px;
        margin-bottom: 6px;
    }
    
    .product-size {
        font-size: 0.85em;
        opacity: 0.95;
        margin-bottom: 6px;
        font-weight: 500;
    }
    
    .product-price {
        font-size: 1.5em;
        font-weight: 800;
        margin-top: 6px;
        margin-bottom: 6px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    .price-note {
        font-size: 1.1em;
        font-weight: 600;
        background: rgba(255,255,255,0.25);
        color: #1a1a2e;
        padding: 4px 10px;
        border-radius: 6px;
        margin-top: 4px;
    }
    
    /* Cheese guide - compact */
    .cheese-guide {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 16px;
        margin-bottom: 12px;
    }
    
    .cheese-do, .cheese-dont {
        padding: 18px;
        border-radius: 12px;
        font-size: 1.1em;
        line-height: 1.5;
    }

    .cheese-do {
        background: rgba(0, 126, 140, 0.12);
        border: 2px solid #007E8C;
        color: #236383;
    }

    .cheese-dont {
        background: rgba(163, 28, 65, 0.1);
        border: 2px solid #A31C41;
        color: #A31C41;
    }

    .cheese-do strong, .cheese-dont strong {
        display: block;
        margin-bottom: 8px;
        font-size: 1.25em;
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
        .price-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .price-card {
            padding: 15px;
        }
        
        .product-title {
            font-size: 1em;
        }
        
        .product-price {
            font-size: 1.3em;
        }
        
        .price-note {
            font-size: 1em;
        }
        
        .cheese-guide {
            grid-template-columns: 1fr;
        }
        
        .requirements-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="pricing-section">
    <div class="pricing-header">
        <h2>Ingredient Cost Guide</h2>
        <div class="pricing-meta">
            <span id="priceUpdateStatus">Based on recent shopping • Prices vary by location</span>
            <button onclick="fetchLivePrices()" id="refreshPricesBtn" style="margin-left: 15px; padding: 8px 16px; background: linear-gradient(135deg, #007E8C, #47B3CB); color: white; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.9em; transition: all 0.3s ease;">
                🔄 Refresh Prices with AI
            </button>
        </div>
    </div>
    <div id="livePriceStatus" style="display: none; padding: 15px; margin-bottom: 20px; border-radius: 10px; text-align: center;"></div>
    
    <!-- Meat Section -->
    <div class="price-category">
        <div class="category-label">MEAT</div>
        <div class="price-grid">
            <div class="price-card card-meat">
                <div class="product-emoji">🦃</div>
                <div class="product-title">Kroger Turkey Family Size</div>
                <div class="product-size">1 lb • 30-32 slices</div>
                <div class="product-price">$4.39</div>
                <div class="price-note">~$0.14/slice</div>
            </div>
            
            <div class="price-card card-meat">
                <div class="product-emoji">🐷</div>
                <div class="product-title">Kirkland Ham</div>
                <div class="product-size">2-pack • 48 slices</div>
                <div class="product-price">$9.89</div>
                <div class="price-note">~$0.21/slice</div>
            </div>
            
            <div class="price-card card-meat">
                <div class="product-emoji">🦃</div>
                <div class="product-title">Publix Turkey Breast</div>
                <div class="product-size">16 oz • 32 slices</div>
                <div class="product-price">$7.07</div>
                <div class="price-note">~$0.22/slice</div>
            </div>
            
            <div class="price-card card-meat">
                <div class="product-emoji">🦃</div>
                <div class="product-title">Kroger Turkey Thin Sliced</div>
                <div class="product-size">9 oz • 18 slices</div>
                <div class="product-price">$3.99</div>
                <div class="price-note">~$0.22/slice</div>
            </div>
        </div>
        
        <details style="margin-top: 20px;">
            <summary style="cursor: pointer; font-weight: 600; color: #1a4d66; font-size: 1.1em; padding: 12px; background: rgba(251,173,63,0.15); border-radius: 8px; margin-bottom: 15px;">
                ➕ Show More Meat Options
            </summary>
            <div class="price-grid" style="margin-top: 15px;">
                <div class="price-card card-meat">
                    <div class="product-emoji">🦃</div>
                    <div class="product-title">Land O'Frost Premium</div>
                    <div class="product-size">16 oz • 32 slices</div>
                    <div class="product-price">$9.53</div>
                    <div class="price-note">~$0.30/slice</div>
                </div>
                
                <div class="price-card card-meat">
                    <div class="product-emoji">🦃</div>
                    <div class="product-title">Hillshire Farm Ultra Thin</div>
                    <div class="product-size">9 oz • 18 slices</div>
                    <div class="product-price">$6.07</div>
                    <div class="price-note">~$0.34/slice</div>
                </div>
                
                <div class="price-card card-meat">
                    <div class="product-emoji">🦃</div>
                    <div class="product-title">Kirkland Turkey</div>
                    <div class="product-size">2-pack • 40 slices</div>
                    <div class="product-price">$13.99</div>
                    <div class="price-note">~$0.35/slice</div>
                </div>
                
                <div class="price-card card-meat">
                    <div class="product-emoji">🦃</div>
                    <div class="product-title">Kroger Private Selection®</div>
                    <div class="product-size">8 oz • 11-12 slices</div>
                    <div class="product-price">$6.49</div>
                    <div class="price-note">~$0.56/slice</div>
                </div>
            </div>
        </details>
    </div>
    
    <!-- Cheese Section -->
    <div class="price-category">
        <div class="category-label">AMERICAN CHEESE (Deli Style)</div>
        <div class="price-grid">
            <div class="price-card card-cheese">
                <div class="product-emoji">🇺🇸</div>
                <div class="product-title">Great Value</div>
                <div class="product-size">24 slices</div>
                <div class="product-price">$3.98</div>
                <div class="price-note">~$0.17/slice</div>
            </div>

            <div class="price-card card-cheese">
                <div class="product-emoji">🇺🇸</div>
                <div class="product-title">Kroger Deli</div>
                <div class="product-size">24 slices</div>
                <div class="product-price">$4.29</div>
                <div class="price-note">~$0.18/slice</div>
            </div>

            <div class="price-card card-cheese">
                <div class="product-emoji">🇺🇸</div>
                <div class="product-title">Sargento</div>
                <div class="product-size">22 slices</div>
                <div class="product-price">$4.99</div>
                <div class="price-note">~$0.23/slice</div>
            </div>

            <div class="price-card card-cheese">
                <div class="product-emoji">🇺🇸</div>
                <div class="product-title">Land O'Lakes</div>
                <div class="product-size">24 slices</div>
                <div class="product-price">$6.49</div>
                <div class="price-note">~$0.27/slice</div>
            </div>

            <div class="price-card card-cheese">
                <div class="product-emoji">🇺🇸</div>
                <div class="product-title">Boar's Head</div>
                <div class="product-size">24 slices</div>
                <div class="product-price">$8.99</div>
                <div class="price-note">~$0.37/slice</div>
            </div>
        </div>
    </div>

    
    <!-- Bread & Supplies Section -->
    <div class="price-category">
        <div class="category-label">BREAD & SUPPLIES</div>
        <div class="price-grid">
            <div class="price-card card-bread">
                <div class="product-emoji">🍞</div>
                <div class="product-title">Nature's Own</div>
                <div class="product-size">Double loaf</div>
                <div class="product-price">$4.49</div>
                <div class="price-note">~$0.22/sandwich</div>
            </div>
            
            <div class="price-card card-bread">
                <div class="product-emoji">🍞</div>
                <div class="product-title">Store Brand</div>
                <div class="product-size">Double loaf</div>
                <div class="product-price">$5.39</div>
                <div class="price-note">~$0.27/sandwich</div>
            </div>
            
            <div class="price-card card-supplies">
                <div class="product-emoji">📦</div>
                <div class="product-title">Sandwich Bags</div>
                <div class="product-size">480 count</div>
                <div class="product-price">$7.99</div>
                <div class="price-note">~$0.02/bag</div>
            </div>
        </div>
    </div>
    
    <div class="cheese-guide">
        <div class="cheese-do">
            <strong>✅ Right Cheese</strong>
            Deli-style sliced American cheese (NOT individually wrapped)
        </div>
        <div class="cheese-dont">
            <strong>❌ Wrong Cheese</strong>
            Kraft singles or any individually plastic-wrapped slices — they're a pain to unwrap, they're "cheese product" (not real cheese), and they turn into a gross mess on sandwiches
        </div>
    </div>
</div>
    <!-- Collapsible Ingredient Price Summary moved to very bottom -->
                </div> <!-- End pricing-content -->
            </div> <!-- End pricing-accordion -->

            <!-- Quick Reference Accordion -->
            <div class="resource-accordion" id="quick-ref-accordion">
                <button class="resource-accordion-header" onclick="toggleAccordion(this)" aria-expanded="false" aria-controls="quick-ref-content">
                    <span class="resource-accordion-title">
                        <span class="accordion-icon" aria-hidden="true">🎯</span>
                        Quick Reference: Popular Quantities
                    </span>
                    <span class="resource-accordion-chevron" aria-hidden="true">▼</span>
                </button>
                <div class="resource-accordion-content" id="quick-ref-content">
                    <p style="color: #64748b; font-size: 0.95em; margin-bottom: 16px;">Quantities based on common package sizes (~24 slices cheese, ~30-32 slices meat). Use the calculator above for exact costs with your chosen brands.</p>
                    <div class="quick-ref">
                <div class="ref-card">
                    <div style="font-size: 2.5em; margin-bottom: 15px;">🏠</div>
                    <h3>40</h3>
                    <div class="serves">👥 Serves 20-30 people</div>
                    <div class="cost-display">
                        <div class="cost-item">~4-5 meat packages</div>
                        <div class="cost-item">~4 cheese packages</div>
                        <div class="cost-item">~2 bread loaves</div>
                    </div>
                </div>
                <div class="ref-card">
                    <div style="font-size: 2.5em; margin-bottom: 15px;">🏢</div>
                    <h3>80</h3>
                    <div class="serves">👥 Serves 40-60 people</div>
                    <div class="cost-display">
                        <div class="cost-item">~8-10 meat packages</div>
                        <div class="cost-item">~7 cheese packages</div>
                        <div class="cost-item">~4 bread loaves</div>
                    </div>
                </div>
                <div class="ref-card">
                    <div style="font-size: 2.5em; margin-bottom: 15px;">🏫</div>
                    <h3>120</h3>
                    <div class="serves">👥 Serves 60-90 people</div>
                    <div class="cost-display">
                        <div class="cost-item">~12-15 meat packages</div>
                        <div class="cost-item">~10 cheese packages</div>
                        <div class="cost-item">~6 bread loaves</div>
                    </div>
                </div>
                <div class="ref-card">
                    <div style="font-size: 2.5em; margin-bottom: 15px;">🎪</div>
                    <h3>200</h3>
                    <div class="serves">👥 Serves 100-150 people</div>
                    <div class="cost-display">
                        <div class="cost-item">~20-25 meat packages</div>
                        <div class="cost-item">~17 cheese packages</div>
                        <div class="cost-item">~10 bread loaves</div>
                    </div>
                </div>
                    </div>
                </div> <!-- End quick-ref-content -->
            </div> <!-- End quick-ref-accordion -->

            <!-- Food Safety Accordion -->
            <div class="resource-accordion" id="food-safety-accordion">
                <button class="resource-accordion-header" onclick="toggleAccordion(this)" aria-expanded="false" aria-controls="food-safety-content">
                    <span class="resource-accordion-title">
                        <span class="accordion-icon" aria-hidden="true">🛡️</span>
                        Food Safety Requirements
                    </span>
                    <span class="resource-accordion-chevron" aria-hidden="true">▼</span>
                </button>
                <div class="resource-accordion-content" id="food-safety-content">
            <div class="tips-grid">
                <div class="tip-card">
                    <h3>🧤 Personal Hygiene</h3>
                    <ul>
                        <li>Wash hands with soap and warm water</li>
                        <li>Wear disposable gloves (required)</li>
                        <li>Change gloves if touching non-food items</li>
                        <li>Use hair ties or nets for long hair</li>
                        <li>Use beard nets if applicable</li>
                        <li>Clean and cover all prep surfaces</li>
                    </ul>
                </div>
                
                <div class="tip-card">
                    <h3>❄️ Temperature Control</h3>
                    <ul>
                        <li>Keep all ingredients at 40°F or below</li>
                        <li>Never leave ingredients at 80°F or above</li>
                        <li>Remove only 1 package of meat at a time from fridge</li>
                        <li>Return completed loaves immediately</li>
                        <li>Never put warm sandwiches in coolers</li>
                    </ul>
                </div>
                
                <div class="tip-card">
                    <h3>📦 Ingredient Standards</h3>
                    <ul>
                        <li>Use same quality you'd feed your family</li>
                        <li>Pre-packaged deli meat only (no deli counter)</li>
                        <li>Check expiration: 10+ days after purchase</li>
                        <li>Keep nut products away from deli area</li>
                        <li>When in doubt, throw it out!</li>
                    </ul>
                </div>
                
                <div class="tip-card">
                    <h3>🚚 Transport Safety</h3>
                    <ul>
                        <li>Cool sandwiches in freezer 20-30 minutes before packing</li>
                        <li>Ensure coolers are cool before loading (not hot from garage)</li>
                        <li>Use ice packs - enough to touch every loaf of sandwiches</li>
                        <li>Fill coolers completely (no air circulation)</li>
                        <li>Once packed, do NOT open cooler - it will rapidly heat up</li>
                        <li>Transport directly to host locations</li>
                    </ul>
                </div>
            </div>
            
            <div class="safety-banner" style="margin-top: 30px;">
                ⚠️ REMEMBER: Recipients may be children, elderly, or immunocompromised. Food safety protects our most vulnerable community members.
            </div>
            
            <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #fffbe8 0%, #fef3e2 100%); border: 2px solid #f4a261; border-radius: 12px;">
                <h3 style="color: #d97706; font-size: 1.3em; margin-bottom: 12px; font-weight: 600;">📄 Download Food Safety Guide</h3>
                <p style="color: #555; margin-bottom: 15px; font-size: 1.05em;">For comprehensive food safety guidelines, download our complete volunteer guide:</p>
                <a href="toolkit/20230525-TSP-Food+Safety+Volunteers (2).pdf" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #d97706; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s ease; font-size: 1.05em; box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);" onmouseover="this.style.background='#b86505'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(217, 119, 6, 0.4)';" onmouseout="this.style.background='#d97706'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(217, 119, 6, 0.3)';">
                    📥 Food Safety for Volunteers (PDF)
                </a>
            </div>
        </div>

            <!-- Planning Tips Section -->
            <div class="section" id="planning-tips" style="margin-top: 0;">
            <h2>💡 Planning Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <h3>⏱️ Timing Guidelines</h3>
                    <ul>
                        <li>Small (50-100): 45-90 minutes</li>
                        <li>Medium (200-300): 2-3 hours</li>
                        <li>Large (500+): 4-8 hours</li>
                        <li>Add 20 min for setup/cleanup</li>
                    </ul>
                </div>
                
                <div class="tip-card">
                    <h3>❄️ Storage & Transport</h3>
                    <ul>
                        <li>~100 sandwiches per large cooler</li>
                        <li>Plan 2-3 hours ingredient storage</li>
                        <li>Use your own coolers with ice packs</li>
                        <li>Never put warm sandwiches in coolers</li>
                        <li>Once packed, don't open cooler during transport</li>
                    </ul>
                </div>
                
                <div class="tip-card">
                    <h3>✅ Quality Standards</h3>
                    <ul>
                        <li>Same quality you'd serve family</li>
                        <li>10+ days until expiration</li>
                        <li>Pre-packaged deli meat only</li>
                        <li>Add 5-10% buffer for extras</li>
                    </ul>
                </div>
                </div>
                </div> <!-- End food-safety-content -->
            </div> <!-- End food-safety-accordion -->

            <!-- Recipe Accordion -->
            <div class="resource-accordion" id="recipe-accordion">
                <button class="resource-accordion-header" onclick="toggleAccordion(this)" aria-expanded="false" aria-controls="recipe-content">
                    <span class="resource-accordion-title">
                        <span class="accordion-icon" aria-hidden="true">🥪</span>
                        Perfect Sandwich Recipe
                    </span>
                    <span class="resource-accordion-chevron" aria-hidden="true">▼</span>
                </button>
                <div class="resource-accordion-content" id="recipe-content">
            <div class="recipe-card">
                <h3>Deli Sandwich - Every Sandwich Contains</h3>
                <div style="margin-bottom: 20px; text-align: center;">
                    <img src="sandwich assembly with ounces.png" alt="Deli sandwich assembly guide" style="width: 100%; max-width: 400px; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <div class="recipe-ingredients">
                    <div class="ingredient">
                        <span class="amount">2</span><span class="item">slices bread (no heels)</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">2</span><span class="item">slices cheese (one per bread slice)</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">2-3</span><span class="item">slices deli meat (follow package serving size)</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">1</span><span class="item">zip-lock sandwich bag</span>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 8px; font-size: 0.95em;">
                    <strong>Meat tip:</strong> Check the package—if serving = 2 slices (thick cut), use 2. If serving = 3 slices (thin cut), use 3. Goal is ~2.5 oz per sandwich.
                </div>
                <div style="margin-top: 8px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 8px; font-size: 0.95em;">
                    <strong>Assembly Order:</strong> Bread → Cheese → Meat → Cheese → Bread
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #fffbe8 0%, #fef3e2 100%); border: 2px solid #f4a261; border-radius: 12px;">
                <h3 style="color: #d97706; font-size: 1.3em; margin-bottom: 15px; font-weight: 600;">📄 Download Deli Sandwich Resources</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="toolkit/20250205-TSP-Deli Sandwich Making 101-Groups (2).pdf" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: #d97706; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; font-size: 1.05em; box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);" onmouseover="this.style.background='#b86505'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(217, 119, 6, 0.4)';" onmouseout="this.style.background='#d97706'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(217, 119, 6, 0.3)';">
                        📥 Deli Sandwich Making 101 (PDF)
                    </a>
                    <a href="toolkit/Deli labels_1749341916236.pdf" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: #d97706; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; font-size: 1.05em; box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);" onmouseover="this.style.background='#b86505'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(217, 119, 6, 0.4)';" onmouseout="this.style.background='#d97706'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(217, 119, 6, 0.3)';">
                        🏷️ Deli Sandwich Labels (PDF)
                    </a>
                </div>
            </div>
            
            <div class="recipe-card" style="margin-top: 30px;">
                <h3>PB&J Sandwich - Assembly Instructions</h3>
                <div style="margin-bottom: 20px; text-align: center;">
                    <img src="PBJ & ASSEMBLY PEANUT BUTTER ON BOTH SIDES, JELLY ON ONE (1).png" alt="PB&J sandwich assembly guide" style="width: 100%; max-width: 400px; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <div class="recipe-ingredients">
                    <div class="ingredient">
                        <span class="amount">2</span><span class="item">slices bread (no heels)</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">1 heaping tbsp</span><span class="item">peanut butter on each slice of bread</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">1 tbsp</span><span class="item">jelly on one side only (not too close to edges)</span>
                    </div>
                    <div class="ingredient">
                        <span class="amount">1</span><span class="item">zip-lock sandwich bag</span>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 0.95em; color: #64748b;">
                    <strong>Assembly:</strong> Spread peanut butter on both slices of bread, then add jelly to one side. Press the two pieces together gently.
                </div>
            </div>
                </div> <!-- End recipe-content -->
            </div> <!-- End recipe-accordion -->

        </div> <!-- End resources-section -->
    </div> <!-- End container -->

    <script>
        // Dropdown menu functions
        function toggleDropdown(type) {
            const menu = document.getElementById(type + '-menu');
            const btn = event.target.closest('.nav-dropdown').querySelector('.nav-dropdown-btn');
            const isOpen = menu.classList.contains('show');
            
            // Close all other dropdowns
            document.querySelectorAll('.nav-dropdown-menu').forEach(m => {
                if (m !== menu) {
                    m.classList.remove('show');
                }
            });
            document.querySelectorAll('.nav-dropdown-btn').forEach(b => {
                if (b !== btn) {
                    b.classList.remove('active');
                }
            });
            
            // Toggle current dropdown
            if (isOpen) {
                menu.classList.remove('show');
                btn.classList.remove('active');
            } else {
                menu.classList.add('show');
                btn.classList.add('active');
            }
        }
        
        function closeDropdown(type) {
            const menu = document.getElementById(type + '-menu');
            const btn = document.querySelector(`.nav-dropdown:has(#${type}-menu) .nav-dropdown-btn`);
            if (menu) {
                menu.classList.remove('show');
            }
            if (btn) {
                btn.classList.remove('active');
            }
        }
        
        // Close dropdowns when clicking on any dropdown item
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Close all dropdowns
                    document.querySelectorAll('.nav-dropdown-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                    document.querySelectorAll('.nav-dropdown-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                });
            });
            
            // Initialize wizard
            if (document.getElementById('wizardTargetSandwiches')) {
                updateWizardStep1();
            }
        });
        
        // Close dropdowns when clicking outside
        window.addEventListener('click', function(event) {
            if (!event.target.closest('.nav-dropdown')) {
                document.querySelectorAll('.nav-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
                document.querySelectorAll('.nav-dropdown-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        });

        // ============================================
        // NEW SIMPLIFIED CALCULATOR FUNCTIONS
        // ============================================

        // ============================================
        // UI/UX POLISH: Form Feedback Utilities
        // ============================================

        /**
         * Show inline feedback message instead of alert
         * @param {string} containerId - ID of container to append feedback to
         * @param {string} message - Message to display
         * @param {string} type - 'success', 'error', 'warning', or 'info'
         * @param {number} duration - Auto-hide duration in ms (0 = permanent)
         */
        function showFeedback(containerId, message, type = 'info', duration = 5000) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Remove existing feedback in this container
            const existing = container.querySelector('.form-feedback');
            if (existing) existing.remove();

            // Create feedback element
            const feedback = document.createElement('div');
            feedback.className = `form-feedback ${type}`;
            feedback.setAttribute('role', 'alert');
            feedback.setAttribute('aria-live', 'polite');

            const icons = {
                success: '✓',
                error: '✕',
                warning: '⚠',
                info: 'ℹ'
            };

            feedback.innerHTML = `<span aria-hidden="true">${icons[type]}</span> ${message}`;
            container.appendChild(feedback);

            // Announce to screen readers
            announceToScreenReader(message);

            // Auto-hide if duration specified
            if (duration > 0) {
                setTimeout(() => {
                    feedback.style.opacity = '0';
                    feedback.style.transform = 'translateY(-8px)';
                    setTimeout(() => feedback.remove(), 200);
                }, duration);
            }

            return feedback;
        }

        /**
         * Show feedback near a specific element
         * @param {HTMLElement} element - Element to show feedback near
         * @param {string} message - Message to display
         * @param {string} type - 'success', 'error', 'warning', or 'info'
         */
        function showInlineFeedback(element, message, type = 'info', duration = 5000) {
            const parent = element.closest('.calc-input-group') || element.parentElement;
            if (!parent) return;

            // Create a unique container for this feedback
            let feedbackContainer = parent.querySelector('.feedback-container');
            if (!feedbackContainer) {
                feedbackContainer = document.createElement('div');
                feedbackContainer.className = 'feedback-container';
                parent.appendChild(feedbackContainer);
            }

            feedbackContainer.id = 'feedback-' + Date.now();
            return showFeedback(feedbackContainer.id, message, type, duration);
        }

        /**
         * Announce message to screen readers via live region
         * @param {string} message - Message to announce
         */
        function announceToScreenReader(message) {
            const announcer = document.getElementById('announcements');
            if (announcer) {
                announcer.textContent = message;
                // Clear after announcement
                setTimeout(() => { announcer.textContent = ''; }, 1000);
            }
        }

        /**
         * Set loading state on a button
         * @param {HTMLElement} button - Button element
         * @param {boolean} loading - Whether button is loading
         * @param {string} loadingText - Optional text to show while loading
         */
        function setButtonLoading(button, loading, loadingText = 'Processing...') {
            if (loading) {
                button.dataset.originalText = button.textContent;
                button.classList.add('btn-loading');
                button.disabled = true;
                button.setAttribute('aria-busy', 'true');
            } else {
                button.classList.remove('btn-loading');
                button.disabled = false;
                button.textContent = button.dataset.originalText || button.textContent;
                button.removeAttribute('aria-busy');
            }
        }

        // ============================================
        // STREAMLINED NAVIGATION FUNCTIONS
        // ============================================

        /**
         * Smooth scroll to calculator section
         */
        function smoothScrollToCalculator(event) {
            event.preventDefault();
            const calculator = document.getElementById('calculator');
            if (calculator) {
                calculator.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Focus the first interactive element for accessibility
                setTimeout(() => {
                    const firstInput = calculator.querySelector('input, button, select');
                    if (firstInput) firstInput.focus();
                }, 500);
            }
        }

        /**
         * Switch between Deli and PB&J calculator panels
         * @param {string} type - 'deli' or 'pbj'
         */
        function switchSandwichType(type) {
            const deliPanel = document.getElementById('deli-calculator-panel');
            const pbjPanel = document.getElementById('pbj-calculator-panel');
            const deliTab = document.getElementById('deli-tab');
            const pbjTab = document.getElementById('pbj-tab');
            const shoppingNotes = document.getElementById('deli-shopping-notes');
            const deliRecipe = document.getElementById('deli-recipe-section');
            const pbjRecipe = document.getElementById('pbj-recipe-section');

            if (type === 'deli') {
                // Show deli, hide PB&J
                deliPanel.style.display = 'block';
                pbjPanel.style.display = 'none';
                deliTab.classList.add('active');
                deliTab.setAttribute('aria-selected', 'true');
                pbjTab.classList.remove('active');
                pbjTab.setAttribute('aria-selected', 'false');
                shoppingNotes.style.display = 'block';
                // Toggle recipe sections
                if (deliRecipe) deliRecipe.style.display = 'block';
                if (pbjRecipe) pbjRecipe.style.display = 'none';
            } else {
                // Show PB&J, hide deli
                deliPanel.style.display = 'none';
                pbjPanel.style.display = 'block';
                pbjTab.classList.add('active');
                pbjTab.setAttribute('aria-selected', 'true');
                deliTab.classList.remove('active');
                deliTab.setAttribute('aria-selected', 'false');
                shoppingNotes.style.display = 'none';
                // Toggle recipe sections
                if (deliRecipe) deliRecipe.style.display = 'none';
                if (pbjRecipe) pbjRecipe.style.display = 'block';
            }

            // Announce change for screen readers
            announceToScreenReader(`Switched to ${type === 'deli' ? 'Deli Meat' : 'Peanut Butter & Jelly'} calculator`);
        }

        /**
         * Toggle resource accordion sections
         * @param {HTMLElement} header - The accordion header element
         */
        function toggleAccordion(header) {
            const accordion = header.closest('.resource-accordion');
            const isOpen = accordion.classList.contains('open');

            // Close all other accordions (optional - remove for multi-open behavior)
            // document.querySelectorAll('.resource-accordion.open').forEach(acc => {
            //     if (acc !== accordion) acc.classList.remove('open');
            // });

            // Toggle current accordion
            accordion.classList.toggle('open');

            // Update ARIA
            header.setAttribute('aria-expanded', !isOpen);

            // Announce for screen readers
            const title = header.querySelector('.resource-accordion-title').textContent.trim();
            announceToScreenReader(`${title} section ${isOpen ? 'collapsed' : 'expanded'}`);
        }

        // Toggle spatula quantity input visibility
        function toggleSpatulaQuantity() {
            const checkbox = document.getElementById('includeSpatulas');
            const quantitySection = document.getElementById('spatulaQuantitySection');
            if (checkbox && quantitySection) {
                quantitySection.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // Initialize mode card selection on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial selected state on mode cards
            updateModeCardSelection();

            // Add keyboard support for mode cards
            document.querySelectorAll('.mode-card-improved').forEach(card => {
                card.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const radio = this.querySelector('input[type="radio"]');
                        if (radio) {
                            radio.checked = true;
                            updateCalculatorMode();
                        }
                    }
                });
            });
        });

        function updateModeCardSelection() {
            const mode = document.querySelector('input[name="calcMode"]:checked')?.value;
            const sandwichesCard = document.getElementById('mode-card-sandwiches');
            const budgetCard = document.getElementById('mode-card-budget');

            if (sandwichesCard && budgetCard) {
                if (mode === 'sandwiches') {
                    sandwichesCard.classList.add('selected');
                    sandwichesCard.setAttribute('aria-checked', 'true');
                    budgetCard.classList.remove('selected');
                    budgetCard.setAttribute('aria-checked', 'false');
                } else {
                    budgetCard.classList.add('selected');
                    budgetCard.setAttribute('aria-checked', 'true');
                    sandwichesCard.classList.remove('selected');
                    sandwichesCard.setAttribute('aria-checked', 'false');
                }
            }
        }

        // Package data for suggested packages (expanded with all brands)
        const packageData = {
            meat: {
                // Turkey options
                'kroger-turkey-family': { weightOz: 16, price: 4.39, name: 'Kroger Turkey Family Size', type: 'turkey' },
                'kroger-turkey-thin': { weightOz: 9, price: 3.99, name: 'Kroger Turkey Thin Sliced', type: 'turkey' },
                'publix-turkey': { weightOz: 16, price: 7.07, name: 'Publix Turkey Breast', type: 'turkey' },
                'kirkland-turkey': { weightOz: 32, price: 13.99, name: 'Kirkland Turkey', type: 'turkey' },
                'land-o-frost-turkey': { weightOz: 16, price: 9.53, name: "Land O'Frost Turkey", type: 'turkey' },
                'hillshire-turkey': { weightOz: 9, price: 6.07, name: 'Hillshire Farm Turkey', type: 'turkey' },
                'oscar-mayer-turkey': { weightOz: 32, price: 9.97, name: 'Oscar Mayer Turkey (Sam\'s Club)', type: 'turkey' },
                // Ham options
                'kirkland-ham': { slices: 48, price: 9.89, name: 'Kirkland Ham', type: 'ham' },
                'kroger-ham': { weightOz: 16, price: 4.99, name: 'Kroger Ham', type: 'ham' },
                'hillshire-ham': { weightOz: 9, price: 5.49, name: 'Hillshire Farm Ham', type: 'ham' },
                // Chicken options
                'kroger-chicken-thin': { weightOz: 9, price: 3.50, name: 'Kroger Chicken Thin', type: 'chicken' },
                'oscar-mayer-chicken-rotisserie': { weightOz: 16, price: 7.99, name: 'Oscar Mayer Rotisserie Chicken', type: 'chicken' },
                'oscar-mayer-chicken-blackened': { weightOz: 8, price: 4.49, name: 'Oscar Mayer Blackened Chicken', type: 'chicken' }
            },
            cheese: {
                // American cheese options
                'boars-head-american': { slices: 24, price: 8.99, name: "Boar's Head American" },
                'land-o-lakes-american': { slices: 24, price: 6.49, name: "Land O'Lakes American" },
                'sargento-american': { slices: 22, price: 4.99, name: 'Sargento Sliced American' },
                'great-value-american': { slices: 24, price: 3.98, name: 'Great Value American (Walmart)' },
                'kroger-american': { slices: 24, price: 4.29, name: 'Kroger Deli American' }
            },
            bread: {
                'natures-own-double': { sandwiches: 20, price: 4.49, name: "Nature's Own Double Loaf" },
                'sunbeam-single': { sandwiches: 10, price: 2.70, name: 'Sunbeam Single Loaf' },
                'sunbeam-double': { sandwiches: 20, price: 5.39, name: 'Sunbeam Double Loaf' }
            }
        };

        // Store selected package info
        let selectedPackages = {
            meat: null,
            cheese: null,
            bread: null
        };

        // Set calculator mode from external link (e.g., from "Which Calculator?" cards)
        function setCalculatorMode(mode) {
            // Set the radio button
            const radio = document.querySelector(`input[name="calcMode"][value="${mode}"]`);
            if (radio) {
                radio.checked = true;
                updateCalculatorMode();
            }
        }

        // Update calculator mode (sandwiches vs budget)
        function updateCalculatorMode() {
            const mode = document.querySelector('input[name="calcMode"]:checked').value;
            const targetLabel = document.getElementById('targetLabel');
            const targetHint = document.getElementById('targetHint');
            const calculatorTitle = document.getElementById('calculatorTitle');
            const targetInput = document.getElementById('targetValue');

            if (mode === 'sandwiches') {
                targetLabel.textContent = 'How many sandwiches do you need?';
                targetHint.textContent = 'We\'ll calculate the cost and shopping list for you';
                calculatorTitle.textContent = 'Enter Your Sandwich Details';
                if (targetInput) {
                    targetInput.placeholder = 'e.g., 100';
                    targetInput.setAttribute('aria-label', 'Number of sandwiches needed');
                }
            } else {
                targetLabel.textContent = 'What\'s your budget?';
                targetHint.textContent = 'We\'ll tell you how many sandwiches you can make';
                calculatorTitle.textContent = 'Enter Your Budget';
                if (targetInput) {
                    targetInput.placeholder = 'e.g., 500';
                    targetInput.setAttribute('aria-label', 'Budget in dollars');
                }
            }

            // Update mode card visual state
            updateModeCardSelection();

            // Announce mode change for screen readers
            announceToScreenReader(`Now calculating ${mode === 'sandwiches' ? 'cost for sandwiches' : 'sandwiches for budget'}`);

            validateInputs();
        }

        // Current selected meat type (null until user selects)
        let currentMeatType = null;

        // Select meat type (Turkey/Ham/Chicken tabs)
        function selectMeatType(type) {
            currentMeatType = type;

            // Update tab active states
            document.querySelectorAll('.meat-type-tab').forEach(tab => {
                const isActive = tab.dataset.meatType === type;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive);
            });

            // Filter dropdown options by type
            const select = document.getElementById('meatSelection');
            const options = select.querySelectorAll('option[data-type]');

            options.forEach(option => {
                const optionType = option.dataset.type;
                option.style.display = (optionType === type) ? '' : 'none';
            });

            // Show custom option when a meat type is selected
            const customOption = select.querySelector('option[value="custom"]');
            if (customOption) {
                customOption.style.display = '';
            }

            // Update placeholder text
            const placeholderOption = select.querySelector('option[value=""]');
            if (placeholderOption) {
                placeholderOption.textContent = 'Select a brand...';
            }

            // Reset selection when switching types
            select.value = '';
            selectedPackages.meat = null;
            document.getElementById('meatInfo').style.display = 'none';
            document.getElementById('meatCustomEntry').style.display = 'none';

            validateInputs();
            announceToScreenReader(`Showing ${type} options`);
        }

        // Handle meat selection
        function handleMeatSelection() {
            const selection = document.getElementById('meatSelection').value;
            const customEntry = document.getElementById('meatCustomEntry');
            const meatInfo = document.getElementById('meatInfo');
            const meatInfoText = document.getElementById('meatInfoText');

            if (selection === 'custom') {
                customEntry.style.display = 'block';
                selectedPackages.meat = null;
                meatInfo.style.display = 'none';
            } else if (selection && packageData.meat[selection]) {
                customEntry.style.display = 'none';
                const pkg = packageData.meat[selection];
                selectedPackages.meat = pkg;
                meatInfoText.textContent = `${pkg.name} - ${pkg.weightOz ? pkg.weightOz + ' oz' : pkg.slices + ' slices'}, $${pkg.price}`;
                meatInfo.style.display = 'block';
            } else {
                customEntry.style.display = 'none';
                selectedPackages.meat = null;
                meatInfo.style.display = 'none';
            }
            validateInputs();
        }

        // Handle cheese selection
        function handleCheeseSelection() {
            const selection = document.getElementById('cheeseSelection').value;
            const customEntry = document.getElementById('cheeseCustomEntry');
            const cheeseInfo = document.getElementById('cheeseInfo');
            const cheeseInfoText = document.getElementById('cheeseInfoText');

            if (selection === 'custom') {
                customEntry.style.display = 'block';
                selectedPackages.cheese = null;
                cheeseInfo.style.display = 'none';
            } else if (selection && packageData.cheese[selection]) {
                customEntry.style.display = 'none';
                const pkg = packageData.cheese[selection];
                selectedPackages.cheese = pkg;
                cheeseInfoText.textContent = `${pkg.name} - ${pkg.slices} slices, $${pkg.price}`;
                cheeseInfo.style.display = 'block';
            } else {
                customEntry.style.display = 'none';
                selectedPackages.cheese = null;
                cheeseInfo.style.display = 'none';
            }
            validateInputs();
        }

        // Handle bread selection
        function handleBreadSelection() {
            const selection = document.getElementById('breadSelection').value;
            const customEntry = document.getElementById('breadCustomEntry');
            const breadInfo = document.getElementById('breadInfo');
            const breadInfoText = document.getElementById('breadInfoText');

            if (selection === 'custom') {
                customEntry.style.display = 'block';
                selectedPackages.bread = null;
                breadInfo.style.display = 'none';
            } else if (selection && packageData.bread[selection]) {
                customEntry.style.display = 'none';
                const pkg = packageData.bread[selection];
                selectedPackages.bread = pkg;
                breadInfoText.textContent = `${pkg.name} - ${pkg.sandwiches} sandwiches, $${pkg.price}`;
                breadInfo.style.display = 'block';
            } else {
                customEntry.style.display = 'none';
                selectedPackages.bread = null;
                breadInfo.style.display = 'none';
            }
            validateInputs();
        }

        // API endpoint configuration
        // IMPORTANT: Since this site is on GitHub Pages (static hosting), the API must be deployed separately
        // The API is deployed to Vercel at the URL below
        const API_BASE = 'https://api-dusky-alpha.vercel.app';
        const LIVE_PRICE_ENDPOINT = API_BASE + '/api/live-prices';

        // Fetch live prices using AI-powered web search
        async function fetchLivePrices() {
            // Get both buttons and status divs (main calculator + pricing section)
            const btnMain = document.getElementById('refreshPricesBtnMain');
            const btnPricing = document.getElementById('refreshPricesBtn');
            const statusDivMain = document.getElementById('livePriceStatusMain');
            const statusDivPricing = document.getElementById('livePriceStatus');
            const updateStatus = document.getElementById('priceUpdateStatus');

            // Show loading state on both buttons
            [btnMain, btnPricing].forEach(btn => {
                if (btn) {
                    btn.disabled = true;
                    btn.innerHTML = '⏳ Searching...';
                }
            });

            // Show loading in main calculator status
            if (statusDivMain) {
                statusDivMain.style.display = 'block';
                statusDivMain.style.background = 'rgba(251, 173, 63, 0.2)';
                statusDivMain.innerHTML = '<div style="color: #92400e;">🔍 Using AI to search for current grocery prices... This may take a moment.</div>';
            }
            if (statusDivPricing) {
                statusDivPricing.style.display = 'block';
                statusDivPricing.style.background = 'rgba(0, 126, 140, 0.1)';
                statusDivPricing.innerHTML = '<div style="color: #007E8C;">🔍 Using AI to search for current grocery prices... This may take a moment.</div>';
            }

            try {
                const response = await fetch(LIVE_PRICE_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        products: [
                            // Meats
                            { name: 'Kroger Turkey Family Size deli meat 1 lb', category: 'meat', key: 'kroger-turkey-family' },
                            { name: 'Kirkland Turkey deli meat 2 pack', category: 'meat', key: 'kirkland-turkey' },
                            { name: 'Kirkland Ham deli meat 2 pack', category: 'meat', key: 'kirkland-ham' },
                            // American Cheeses
                            { name: 'Boars Head American cheese slices deli', category: 'cheese', key: 'boars-head-american' },
                            { name: 'Land O Lakes American cheese slices', category: 'cheese', key: 'land-o-lakes-american' },
                            { name: 'Sargento American cheese slices', category: 'cheese', key: 'sargento-american' },
                            { name: 'Great Value American cheese slices Walmart', category: 'cheese', key: 'great-value-american' },
                            { name: 'Kroger Deli American cheese slices', category: 'cheese', key: 'kroger-american' },
                            // Bread
                            { name: 'Natures Own bread double loaf', category: 'bread', key: 'natures-own-double' }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.prices) {
                    // Update the packageData with new prices
                    let updatedCount = 0;
                    for (const [key, priceInfo] of Object.entries(result.prices)) {
                        if (priceInfo.price && priceInfo.confidence > 0.6) {
                            // Find and update the price in packageData
                            for (const category of ['meat', 'cheese', 'bread']) {
                                if (packageData[category] && packageData[category][key]) {
                                    packageData[category][key].price = priceInfo.price;
                                    updatedCount++;
                                }
                            }
                        }
                    }

                    // Show success message
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                    if (updateStatus) {
                        updateStatus.innerHTML = `✅ Prices updated at ${timeStr} • <span style="font-size: 0.85em;">${updatedCount} products refreshed</span>`;
                    }

                    const successMsg = `
                        <div style="color: #166534; font-weight: 600;">✅ Live prices fetched successfully!</div>
                        <div style="color: #555; font-size: 0.9em; margin-top: 5px;">
                            Updated ${updatedCount} product prices. Prices may vary by location.
                        </div>
                    `;

                    if (statusDivMain) {
                        statusDivMain.style.background = 'rgba(34, 197, 94, 0.2)';
                        statusDivMain.innerHTML = successMsg;
                    }
                    if (statusDivPricing) {
                        statusDivPricing.style.background = 'rgba(46, 125, 50, 0.15)';
                        statusDivPricing.innerHTML = successMsg;
                    }

                    // Update displayed price cards (refresh the UI)
                    updatePriceDisplays(result.prices);

                    // Hide status after 8 seconds
                    setTimeout(() => {
                        if (statusDivMain) statusDivMain.style.display = 'none';
                        if (statusDivPricing) statusDivPricing.style.display = 'none';
                    }, 8000);
                } else {
                    throw new Error(result.error || 'Failed to fetch live prices');
                }
            } catch (error) {
                console.error('Live price fetch error:', error);
                const errorMsg = `
                    <div style="color: #dc2626; font-weight: 600;">⚠️ Could not fetch live prices</div>
                    <div style="color: #555; font-size: 0.9em; margin-top: 5px;">
                        Using stored prices. Error: ${error.message}
                    </div>
                `;
                if (statusDivMain) {
                    statusDivMain.style.background = 'rgba(239, 68, 68, 0.15)';
                    statusDivMain.innerHTML = errorMsg;
                }
                if (statusDivPricing) {
                    statusDivPricing.style.background = 'rgba(211, 47, 47, 0.1)';
                    statusDivPricing.innerHTML = errorMsg;
                }
            } finally {
                // Reset both buttons
                if (btnMain) {
                    btnMain.disabled = false;
                    btnMain.innerHTML = '🔄 Update Prices with AI';
                }
                if (btnPricing) {
                    btnPricing.disabled = false;
                    btnPricing.innerHTML = '🔄 Refresh Prices with AI';
                }
            }
        }

        // Update price display cards with new prices
        function updatePriceDisplays(prices) {
            // This function updates the visible price cards in the UI
            // For each price received, find and update the corresponding card
            for (const [key, priceInfo] of Object.entries(prices)) {
                if (priceInfo.price) {
                    // Update the dropdown options
                    const selects = document.querySelectorAll('select option');
                    selects.forEach(option => {
                        if (option.value === key) {
                            // Parse and update the price in the option text
                            const currentText = option.textContent;
                            const priceMatch = currentText.match(/\$[\d.]+/);
                            if (priceMatch) {
                                option.textContent = currentText.replace(priceMatch[0], '$' + priceInfo.price.toFixed(2));
                            }
                        }
                    });
                }
            }
        }
        const API_ENDPOINT = API_BASE + '/api/parse-package';

        // Parse package text using GPT-4 API
        async function parseMeatPackage() {
            const textInput = document.getElementById('meatCustomText');
            const text = textInput.value.trim();
            const parseButton = event.target;

            if (!text) {
                showInlineFeedback(textInput, 'Please enter a package description.', 'warning');
                return;
            }

            // Show loading state with spinner
            setButtonLoading(parseButton, true);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        ingredientType: 'meat'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.data) {
                    const data = result.data;

                    // Populate fields based on extracted data
                    if (data.weight_oz !== null) {
                        document.getElementById('meatWeightOz').value = data.weight_oz;
                    }
                    if (data.price_usd !== null) {
                        document.getElementById('meatPrice').value = data.price_usd;
                    }

                    // Show success message with confidence (inline)
                    const confidence = (data.confidence * 100).toFixed(0);
                    showInlineFeedback(textInput, `Package info extracted (${confidence}% confidence). Please verify values.`, 'success', 8000);

                    // Trigger validation
                    validateInputs();
                } else {
                    throw new Error(result.error || 'Failed to extract package information');
                }
            } catch (error) {
                console.error('Error parsing package:', error);
                showInlineFeedback(textInput, `Could not parse automatically. Please enter values manually.`, 'error', 8000);
            } finally {
                setButtonLoading(parseButton, false);
            }
        }

        async function parseCheesePackage() {
            const textInput = document.getElementById('cheeseCustomText');
            const text = textInput.value.trim();
            const parseButton = event.target;

            if (!text) {
                showInlineFeedback(textInput, 'Please enter a package description.', 'warning');
                return;
            }

            // Show loading state with spinner
            setButtonLoading(parseButton, true);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        ingredientType: 'cheese'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.data) {
                    const data = result.data;

                    // Populate fields based on extracted data
                    if (data.slices !== null) {
                        document.getElementById('cheeseSlices').value = data.slices;
                    }
                    if (data.price_usd !== null) {
                        document.getElementById('cheesePrice').value = data.price_usd;
                    }

                    // Show success message with confidence (inline)
                    const confidence = (data.confidence * 100).toFixed(0);
                    showInlineFeedback(textInput, `Package info extracted (${confidence}% confidence). Please verify values.`, 'success', 8000);

                    // Trigger validation
                    validateInputs();
                } else {
                    throw new Error(result.error || 'Failed to extract package information');
                }
            } catch (error) {
                console.error('Error parsing package:', error);
                showInlineFeedback(textInput, `Could not parse automatically. Please enter values manually.`, 'error', 8000);
            } finally {
                setButtonLoading(parseButton, false);
            }
        }

        async function parseBreadPackage() {
            const textInput = document.getElementById('breadCustomText');
            const text = textInput.value.trim();
            const parseButton = event.target;

            if (!text) {
                showInlineFeedback(textInput, 'Please enter a package description.', 'warning');
                return;
            }

            // Show loading state with spinner
            setButtonLoading(parseButton, true);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        ingredientType: 'bread'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.data) {
                    const data = result.data;

                    // Populate fields based on extracted data
                    if (data.sandwiches_per_package !== null) {
                        document.getElementById('breadSandwiches').value = data.sandwiches_per_package;
                    }
                    if (data.price_usd !== null) {
                        document.getElementById('breadPrice').value = data.price_usd;
                    }

                    // Show success message with confidence (inline)
                    const confidence = (data.confidence * 100).toFixed(0);
                    showInlineFeedback(textInput, `Package info extracted (${confidence}% confidence). Please verify values.`, 'success', 8000);

                    // Trigger validation
                    validateInputs();
                } else {
                    throw new Error(result.error || 'Failed to extract package information');
                }
            } catch (error) {
                console.error('Error parsing package:', error);
                showInlineFeedback(textInput, `Could not parse automatically. Please enter values manually.`, 'error', 8000);
            } finally {
                setButtonLoading(parseButton, false);
            }
        }

        // Validate inputs to enable/disable calculate button
        function validateInputs() {
            const targetValue = parseFloat(document.getElementById('targetValue').value);
            const calculateBtn = document.getElementById('calculateBtn');
            const hintDiv = document.getElementById('validationHint');
            const mode = document.querySelector('input[name="calcMode"]:checked')?.value || 'sandwiches';

            let missing = [];

            // Check if target value is valid
            if (!targetValue || targetValue <= 0) {
                if (mode === 'sandwiches') {
                    missing.push('number of sandwiches');
                } else {
                    missing.push('budget amount');
                }
            }

            // Check if meat type is selected first
            if (!currentMeatType) {
                missing.push('meat type (Turkey, Ham, or Chicken)');
            } else {
                // Check if meat brand is selected
                let hasMeat = selectedPackages.meat !== null ||
                             (document.getElementById('meatCustomEntry').style.display === 'block' &&
                              document.getElementById('meatWeightOz').value && document.getElementById('meatPrice').value);
                if (!hasMeat) {
                    missing.push('meat brand');
                }
            }

            let hasCheese = selectedPackages.cheese !== null ||
                           (document.getElementById('cheeseCustomEntry').style.display === 'block' &&
                            document.getElementById('cheeseSlices').value && document.getElementById('cheesePrice').value);
            if (!hasCheese) {
                missing.push('cheese');
            }

            let hasBread = selectedPackages.bread !== null ||
                          (document.getElementById('breadCustomEntry').style.display === 'block' &&
                           document.getElementById('breadSandwiches').value && document.getElementById('breadPrice').value);
            if (!hasBread) {
                missing.push('bread');
            }

            // Update button state and show/hide hint
            if (missing.length > 0) {
                calculateBtn.disabled = true;
                hintDiv.textContent = 'Still needed: ' + missing.join(', ');
                hintDiv.style.display = 'block';
            } else {
                calculateBtn.disabled = false;
                hintDiv.style.display = 'none';
            }
        }

        // Main calculation function (modularized)
        function calculateSimplified() {
            const mode = document.querySelector('input[name="calcMode"]:checked').value;
            const targetValue = parseFloat(document.getElementById('targetValue').value);
            const meatOzPerSandwich = parseFloat(document.getElementById('meatOzPerSandwich').value) || 2.5;
            const calcButton = document.getElementById('calculateBtn');

            // Get package info for each ingredient
            const meatPkg = getMeatPackageInfo();
            const cheesePkg = getCheesePackageInfo();
            const breadPkg = getBreadPackageInfo();

            if (!meatPkg || !cheesePkg || !breadPkg) {
                showFeedback('calcResult', 'Please complete all ingredient selections (meat, cheese, and bread).', 'warning');
                document.getElementById('calcResult').style.display = 'block';
                return;
            }
            
            // Calculate per-sandwich costs
            const meatCostPerSandwich = calculateMeatCostPerSandwich(meatPkg, meatOzPerSandwich);
            const cheeseCostPerSandwich = calculateCheeseCostPerSandwich(cheesePkg);
            const breadCostPerSandwich = calculateBreadCostPerSandwich(breadPkg);
            const bagCostPerSandwich = 7.99 / 480; // $7.99 for 480 bags
            
            const totalCostPerSandwich = meatCostPerSandwich + cheeseCostPerSandwich + breadCostPerSandwich + bagCostPerSandwich;
            
            let result;
            if (mode === 'sandwiches') {
                // Calculate cost for target sandwiches
                const totalCost = totalCostPerSandwich * targetValue;
                const quantities = calculateQuantities(targetValue, meatPkg, cheesePkg, breadPkg, meatOzPerSandwich);
                result = {
                    mode: 'cost',
                    targetSandwiches: targetValue,
                    totalCost: totalCost,
                    costPerSandwich: totalCostPerSandwich,
                    quantities: quantities
                };
            } else {
                // Calculate sandwiches for target budget
                const maxSandwiches = Math.floor(targetValue / totalCostPerSandwich);
                const actualCost = totalCostPerSandwich * maxSandwiches;
                const quantities = calculateQuantities(maxSandwiches, meatPkg, cheesePkg, breadPkg, meatOzPerSandwich);
                result = {
                    mode: 'budget',
                    budget: targetValue,
                    maxSandwiches: maxSandwiches,
                    actualCost: actualCost,
                    remaining: targetValue - actualCost,
                    costPerSandwich: totalCostPerSandwich,
                    quantities: quantities
                };
            }
            
            // Display results immediately
            displayResults(result);

            // Then validate with LLM in the background
            validateWithLLM(result, meatPkg, cheesePkg, breadPkg);
        }

        // LLM-Powered Calculator API endpoint
        const CALCULATE_API_ENDPOINT = API_BASE + '/api/calculate-sandwich-order';

        // Get LLM-powered insights for calculation results
        async function validateWithLLM(result, meatPkg, cheesePkg, breadPkg) {
            const validationContainer = document.getElementById('llmValidation');
            if (!validationContainer) return;

            // Show loading state
            validationContainer.innerHTML = `
                <div class="llm-validation loading">
                    <span class="spinner"></span>
                    <span>Getting smart insights for your order...</span>
                </div>
            `;
            validationContainer.style.display = 'block';

            try {
                // Determine values based on calculation mode
                const isBudgetMode = result.mode === 'budget';
                const totalSandwiches = isBudgetMode ? result.maxSandwiches : result.targetSandwiches;
                const totalCost = isBudgetMode ? result.actualCost : result.totalCost;

                const response = await fetch(CALCULATE_API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: isBudgetMode ? 'budget' : 'sandwiches',
                        targetValue: isBudgetMode ? result.budget : totalSandwiches,
                        sandwichType: 'deli',
                        meat: meatPkg,
                        cheese: cheesePkg,
                        bread: breadPkg
                    })
                });

                if (!response.ok) throw new Error('Calculator API error');

                const apiResult = await response.json();

                if (apiResult.success && apiResult.insights) {
                    displayLLMInsights(apiResult.insights);
                } else {
                    // Silently fail - don't show error for insights
                    validationContainer.style.display = 'none';
                }
            } catch (error) {
                console.error('LLM insights error:', error);
                // Silently fail - the calculation still works, insights are optional
                validationContainer.style.display = 'none';
            }
        }

        // Display LLM-powered insights
        function displayLLMInsights(insights) {
            const container = document.getElementById('llmValidation');
            if (!container) return;

            // Determine status class based on cost assessment
            let statusClass = 'valid';
            let statusIcon = '✓';
            if (insights.costAssessment === 'high') {
                statusClass = 'warning';
                statusIcon = '⚠';
            } else if (insights.costAssessment === 'great') {
                statusIcon = '🌟';
            }

            // Build warnings HTML
            let warningsHtml = '';
            if (insights.warnings && insights.warnings.length > 0) {
                warningsHtml = `
                    <div class="llm-warnings">
                        ${insights.warnings.map(w => `<div class="llm-warning-item">⚠️ ${w}</div>`).join('')}
                    </div>
                `;
            }

            // Build recommendations HTML
            let recommendationsHtml = '';
            if (insights.recommendations && insights.recommendations.length > 0) {
                recommendationsHtml = `
                    <div class="llm-tips">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1a4d66;">💡 Recommendations</div>
                        ${insights.recommendations.map(r => `<div class="llm-tip-item">• ${r}</div>`).join('')}
                    </div>
                `;
            }

            // Build waste reduction tip HTML
            let wasteHtml = '';
            if (insights.wasteReduction) {
                wasteHtml = `
                    <div class="llm-tip-item" style="background: #fef3c7; border-left: 3px solid #f59e0b; padding: 10px 12px; margin: 10px 0; border-radius: 0 6px 6px 0;">
                        ♻️ <strong>Reduce Waste:</strong> ${insights.wasteReduction}
                    </div>
                `;
            }

            // Build shopping tip HTML
            let shoppingHtml = '';
            if (insights.shoppingTip) {
                shoppingHtml = `
                    <div class="llm-tip-item" style="background: #e0f2fe; border-left: 3px solid #0ea5e9; padding: 10px 12px; margin: 10px 0; border-radius: 0 6px 6px 0;">
                        🛒 <strong>Shopping Tip:</strong> ${insights.shoppingTip}
                    </div>
                `;
            }

            // Build volunteer estimate HTML
            let volunteerHtml = '';
            if (insights.volunteerEstimate) {
                volunteerHtml = `
                    <div class="llm-tip-item" style="background: #f0fdf4; border-left: 3px solid #22c55e; padding: 10px 12px; margin: 10px 0; border-radius: 0 6px 6px 0;">
                        👥 <strong>Volunteer Estimate:</strong> ${insights.volunteerEstimate}
                    </div>
                `;
            }

            // Cost badge
            const costBadgeColors = {
                'great': { bg: '#dcfce7', text: '#166534', label: 'Great Value!' },
                'good': { bg: '#e0f2fe', text: '#0369a1', label: 'Good Value' },
                'fair': { bg: '#fef9c3', text: '#854d0e', label: 'Fair Value' },
                'high': { bg: '#fee2e2', text: '#991b1b', label: 'Higher Cost' }
            };
            const costBadge = costBadgeColors[insights.costAssessment] || costBadgeColors['good'];

            container.innerHTML = `
                <div class="llm-validation ${statusClass}">
                    <div class="llm-validation-header">
                        <span class="llm-status-icon">${statusIcon}</span>
                        <span class="llm-message">${insights.summary}</span>
                        <span style="margin-left: auto; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: 600; background: ${costBadge.bg}; color: ${costBadge.text};">${costBadge.label}</span>
                    </div>
                    ${warningsHtml}
                    ${wasteHtml}
                    ${recommendationsHtml}
                    ${shoppingHtml}
                    ${volunteerHtml}
                    ${insights.poweredByAI ? '<div style="text-align: right; font-size: 0.75em; color: #94a3b8; margin-top: 8px;">✨ Powered by AI</div>' : ''}
                </div>
            `;
            container.style.display = 'block';
        }

        // Modular helper functions
        function getMeatPackageInfo() {
            if (selectedPackages.meat) {
                return selectedPackages.meat;
            }
            const weightOz = parseFloat(document.getElementById('meatWeightOz').value);
            const price = parseFloat(document.getElementById('meatPrice').value);
            if (weightOz && price) {
                return { weightOz: weightOz, price: price, name: 'Custom Meat' };
            }
            return null;
        }

        function getCheesePackageInfo() {
            if (selectedPackages.cheese) {
                return selectedPackages.cheese;
            }
            const slices = parseInt(document.getElementById('cheeseSlices').value);
            const price = parseFloat(document.getElementById('cheesePrice').value);
            if (slices && price) {
                return { slices: slices, price: price, name: 'Custom Cheese' };
            }
            return null;
        }

        function getBreadPackageInfo() {
            if (selectedPackages.bread) {
                return selectedPackages.bread;
            }
            const sandwiches = parseInt(document.getElementById('breadSandwiches').value);
            const price = parseFloat(document.getElementById('breadPrice').value);
            if (sandwiches && price) {
                return { sandwiches: sandwiches, price: price, name: 'Custom Bread' };
            }
            return null;
        }

        function calculateMeatCostPerSandwich(meatPkg, ozPerSandwich) {
            if (meatPkg.weightOz) {
                // Weight-based calculation
                const sandwichesPerPackage = meatPkg.weightOz / ozPerSandwich;
                return meatPkg.price / sandwichesPerPackage;
            } else if (meatPkg.slices) {
                // Slice-based calculation (fallback)
                const sandwichesPerPackage = meatPkg.slices / 3; // 3 slices per sandwich
                return meatPkg.price / sandwichesPerPackage;
            }
            return 0;
        }

        function calculateCheeseCostPerSandwich(cheesePkg) {
            const sandwichesPerPackage = cheesePkg.slices / 2; // 2 slices per sandwich
            return cheesePkg.price / sandwichesPerPackage;
        }

        function calculateBreadCostPerSandwich(breadPkg) {
            return breadPkg.price / breadPkg.sandwiches;
        }

        function calculateQuantities(targetSandwiches, meatPkg, cheesePkg, breadPkg, meatOzPerSandwich) {
            let meatPackages, cheesePackages, breadPackages;
            
            if (meatPkg.weightOz) {
                const sandwichesPerMeatPackage = meatPkg.weightOz / meatOzPerSandwich;
                meatPackages = Math.ceil(targetSandwiches / sandwichesPerMeatPackage);
            } else {
                const sandwichesPerMeatPackage = meatPkg.slices / 3;
                meatPackages = Math.ceil(targetSandwiches / sandwichesPerMeatPackage);
            }
            
            const sandwichesPerCheesePackage = cheesePkg.slices / 2;
            cheesePackages = Math.ceil(targetSandwiches / sandwichesPerCheesePackage);
            
            breadPackages = Math.ceil(targetSandwiches / breadPkg.sandwiches);
            
            const bagPackages = Math.ceil(targetSandwiches / 480);
            
            return {
                meat: meatPackages,
                cheese: cheesePackages,
                bread: breadPackages,
                bags: bagPackages,
                meatCost: meatPackages * meatPkg.price,
                cheeseCost: cheesePackages * cheesePkg.price,
                breadCost: breadPackages * breadPkg.price,
                bagCost: bagPackages * 7.99
            };
        }

        function displayResults(result) {
            const resultDiv = document.getElementById('calcResult');
            resultDiv.style.display = 'block';
            resultDiv.setAttribute('role', 'region');
            resultDiv.setAttribute('aria-label', 'Calculation results');

            // Announce results to screen readers
            const announcementText = result.mode === 'cost'
                ? `Calculation complete. ${result.targetSandwiches} sandwiches will cost approximately $${result.totalCost.toFixed(2)}`
                : `Calculation complete. With $${result.budget}, you can make ${result.maxSandwiches} sandwiches`;
            announceToScreenReader(announcementText);

            let html = '<div class="result-grid">';
            
            if (result.mode === 'cost') {
                html += `<div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center;">
                    <p style="color: #1B5E20; margin: 0; font-size: 1.1em; font-weight: 600;">
                        <strong>${result.targetSandwiches} sandwiches</strong> will cost approximately <strong>$${result.totalCost.toFixed(2)}</strong>
                    </p>
                </div>`;
            } else {
                html += `<div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center;">
                    <p style="color: #1B5E20; margin: 0; font-size: 1.1em; font-weight: 600;">
                        With <strong>$${result.budget}</strong>, you can make <strong>${result.maxSandwiches} sandwiches</strong> for <strong>$${result.actualCost.toFixed(2)}</strong>
                        ${result.remaining > 0 ? `($${result.remaining.toFixed(2)} remaining)` : ''}
                    </p>
                </div>`;
            }
            
            html += `
                <div class="result-item">
                    <h4>Meat</h4>
                    <div class="number">${result.quantities.meat}<span style="font-size: 0.4em; font-weight: 500; margin-left: 4px;">packages</span></div>
                    <div class="description">$${result.quantities.meatCost.toFixed(2)}</div>
                </div>
                <div class="result-item">
                    <h4>Cheese</h4>
                    <div class="number">${result.quantities.cheese}<span style="font-size: 0.4em; font-weight: 500; margin-left: 4px;">packages</span></div>
                    <div class="description">$${result.quantities.cheeseCost.toFixed(2)}</div>
                </div>
                <div class="result-item">
                    <h4>Bread</h4>
                    <div class="number">${result.quantities.bread}<span style="font-size: 0.4em; font-weight: 500; margin-left: 4px;">packages</span></div>
                    <div class="description">$${result.quantities.breadCost.toFixed(2)}</div>
                </div>
                <div class="result-item">
                    <h4>Total</h4>
                    <div class="number">$${(result.mode === 'cost' ? result.totalCost : result.actualCost).toFixed(2)}</div>
                    <div class="description">${result.mode === 'cost' ? result.targetSandwiches : result.maxSandwiches} sandwiches</div>
                </div>
            </div>`;
            
            html += `<div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <p style="color: rgba(255,255,255,0.95); margin: 0; font-size: 0.95em;">
                    <strong>Summary:</strong> You'll need ${result.quantities.meat} package${result.quantities.meat > 1 ? 's' : ''} of meat, 
                    ${result.quantities.cheese} package${result.quantities.cheese > 1 ? 's' : ''} of cheese, 
                    and ${result.quantities.bread} loaf${result.quantities.bread > 1 ? 'ves' : ''} of bread 
                    for ${result.mode === 'cost' ? result.targetSandwiches : result.maxSandwiches} sandwiches. 
                    Estimated total cost: $${(result.mode === 'cost' ? result.totalCost : result.actualCost).toFixed(2)}.
                </p>
            </div>`;
            
            resultDiv.innerHTML = html;
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Add event listeners for custom entry validation
        document.addEventListener('DOMContentLoaded', function() {
            ['meatWeightOz', 'meatPrice', 'cheeseSlices', 'cheesePrice', 'breadSandwiches', 'breadPrice'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', validateInputs);
                }
            });

            // Also validate when target value changes
            const targetInput = document.getElementById('targetValue');
            if (targetInput) {
                targetInput.addEventListener('input', validateInputs);
            }

            // Initial validation to show what's needed
            validateInputs();
        });
        
        // Handle custom ingredient selection from Interactive Calculator
        function handleIngredientSelection(ingredientType, value) {
            if (value !== 'custom') return;
            
            // Store current Interactive Calculator values for pre-population
            const meatType = document.getElementById('meatType').value;
            const cheeseType = document.getElementById('cheeseType').value;
            const breadType = document.getElementById('breadType').value;
            const planMode = document.getElementById('planBySandwiches').checked ? 'sandwiches' : 'budget';
            const sandwichCount = document.getElementById('sandwichCount').value;
            const budgetAmount = document.getElementById('budgetAmount').value;
            
            // Store data for wizard pre-population
            window.interactiveCalcData = {
                customIngredient: ingredientType,
                planMode: planMode,
                sandwichCount: sandwichCount,
                budgetAmount: budgetAmount,
                meatType: meatType !== 'custom' ? meatType : null,
                cheeseType: cheeseType !== 'custom' ? cheeseType : null,
                breadType: breadType !== 'custom' ? breadType : null
            };
            
            // Scroll to custom calculator
            document.getElementById('custom-calculator').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Show a message
            setTimeout(() => {
                alert(`You selected a custom ${ingredientType} package. Scroll down to use the Custom Package Calculator, then click "Use This in Full Shopping Builder" to transfer your result. The Full Shopping Builder will be pre-populated with your other selected ingredients from the Interactive Calculator.`);
            }, 500);
        }

        // Pre-populate wizard from Interactive Calculator data
        function prePopulateWizardFromInteractive() {
            if (!window.interactiveCalcData) return;
            
            const data = window.interactiveCalcData;
            
            // Set planning mode
            if (data.planMode === 'sandwiches' && data.sandwichCount) {
                document.getElementById('wizardPlanBySandwiches').checked = true;
                document.getElementById('wizardTargetSandwiches').value = data.sandwichCount;
            } else if (data.planMode === 'budget' && data.budgetAmount) {
                document.getElementById('wizardPlanByBudget').checked = true;
                document.getElementById('wizardBudgetAmount').value = data.budgetAmount;
            }
            updateWizardStep1();
            
            // Pre-populate meat if it's not the custom ingredient
            if (data.customIngredient !== 'meat' && data.meatType) {
                const meatData = getIngredientData('meat', data.meatType);
                if (meatData) {
                    document.getElementById('wizardMeatSlices').value = meatData.slices;
                    document.getElementById('wizardMeatPrice').value = meatData.price;
                }
            }
            
            // Pre-populate cheese if it's not the custom ingredient
            if (data.customIngredient !== 'cheese' && data.cheeseType) {
                const cheeseData = getIngredientData('cheese', data.cheeseType);
                if (cheeseData) {
                    document.getElementById('wizardCheeseSlices').value = cheeseData.slices;
                    document.getElementById('wizardCheesePrice').value = cheeseData.price;
                }
            }
            
            // Pre-populate bread if it's not the custom ingredient
            if (data.customIngredient !== 'bread' && data.breadType) {
                const breadData = getIngredientData('bread', data.breadType);
                if (breadData) {
                    document.getElementById('wizardBreadSandwiches').value = breadData.sandwiches;
                    document.getElementById('wizardBreadPrice').value = breadData.price;
                }
            }
        }
        
        // Helper function to get ingredient data from Interactive Calculator
        function getIngredientData(type, value) {
            if (type === 'meat') {
                const meatData = {
                    'turkey': { slices: 40, price: 13.99 },
                    'ham': { slices: 48, price: 9.89 },
                    'publix-turkey': { slices: 32, price: 7.07 },
                    'land-o-frost-turkey': { slices: 32, price: 9.53 },
                    'hillshire-turkey': { slices: 18, price: 6.07 },
                    'kroger-turkey-regular': { slices: 12, price: 6.49 },
                    'kroger-turkey-thin': { slices: 18, price: 3.99 },
                    'kroger-chicken-thin': { slices: 18, price: 3.50 },
                    'kroger-turkey-family': { slices: 31, price: 4.39 },
                    'oscar-mayer-chicken-blackened': { slices: 12, price: 4.49 },
                    'oscar-mayer-chicken-rotisserie': { slices: 32, price: 7.99 }
                };
                return meatData[value] || null;
            } else if (type === 'cheese') {
                const cheeseData = {
                    'great-value-american': { slices: 24, price: 3.98 },
                    'kroger-american': { slices: 24, price: 4.29 },
                    'sargento-american': { slices: 22, price: 4.99 },
                    'land-o-lakes-american': { slices: 24, price: 6.49 },
                    'boars-head-american': { slices: 24, price: 8.99 }
                };
                return cheeseData[value] || null;
            } else if (type === 'bread') {
                const breadData = {
                    'natures-own-double': { sandwiches: 20, price: 4.49 },
                    'sunbeam-double': { sandwiches: 26, price: 5.39 },
                    'sunbeam-single': { sandwiches: 13, price: 2.70 },
                    'other-double': { sandwiches: 20, price: 5.39 },
                    'other-single': { sandwiches: 10, price: 2.70 }
                };
                return breadData[value] || null;
            }
            return null;
        }

        function calculateNeeds() {
            const bySandwiches = document.getElementById('planBySandwiches').checked;
            let sandwichCount;
            const meatType = document.getElementById('meatType').value;
            const cheeseType = document.getElementById('cheeseType').value;
            const breadType = document.getElementById('breadType').value;
            
            // Check if any ingredient is set to custom
            if (meatType === 'custom' || cheeseType === 'custom' || breadType === 'custom') {
                alert('You selected "Use Custom Package" for one or more ingredients. Please use the Custom Package Calculator below to calculate with custom packages.');
                return;
            }
            const meatAmount = parseInt(document.getElementById('meatAmount').value);

            // Ingredient constants - SLICE-BASED CALCULATION
            // Each sandwich uses: 2 slices bread, 2 slices cheese, and 3 slices meat (standard recipe)
            const meatSlicesPerSandwich = meatAmount; // Currently configured meat slices per sandwich (default: 3 slices standard recipe)
            const cheesePerSandwich = 2; // 2 slices per sandwich

            // Legacy oz-based variables kept for budget mode cost estimation
            // These are approximate and used for price calculations only
            const meatPerSandwichOz = meatSlicesPerSandwich * 0.5; // Rough estimate: ~0.5 oz per slice average

            // Package sizes and prices
            let meatPerPackage, meatPrice, meatDescription, meatPackageWeightOz;
            switch(meatType) {
                case 'turkey':
                    meatPerPackage = 40;
                    meatPrice = 13.99;
                    meatDescription = '2-packs (40 slices each)';
                    // Estimate: 40 slices at ~0.5 oz per slice = 20 oz per package, but it's a 2-pack so 40 oz total
                    meatPackageWeightOz = 40; // 2-pack, estimate 20 oz per pack
                    break;
                case 'ham':
                    meatPerPackage = 48;
                    meatPrice = 9.89;
                    meatDescription = '2-packs (48 slices each)';
                    // Estimate: 48 slices at ~0.5 oz per slice = 24 oz per package, but it's a 2-pack so 48 oz total
                    meatPackageWeightOz = 48; // 2-pack, estimate 24 oz per pack
                    break;
                case 'publix-turkey':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 7.07;
                    meatDescription = '16 oz packages (32 slices)';
                    meatPackageWeightOz = 16;
                    break;
                case 'land-o-frost-turkey':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 9.53;
                    meatDescription = '16 oz packages (32 slices)';
                    meatPackageWeightOz = 16;
                    break;
                case 'hillshire-turkey':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 6.07;
                    meatDescription = '9 oz packages (18 slices)';
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-turkey-regular':
                    meatPerPackage = 11.5; // 8 oz = 11-12 slices average (0.7 oz per slice)
                    meatPrice = 6.49;
                    meatDescription = '8 oz packages (11-12 slices)';
                    meatPackageWeightOz = 8;
                    break;
                case 'kroger-turkey-thin':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 3.99;
                    meatDescription = '9 oz packages (18 slices)';
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-chicken-thin':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 3.50;
                    meatDescription = '9 oz packages (18 slices)';
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-turkey-family':
                    meatPerPackage = 31; // 16 oz (1 lb) = 30-32 slices average (0.5 oz per slice)
                    meatPrice = 4.39;
                    meatDescription = '1 lb packages (30-32 slices)';
                    meatPackageWeightOz = 16; // 1 lb = 16 oz
                    break;
                case 'oscar-mayer-chicken-blackened':
                    meatPerPackage = 11.5; // 8 oz = 11-12 slices average (0.7 oz per slice)
                    meatPrice = 4.49;
                    meatDescription = '8 oz packages (11-12 slices)';
                    meatPackageWeightOz = 8;
                    break;
                case 'oscar-mayer-chicken-rotisserie':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 7.99;
                    meatDescription = '16 oz packages (32 slices)';
                    meatPackageWeightOz = 16;
                    break;
                default:
                    meatPerPackage = 40;
                    meatPrice = 13.99;
                    meatDescription = 'packages';
                    meatPackageWeightOz = 20; // Default estimate
            }
            const bagPrice = 7.99;
            let cheesePerPackage, cheesePrice, cheeseDescription;
            switch(cheeseType) {
                case 'great-value-american':
                    cheesePerPackage = 24;
                    cheesePrice = 3.98;
                    cheeseDescription = '24 slices each';
                    break;
                case 'kroger-american':
                    cheesePerPackage = 24;
                    cheesePrice = 4.29;
                    cheeseDescription = '24 slices each';
                    break;
                case 'sargento-american':
                    cheesePerPackage = 22;
                    cheesePrice = 4.99;
                    cheeseDescription = '22 slices each';
                    break;
                case 'land-o-lakes-american':
                    cheesePerPackage = 24;
                    cheesePrice = 6.49;
                    cheeseDescription = '24 slices each';
                    break;
                case 'boars-head-american':
                    cheesePerPackage = 24;
                    cheesePrice = 8.99;
                    cheeseDescription = '24 slices each';
                    break;
                default:
                    cheesePerPackage = 24;
                    cheesePrice = 3.98;
                    cheeseDescription = '24 slices each';
            }
            let breadSandwichesPerPackage, breadDescription, breadPrice;
            switch(breadType) {
                case 'natures-own-double':
                    breadSandwichesPerPackage = 20;
                    breadDescription = 'double loaves (20 sandwiches each)';
                    breadPrice = 4.49;
                    break;
                case 'sunbeam-double':
                    breadSandwichesPerPackage = 26;
                    breadDescription = 'double loaves (26 sandwiches each)';
                    breadPrice = 5.39;
                    break;
                case 'sunbeam-single':
                    breadSandwichesPerPackage = 13;
                    breadDescription = 'single loaves (13 sandwiches each)';
                    breadPrice = 2.70;
                    break;
                case 'other-double':
                    breadSandwichesPerPackage = 20;
                    breadDescription = 'double loaves (20 sandwiches each)';
                    breadPrice = 5.39;
                    break;
                case 'other-single':
                    breadSandwichesPerPackage = 10;
                    breadDescription = 'single loaves (10 sandwiches each)';
                    breadPrice = 2.70;
                    break;
                default:
                    breadSandwichesPerPackage = 20;
                    breadDescription = 'packages';
                    breadPrice = 5.39;
            }

            // Validation for ingredient selections
            if (!meatType) {
                alert('Please select a meat type');
                return;
            }
            if (!cheeseType) {
                alert('Please select a cheese type');
                return;
            }
            if (!breadType) {
                alert('Please select a bread type');
                return;
            }

            if (bySandwiches) {
                sandwichCount = parseInt(document.getElementById('sandwichCount').value);
                if (!sandwichCount || sandwichCount <= 0) {
                    alert('Please enter a valid number of sandwiches');
                    return;
                }
            } else {
                const budget = parseFloat(document.getElementById('budgetAmount').value);
                if (!budget) {
                    alert('Please enter a budget amount');
                    return;
                }
                // Estimate max sandwiches for this budget
                // Cost per sandwich = (meat + cheese + bread + bag) per sandwich
                // Calculate sandwiches per package based on SLICES (not weight)
                const sandwichesPerMeatPackage = meatPerPackage / meatSlicesPerSandwich;
                const meatCostPerSandwich = meatPrice / sandwichesPerMeatPackage;
                const cheeseCostPerSandwich = cheesePrice / (cheesePerPackage / cheesePerSandwich);
                const breadCostPerSandwich = breadPrice / breadSandwichesPerPackage;
                const bagCostPerSandwich = bagPrice / 480;
                const totalCostPerSandwich = meatCostPerSandwich + cheeseCostPerSandwich + breadCostPerSandwich + bagCostPerSandwich;
                sandwichCount = Math.floor(budget / totalCostPerSandwich);
                if (sandwichCount < 1) {
                    alert('Budget too low for even 1 sandwich with selected ingredients.');
                    return;
                }
                
            }


            // Calculate packages needed
            let meatPackages, cheesePackages, breadPackages, bagPackages;
            let meatCost, cheeseCost, breadCost, bagCost, totalCost;
            
            // For budget mode, we need to ensure we stay within budget
            if (!bySandwiches) {
                const budget = parseFloat(document.getElementById('budgetAmount').value);

                // Use binary search to find the optimal sandwich count within budget
                let low = 1;
                let high = Math.floor(budget / 0.50); // Assume minimum $0.50 per sandwich
                let bestSandwichCount = 1;

                while (low <= high) {
                    let mid = Math.floor((low + high) / 2);

                    // Calculate packages based on SLICES (fixes over-ordering bug)
                    const totalMeatSlicesNeeded = mid * meatSlicesPerSandwich;
                    meatPackages = Math.ceil(totalMeatSlicesNeeded / meatPerPackage);
                    cheesePackages = Math.ceil((mid * cheesePerSandwich) / cheesePerPackage);
                    breadPackages = Math.ceil(mid / breadSandwichesPerPackage);
                    bagPackages = Math.ceil(mid / 480);

                    meatCost = meatPackages * meatPrice;
                    cheeseCost = cheesePackages * cheesePrice;
                    breadCost = breadPackages * breadPrice;
                    bagCost = bagPackages * bagPrice;
                    totalCost = Math.round(meatCost + cheeseCost + breadCost + bagCost);

                    if (totalCost <= budget) {
                        bestSandwichCount = mid;
                        low = mid + 1;
                    } else {
                        high = mid - 1;
                    }
                }

                sandwichCount = bestSandwichCount;

                // Recalculate final costs with the adjusted count using SLICE-BASED calculation
                const totalMeatSlicesNeeded = sandwichCount * meatSlicesPerSandwich;
                meatPackages = Math.ceil(totalMeatSlicesNeeded / meatPerPackage);
                cheesePackages = Math.ceil((sandwichCount * cheesePerSandwich) / cheesePerPackage);
                breadPackages = Math.ceil(sandwichCount / breadSandwichesPerPackage);
                bagPackages = Math.ceil(sandwichCount / 480);

                meatCost = meatPackages * meatPrice;
                cheeseCost = cheesePackages * cheesePrice;
                breadCost = breadPackages * breadPrice;
                bagCost = bagPackages * bagPrice;
                totalCost = Math.round(meatCost + cheeseCost + breadCost + bagCost);
            } else {
                // For sandwich count mode, use SLICE-BASED calculation (fixes over-ordering bug)
                const totalMeatSlicesNeeded = sandwichCount * meatSlicesPerSandwich;
                meatPackages = Math.ceil(totalMeatSlicesNeeded / meatPerPackage);
                cheesePackages = Math.ceil((sandwichCount * cheesePerSandwich) / cheesePerPackage);
                breadPackages = Math.ceil(sandwichCount / breadSandwichesPerPackage);
                bagPackages = Math.ceil(sandwichCount / 480);

                meatCost = meatPackages * meatPrice;
                cheeseCost = cheesePackages * cheesePrice;
                breadCost = breadPackages * breadPrice;
                bagCost = bagPackages * bagPrice;
                totalCost = Math.round(meatCost + cheeseCost + breadCost + bagCost);
            }
            const coolersNeeded = Math.ceil(sandwichCount / 100);

            // Helper function to format package size nicely
            function formatPackageSize(oz) {
                if (oz >= 16) {
                    const lbs = Math.floor(oz / 16);
                    const remainingOz = oz % 16;
                    if (remainingOz === 0) {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'}`;
                    } else {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'} ${remainingOz} oz`;
                    }
                }
                return `${oz} oz`;
            }
            
            // Calculate excess ingredients (using SLICES for all calculations)
            const meatSlicesNeeded = sandwichCount * meatSlicesPerSandwich;
            const meatSlicesProvided = meatPackages * meatPerPackage;
            const cheeseNeeded = sandwichCount * cheesePerSandwich;
            const breadNeeded = sandwichCount;

            const cheeseProvided = cheesePackages * cheesePerPackage;
            const breadProvided = breadPackages * breadSandwichesPerPackage;

            // Calculate actual possible extra sandwiches (limited by the scarcest ingredient)
            const meatExcessSlices = meatSlicesProvided - meatSlicesNeeded;
            const cheeseExcess = cheeseProvided - cheeseNeeded;
            const breadExcess = breadProvided - breadNeeded;

            const possibleExtraFromMeat = Math.floor(meatExcessSlices / meatSlicesPerSandwich);
            const possibleExtraFromCheese = Math.floor(cheeseExcess / cheesePerSandwich);
            const possibleExtraFromBread = Math.floor(breadExcess); // 1 sandwich per extra bread slot

            const actualExtraSandwiches = Math.min(possibleExtraFromMeat, possibleExtraFromCheese, possibleExtraFromBread);

            // For budget mode, update the total sandwich count to include extra sandwiches
            let totalSandwichesPossible = sandwichCount;
            if (!bySandwiches && actualExtraSandwiches > 0) {
                totalSandwichesPossible = sandwichCount + actualExtraSandwiches;
            }

            // Create the result grid with budget status
            let budgetStatusMessage = '';
            if (!bySandwiches) {
                const budget = parseFloat(document.getElementById('budgetAmount').value);
                const remaining = budget - totalCost;
                const savingsPercent = Math.round((remaining / budget) * 100);
                
                // Add warning for tight budgets
                let tightBudgetWarning = '';
                if (budget <= 50) {
                    tightBudgetWarning = `
                        <p style="color: #E65100; margin-top: 12px; font-size: 1em; font-weight: 600;">
                            ⚠️ Note: Budgets under $50 are quite tight and yield limited quantities. Consider increasing your budget for better value and more sandwiches.
                        </p>
                    `;
                }
                
                if (remaining > 5) { // More than $5 remaining
                    budgetStatusMessage = `
                        <div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">✅</div>
                            <h4 style="color: #2E7D32; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Optimal Budget Planning!</h4>
                            <p style="color: #1B5E20; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost}</strong> | 
                                Remaining budget: <strong>$${remaining}</strong> (${savingsPercent}% under budget)
                            </p>
                            <p style="color: #2E7D32; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                This is the maximum number of sandwiches you can make within your $${budget} budget with your selected ingredients.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else if (remaining > 0) { // Small amount remaining
                    budgetStatusMessage = `
                        <div style="background: rgba(255,152,0,0.2); border: 3px solid #FF9800; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">⚠️</div>
                            <h4 style="color: #E65100; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Budget Optimized!</h4>
                            <p style="color: #BF360C; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost}</strong> | 
                                Only <strong>$${remaining}</strong> remaining (${savingsPercent}% under budget)
                            </p>
                            <p style="color: #E65100; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                This maximizes your sandwich count within your $${budget} budget.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else { // Exactly at budget
                    budgetStatusMessage = `
                        <div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">🎯</div>
                            <h4 style="color: #2E7D32; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Perfect Budget Match!</h4>
                            <p style="color: #1B5E20; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for exactly <strong>$${totalCost}</strong> | 
                                Uses your entire $${budget} budget
                            </p>
                            <p style="color: #2E7D32; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                This is the maximum number of sandwiches you can make with your selected ingredients and budget.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                }
            }
            
            // No longer showing excess ingredient details to maintain trust and professionalism

            // Format package description
            function formatPackageSize(oz) {
                if (oz >= 16) {
                    const lbs = Math.floor(oz / 16);
                    const remainingOz = oz % 16;
                    if (remainingOz === 0) {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'}`;
                    } else {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'} ${remainingOz} oz`;
                    }
                }
                return `${oz} oz`;
            }
            
            document.getElementById('calcResult').innerHTML = `
                ${budgetStatusMessage}
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Meat Packages</h4>
                        <div class="number">${meatPackages}</div>
                        <div class="description">${meatDescription} (${formatPackageSize(meatPackageWeightOz)} each)</div>
                    </div>
                    <div class="result-item">
                        <h4>Cheese Packages</h4>
                        <div class="number">${cheesePackages}</div>
                        <div class="description">${cheeseDescription}</div>
                    </div>
                    <div class="result-item">
                        <h4>Bread Packages</h4>
                        <div class="number">${breadPackages}</div>
                        <div class="description">${breadDescription}</div>
                    </div>
                    <div class="result-item">
                        <h4>Total Cost</h4>
                        <div class="number">$${totalCost}</div>
                        <div class="description">estimated retail pricing</div>
                    </div>
                </div>
            `;

            // Generate dynamic shopping checklist
            // Get meat type name for shopping list
            let meatTypeName;
            switch(meatType) {
                case 'turkey':
                    meatTypeName = 'Turkey';
                    break;
                case 'ham':
                    meatTypeName = 'Ham';
                    break;
                case 'publix-turkey':
                    meatTypeName = 'Publix Turkey Breast, Roasted, Thin Sliced';
                    break;
                case 'land-o-frost-turkey':
                    meatTypeName = 'Land O\'Frost Premium Oven Roasted Turkey Breast';
                    break;
                case 'hillshire-turkey':
                    meatTypeName = 'Hillshire Farm Ultra Thin Sliced Oven Roasted Turkey Breast';
                    break;
                case 'kroger-turkey-regular':
                    meatTypeName = 'Kroger Private Selection® Turkey Breast Oven Roasted Deli Sliced';
                    break;
                case 'kroger-turkey-thin':
                    meatTypeName = 'Kroger® Turkey Breast Oven Roasted Deli Thin Sliced';
                    break;
                case 'kroger-chicken-thin':
                    meatTypeName = 'Kroger® Chicken Breast Deli Thin Sliced';
                    break;
                case 'kroger-turkey-family':
                    meatTypeName = 'Kroger® Turkey Breast Oven Roasted Deli Thin Sliced Family Size';
                    break;
                case 'oscar-mayer-chicken-blackened':
                    meatTypeName = 'Oscar Mayer Deli Fresh Blackened Chicken Breast Thin Sliced Lunchmeat';
                    break;
                case 'oscar-mayer-chicken-rotisserie':
                    meatTypeName = 'Oscar Mayer Deli Fresh Rotisserie Seasoned Chicken Breast Thin Sliced Lunchmeat';
                    break;
                default:
                    meatTypeName = 'Meat';
            }
            
            // Create shopping description with package count
            const meatShoppingDescription = `${meatPackages} × ${meatTypeName} (${formatPackageSize(meatPackageWeightOz)} packages)`;
            let cheeseShoppingDescription;
            switch(cheeseType) {
                case 'great-value-american':
                    cheeseShoppingDescription = 'Great Value American Cheese slices (24 slices per package)';
                    break;
                case 'kroger-american':
                    cheeseShoppingDescription = 'Kroger Deli American Cheese slices (24 slices per package)';
                    break;
                case 'sargento-american':
                    cheeseShoppingDescription = 'Sargento Sliced American Cheese (22 slices per package)';
                    break;
                case 'land-o-lakes-american':
                    cheeseShoppingDescription = 'Land O\'Lakes American Cheese slices (24 slices per package)';
                    break;
                case 'boars-head-american':
                    cheeseShoppingDescription = 'Boar\'s Head American Cheese slices (24 slices per package)';
                    break;
                default:
                    cheeseShoppingDescription = 'American Cheese slices';
            }
            const estimatedLoaves = Math.ceil(sandwichCount / 20);
            const icePacksNeeded = Math.max(estimatedLoaves, coolersNeeded * 4);
            document.getElementById('shoppingChecklist').innerHTML = `
                <li><input type="checkbox"> ${meatShoppingDescription}</li>
                <li><input type="checkbox"> ${cheesePackages} × ${cheeseShoppingDescription}</li>
                <li><input type="checkbox"> ${breadPackages} × Bread ${breadDescription}</li>
                <li><input type="checkbox"> ${bagPackages} × Zip-lock sandwich bags (480 count)</li>
                <li><input type="checkbox"> ${icePacksNeeded} × Ice packs (enough to touch every loaf)</li>
                <li><input type="checkbox"> Food-safe disposable gloves (multiple boxes)</li>
                <li><input type="checkbox"> Hair ties/nets and beard nets</li>
                <li><input type="checkbox"> Hand soap</li>
                <li><input type="checkbox"> Paper towels for cleanup</li>
                <li><input type="checkbox"> Disinfecting wipes for surfaces</li>
            `;
            document.getElementById('calcResult').style.display = 'block';
            document.getElementById('shoppingList').style.display = 'block';
            document.getElementById('exportButton').style.display = 'block';
        }
        
        function generatePDF() {
            // Get form data
            const sandwichCount = parseInt(document.getElementById('sandwichCount').value);
            const meatType = document.getElementById('meatType');
            const cheeseType = document.getElementById('cheeseType');
            const breadType = document.getElementById('breadType');
            const meatAmount = parseInt(document.getElementById('meatAmount').value);
            
            const meatText = meatType.options[meatType.selectedIndex].text;
            const cheeseText = cheeseType.options[cheeseType.selectedIndex].text;
            const breadText = breadType.options[breadType.selectedIndex].text;
            
            // Calculate the results (same logic as in calculateNeeds) - SLICE-BASED
            const meatSlicesPerSandwich = meatAmount; // 3 slices (standard) or 2 slices (lighter)
            const cheesePerSandwich = 2;
            
            // Helper function to format package size nicely
            function formatPackageSize(oz) {
                if (oz >= 16) {
                    const lbs = Math.floor(oz / 16);
                    const remainingOz = oz % 16;
                    if (remainingOz === 0) {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'}`;
                    } else {
                        return `${lbs} ${lbs === 1 ? 'lb' : 'lbs'} ${remainingOz} oz`;
                    }
                }
                return `${oz} oz`;
            }
            
            // Get meat type name
            let meatTypeName;
            switch(meatType.value) {
                case 'turkey':
                    meatTypeName = 'Turkey';
                    break;
                case 'ham':
                    meatTypeName = 'Ham';
                    break;
                case 'publix-turkey':
                    meatTypeName = 'Publix Turkey Breast, Roasted, Thin Sliced';
                    break;
                case 'land-o-frost-turkey':
                    meatTypeName = 'Land O\'Frost Premium Oven Roasted Turkey Breast';
                    break;
                case 'hillshire-turkey':
                    meatTypeName = 'Hillshire Farm Ultra Thin Sliced Oven Roasted Turkey Breast';
                    break;
                case 'kroger-turkey-regular':
                    meatTypeName = 'Kroger Private Selection® Turkey Breast Oven Roasted Deli Sliced';
                    break;
                case 'kroger-turkey-thin':
                    meatTypeName = 'Kroger® Turkey Breast Oven Roasted Deli Thin Sliced';
                    break;
                case 'kroger-chicken-thin':
                    meatTypeName = 'Kroger® Chicken Breast Deli Thin Sliced';
                    break;
                case 'kroger-turkey-family':
                    meatTypeName = 'Kroger® Turkey Breast Oven Roasted Deli Thin Sliced Family Size';
                    break;
                case 'oscar-mayer-chicken-blackened':
                    meatTypeName = 'Oscar Mayer Deli Fresh Blackened Chicken Breast Thin Sliced Lunchmeat';
                    break;
                case 'oscar-mayer-chicken-rotisserie':
                    meatTypeName = 'Oscar Mayer Deli Fresh Rotisserie Seasoned Chicken Breast Thin Sliced Lunchmeat';
                    break;
                default:
                    meatTypeName = 'Meat';
            }
            let meatPerPackage, meatPrice, meatPackageWeightOz;
            switch(meatType.value) {
                case 'turkey':
                    meatPerPackage = 40;
                    meatPrice = 13.99;
                    meatPackageWeightOz = 40; // 2-pack, estimate 20 oz per pack
                    break;
                case 'ham':
                    meatPerPackage = 48;
                    meatPrice = 9.89;
                    meatPackageWeightOz = 48; // 2-pack, estimate 24 oz per pack
                    break;
                case 'publix-turkey':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 7.07;
                    meatPackageWeightOz = 16;
                    break;
                case 'land-o-frost-turkey':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 9.53;
                    meatPackageWeightOz = 16;
                    break;
                case 'hillshire-turkey':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 6.07;
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-turkey-regular':
                    meatPerPackage = 11.5; // 8 oz = 11-12 slices average (0.7 oz per slice)
                    meatPrice = 6.49;
                    meatPackageWeightOz = 8;
                    break;
                case 'kroger-turkey-thin':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 3.99;
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-chicken-thin':
                    meatPerPackage = 18; // 9 oz = 18 slices (0.5 oz per slice)
                    meatPrice = 3.50;
                    meatPackageWeightOz = 9;
                    break;
                case 'kroger-turkey-family':
                    meatPerPackage = 31; // 16 oz (1 lb) = 30-32 slices average (0.5 oz per slice)
                    meatPrice = 4.39;
                    meatPackageWeightOz = 16; // 1 lb = 16 oz
                    break;
                case 'oscar-mayer-chicken-blackened':
                    meatPerPackage = 11.5; // 8 oz = 11-12 slices average (0.7 oz per slice)
                    meatPrice = 4.49;
                    meatPackageWeightOz = 8;
                    break;
                case 'oscar-mayer-chicken-rotisserie':
                    meatPerPackage = 32; // 16 oz = 32 slices (0.5 oz per slice)
                    meatPrice = 7.99;
                    meatPackageWeightOz = 16;
                    break;
                default:
                    meatPerPackage = 40;
                    meatPrice = 13.99;
                    meatPackageWeightOz = 20; // Default estimate
            }
            
            let cheesePerPackage, cheesePrice;
            switch(cheeseType.value) {
                case 'great-value-american':
                    cheesePerPackage = 24;
                    cheesePrice = 3.98;
                    break;
                case 'kroger-american':
                    cheesePerPackage = 24;
                    cheesePrice = 4.29;
                    break;
                case 'sargento-american':
                    cheesePerPackage = 22;
                    cheesePrice = 4.99;
                    break;
                case 'land-o-lakes-american':
                    cheesePerPackage = 24;
                    cheesePrice = 6.49;
                    break;
                case 'boars-head-american':
                    cheesePerPackage = 24;
                    cheesePrice = 8.99;
                    break;
                default:
                    cheesePerPackage = 24;
                    cheesePrice = 3.98;
            }
            
            let breadSandwichesPerPackage, breadPrice;
            switch(breadType.value) {
                case 'natures-own-double':
                    breadSandwichesPerPackage = 20;
                    breadPrice = 4.49;
                    break;
                case 'sunbeam-double':
                    breadSandwichesPerPackage = 26;
                    breadPrice = 5.39;
                    break;
                case 'sunbeam-single':
                    breadSandwichesPerPackage = 13;
                    breadPrice = 2.70;
                    break;
                case 'other-double':
                    breadSandwichesPerPackage = 20;
                    breadPrice = 5.39;
                    break;
                case 'other-single':
                    breadSandwichesPerPackage = 10;
                    breadPrice = 2.70;
                    break;
                default:
                    breadSandwichesPerPackage = 20;
                    breadPrice = 5.39;
            }
            
            // Calculate packages based on SLICES (fixes over-ordering bug)
            const totalMeatSlicesNeeded = sandwichCount * meatSlicesPerSandwich;
            const meatPackages = Math.ceil(totalMeatSlicesNeeded / meatPerPackage);
            const cheesePackages = Math.ceil((sandwichCount * cheesePerSandwich) / cheesePerPackage);
            const breadPackages = Math.ceil(sandwichCount / breadSandwichesPerPackage);
            
            // meatPrice already defined above in the switch statement
            const bagPrice = 7.99;
            
            const meatCost = meatPackages * meatPrice;
            const cheeseCost = cheesePackages * cheesePrice;
            const breadCost = breadPackages * breadPrice;
            const bagCost = Math.ceil(sandwichCount / 480) * bagPrice;
            const totalCost = Math.round(meatCost + cheeseCost + breadCost + bagCost);
            const coolersNeeded = Math.ceil(sandwichCount / 100);
            
            // Create printable content
            const date = new Date().toLocaleDateString();
            const printContent = `
                <div class="pdf-content">
                    <div class="pdf-header">
                        <h1>🥪 TSP Sandwich Planning Guide</h1>
                        <h2>Shopping List & Budget Report</h2>
                        <p>Generated: ${date}</p>
                    </div>
                    
                    <div class="pdf-section">
                        <h3>Order Summary</h3>
                        <p><strong>Number of sandwiches:</strong> ${sandwichCount}</p>
                        <p><strong>Meat type:</strong> ${meatText}</p>
                        <p><strong>Cheese type:</strong> ${cheeseText}</p>
                        <p><strong>Bread type:</strong> ${breadText}</p>
                    </div>
                    
                    <div class="pdf-section">
                        <h3>Budget Summary</h3>
                        <div class="pdf-grid">
                            <div>
                                <p><strong>Meat packages needed:</strong> ${meatPackages} (${formatPackageSize(meatPackageWeightOz)} each)</p>
                                <p><strong>Cheese packages needed:</strong> ${cheesePackages}</p>
                                <p><strong>Bread packages needed:</strong> ${breadPackages}</p>
                            </div>
                            <div>
                                <p style="font-size: 18px; font-weight: bold; color: #236383;">
                                    Total estimated cost: $${totalCost}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pdf-section">
                        <h3>Shopping Checklist</h3>
                        <ul class="pdf-checklist">
                            <li>☐ ${meatPackages} × ${meatTypeName} (${formatPackageSize(meatPackageWeightOz)} packages)</li>
                            <li>☐ ${cheesePackages} × ${cheeseText.replace('🧀 ', '').split(' (')[0]} cheese slices</li>
                            <li>☐ ${breadPackages} × ${breadText.replace('🍞 ', '').split(' (')[0]}</li>
                            <li>☐ ${Math.ceil(sandwichCount / 480)} × Zip-lock sandwich bags (480 count)</li>
                            <li>☐ ${Math.max(Math.ceil(sandwichCount / 20), 4)} × Ice packs (enough to touch every loaf)</li>
                            <li>☐ Food-safe disposable gloves (multiple boxes)</li>
                            <li>☐ Hair ties/nets and beard nets</li>
                            <li>☐ Hand soap</li>
                            <li>☐ Paper towels for cleanup</li>
                            <li>☐ Disinfecting wipes for surfaces</li>
                        </ul>
                    </div>
                    
                    <div class="pdf-section">
                        <h3>Food Safety Reminders</h3>
                        <ul class="pdf-checklist">
                            <li>• Keep all ingredients refrigerated at 40°F or below</li>
                            <li>• Use disposable gloves and hair/beard nets</li>
                            <li>• Remove only 1 package of meat at a time from fridge</li>
                            <li>• Cool sandwiches in freezer 20-30 minutes before packing</li>
                            <li>• Never put warm sandwiches in coolers</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // Create a temporary element with the content
            const originalContent = document.body.innerHTML;
            document.body.innerHTML = printContent;
            
            // Add a print instruction
            window.alert('A print dialog will open. Please select "Save as PDF" or "Microsoft Print to PDF" as your printer destination to save as a PDF file.');
            
            // Open print dialog
            window.print();
            
            // Restore original content after print dialog closes
            setTimeout(() => {
                document.body.innerHTML = originalContent;
                // Reattach event listeners by recalculating if data is available
                const sandwichCountInput = document.getElementById('sandwichCount');
                if (sandwichCountInput && sandwichCountInput.value) {
                    // Just refresh the page to restore functionality
                    window.location.reload();
                }
            }, 1000);
        }

        function togglePlanMode() {
            const bySandwiches = document.getElementById('planBySandwiches').checked;
            document.getElementById('sandwichCountGroup').style.display = bySandwiches ? '' : 'none';
            document.getElementById('budgetGroup').style.display = bySandwiches ? 'none' : '';
        }

        function toggleCustomPlanMode() {
            const bySandwiches = document.getElementById('customPlanBySandwiches').checked;
            document.getElementById('customSandwichCountGroup').style.display = bySandwiches ? '' : 'none';
            document.getElementById('customBudgetGroup').style.display = bySandwiches ? 'none' : '';
        }

        // Update PB&J calculator mode (sandwiches vs budget)
        function updatePBJCalculatorMode() {
            const mode = document.querySelector('input[name="pbjCalcMode"]:checked').value;
            const targetLabel = document.getElementById('pbjTargetLabel');
            const targetHint = document.getElementById('pbjTargetHint');
            const targetInput = document.getElementById('pbjTargetValue');

            if (mode === 'sandwiches') {
                targetLabel.textContent = 'How many sandwiches do you need?';
                targetHint.textContent = "We'll calculate the cost and shopping list for you";
                if (targetInput) {
                    targetInput.placeholder = 'e.g., 100';
                    targetInput.setAttribute('aria-label', 'Number of sandwiches needed');
                }
            } else {
                targetLabel.textContent = "What's your budget?";
                targetHint.textContent = "We'll tell you how many sandwiches you can make";
                if (targetInput) {
                    targetInput.placeholder = 'e.g., 200';
                    targetInput.setAttribute('aria-label', 'Budget in dollars');
                }
            }

            // Update mode card visual state
            const sandwichCard = document.getElementById('pbj-mode-card-sandwiches');
            const budgetCard = document.getElementById('pbj-mode-card-budget');
            if (mode === 'sandwiches') {
                sandwichCard.setAttribute('aria-checked', 'true');
                budgetCard.setAttribute('aria-checked', 'false');
            } else {
                sandwichCard.setAttribute('aria-checked', 'false');
                budgetCard.setAttribute('aria-checked', 'true');
            }
        }

        function calculatePBJ() {
            const mode = document.querySelector('input[name="pbjCalcMode"]:checked').value;
            const targetValue = parseFloat(document.getElementById('pbjTargetValue').value);
            const pbType = document.getElementById('pbType').value;
            const jellyType = document.getElementById('jellyType').value;

            if (!targetValue || targetValue <= 0) {
                const hintDiv = document.getElementById('pbjValidationHint');
                hintDiv.textContent = mode === 'sandwiches' ? 'Please enter the number of sandwiches' : 'Please enter your budget';
                hintDiv.style.display = 'block';
                return;
            }

            // Hide validation hint
            document.getElementById('pbjValidationHint').style.display = 'none';

            // Constants
            const pbPerSandwich = 3; // 3 tbsp per sandwich
            const jellyPerSandwich = 1.5; // 1.5 tbsp per sandwich
            const breadSlicesPerSandwich = 2;
            const usableBreadSlicesPerLoaf = 20;
            const bagsPerBox = 480;
            const breadPrice = 2.70;
            const bagBoxPrice = 7.99;

            // Get peanut butter info
            const pbInfo = getPBInfo(pbType);
            const jellyInfo = getJellyInfo(jellyType);

            // Calculate cost per sandwich
            const pbCostPerSandwich = (pbPerSandwich / pbInfo.tbspPerJar) * pbInfo.price;
            const jellyCostPerSandwich = (jellyPerSandwich / jellyInfo.tbspPerJar) * jellyInfo.price;
            const breadCostPerSandwich = (breadSlicesPerSandwich / usableBreadSlicesPerLoaf) * breadPrice;
            const bagCostPerSandwich = bagBoxPrice / bagsPerBox;
            const totalCostPerSandwich = pbCostPerSandwich + jellyCostPerSandwich + breadCostPerSandwich + bagCostPerSandwich;

            let pbjCount, totalCost;

            if (mode === 'sandwiches') {
                // Calculate cost for target sandwiches
                pbjCount = Math.floor(targetValue);
                totalCost = pbjCount * totalCostPerSandwich;
            } else {
                // Calculate sandwiches for target budget
                pbjCount = Math.floor(targetValue / totalCostPerSandwich);
                totalCost = pbjCount * totalCostPerSandwich;
            }

            // Calculate quantities needed
            const totalPbTbsp = pbjCount * pbPerSandwich;
            const totalJellyTbsp = pbjCount * jellyPerSandwich;
            const totalBreadSlices = pbjCount * breadSlicesPerSandwich;

            const pbJarsNeeded = Math.ceil(totalPbTbsp / pbInfo.tbspPerJar);
            const jellyJarsNeeded = Math.ceil(totalJellyTbsp / jellyInfo.tbspPerJar);
            const breadLoavesNeeded = Math.ceil(totalBreadSlices / usableBreadSlicesPerLoaf);
            const bagBoxesNeeded = Math.ceil(pbjCount / bagsPerBox);

            // Calculate actual costs based on whole packages
            const pbCost = pbJarsNeeded * pbInfo.price;
            const jellyCost = jellyJarsNeeded * jellyInfo.price;
            const breadCost = breadLoavesNeeded * breadPrice;
            const bagCost = bagBoxesNeeded * bagBoxPrice;

            // Spatula calculation
            const includeSpatulas = document.getElementById('includeSpatulas').checked;
            const spatulaPackPrice = 5.99;
            const spatulasPerPack = 4;
            const spatulaPackCount = includeSpatulas ? Math.max(1, parseInt(document.getElementById('spatulaPackCount').value) || 1) : 0;
            const spatulaCost = spatulaPackCount * spatulaPackPrice;

            const actualTotalCost = Math.round((pbCost + jellyCost + breadCost + bagCost + spatulaCost) * 100) / 100;

            // Build result HTML
            let headerText, summaryText;
            if (mode === 'sandwiches') {
                headerText = 'Total Estimated Cost';
                summaryText = `for ${pbjCount} PB&J sandwiches<br>(≈ $${(actualTotalCost / pbjCount).toFixed(2)} per sandwich)`;
            } else {
                headerText = 'Sandwiches You Can Make';
                summaryText = `with your $${targetValue.toFixed(2)} budget<br>(actual cost: $${actualTotalCost.toFixed(2)}, remaining: $${(targetValue - actualTotalCost).toFixed(2)})`;
            }

            document.getElementById('pbjResult').innerHTML = `
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Peanut Butter</h4>
                        <div class="number">${pbJarsNeeded}</div>
                        <div class="description">${pbInfo.description}<br>(~${pbInfo.tbspPerJar} tbsp each)</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${pbCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Jelly</h4>
                        <div class="number">${jellyJarsNeeded}</div>
                        <div class="description">${jellyInfo.description}<br>(~${jellyInfo.tbspPerJar} tbsp each)</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${jellyCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Bread Loaves</h4>
                        <div class="number">${breadLoavesNeeded}</div>
                        <div class="description">single loaves<br>(${usableBreadSlicesPerLoaf} usable slices each)</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${breadCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Sandwich Bags</h4>
                        <div class="number">${bagBoxesNeeded}</div>
                        <div class="description">${bagsPerBox} count boxes</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${bagCost.toFixed(2)}</div>
                    </div>
                    ${includeSpatulas ? `
                    <div class="result-item" style="background: linear-gradient(135deg, rgba(251,173,63,0.3) 0%, rgba(163,28,65,0.2) 100%);">
                        <h4>Spreading Spatulas</h4>
                        <div class="number">${spatulaPackCount}</div>
                        <div class="description">${spatulasPerPack}-pack(s) (${spatulaPackCount * spatulasPerPack} spatulas total)</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${spatulaCost.toFixed(2)}</div>
                        <a href="https://www.amazon.com/4-Piece-Silicone-Jar-Spatula-Set/dp/B0FDGY1R58" target="_blank" rel="noopener noreferrer" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background: #FF9900; color: #111; font-weight: 600; text-decoration: none; border-radius: 6px; font-size: 0.85em;">Order on Amazon</a>
                    </div>
                    ` : ''}
                </div>
                <div style="margin-top: 25px; padding: 20px; background: rgba(251,173,63,0.2); border-radius: 12px; text-align: center;">
                    <h4 style="color: #fff; font-size: 1.4em; margin-bottom: 10px;">${headerText}</h4>
                    <div style="font-size: 3em; font-weight: 700; color: #fff;">${mode === 'sandwiches' ? '$' + actualTotalCost.toFixed(2) : pbjCount}</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-top: 8px;">
                        ${summaryText}
                    </div>
                </div>
            `;

            document.getElementById('pbjResult').style.display = 'block';

            // Get LLM insights for PB&J order
            validatePBJWithLLM({
                mode: mode,
                targetValue: targetValue,
                pbjCount: pbjCount,
                totalCost: actualTotalCost,
                costPerSandwich: actualTotalCost / pbjCount,
                pbInfo: pbInfo,
                jellyInfo: jellyInfo,
                quantities: {
                    pbJars: pbJarsNeeded,
                    jellyJars: jellyJarsNeeded,
                    breadLoaves: breadLoavesNeeded
                }
            });
        }

        // Get LLM insights for PB&J calculation
        async function validatePBJWithLLM(pbjResult) {
            const validationContainer = document.getElementById('pbjLlmValidation');
            if (!validationContainer) return;

            // Show loading state
            validationContainer.innerHTML = `
                <div class="llm-validation loading">
                    <span class="spinner"></span>
                    <span>Getting smart insights for your PB&J order...</span>
                </div>
            `;
            validationContainer.style.display = 'block';

            try {
                const response = await fetch(CALCULATE_API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: pbjResult.mode === 'sandwiches' ? 'sandwiches' : 'budget',
                        targetValue: pbjResult.targetValue,
                        sandwichType: 'pbj',
                        peanutButter: {
                            price: pbjResult.pbInfo.price,
                            servings: Math.floor(pbjResult.pbInfo.tbspPerJar / 3), // 3 tbsp per sandwich
                            name: pbjResult.pbInfo.description
                        },
                        jelly: {
                            price: pbjResult.jellyInfo.price,
                            servings: Math.floor(pbjResult.jellyInfo.tbspPerJar / 1.5), // 1.5 tbsp per sandwich
                            name: pbjResult.jellyInfo.description
                        },
                        bread: {
                            sandwiches: 10,
                            price: 2.70,
                            name: 'Bread'
                        }
                    })
                });

                if (!response.ok) throw new Error('Calculator API error');

                const apiResult = await response.json();

                if (apiResult.success && apiResult.insights) {
                    displayPBJLLMInsights(apiResult.insights);
                } else {
                    validationContainer.style.display = 'none';
                }
            } catch (error) {
                console.error('PB&J LLM insights error:', error);
                validationContainer.style.display = 'none';
            }
        }

        // Display LLM insights for PB&J
        function displayPBJLLMInsights(insights) {
            const container = document.getElementById('pbjLlmValidation');
            if (!container) return;

            // Use the same display function but target PB&J container
            let statusClass = 'valid';
            let statusIcon = '✓';
            if (insights.costAssessment === 'high') {
                statusClass = 'warning';
                statusIcon = '⚠';
            } else if (insights.costAssessment === 'great') {
                statusIcon = '🌟';
            }

            let warningsHtml = '';
            if (insights.warnings && insights.warnings.length > 0) {
                warningsHtml = `
                    <div class="llm-warnings">
                        ${insights.warnings.map(w => `<div class="llm-warning-item">⚠️ ${w}</div>`).join('')}
                    </div>
                `;
            }

            let recommendationsHtml = '';
            if (insights.recommendations && insights.recommendations.length > 0) {
                recommendationsHtml = `
                    <div class="llm-tips">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1a4d66;">💡 Recommendations</div>
                        ${insights.recommendations.map(r => `<div class="llm-tip-item">• ${r}</div>`).join('')}
                    </div>
                `;
            }

            let shoppingHtml = '';
            if (insights.shoppingTip) {
                shoppingHtml = `
                    <div class="llm-tip-item" style="background: #e0f2fe; border-left: 3px solid #0ea5e9; padding: 10px 12px; margin: 10px 0; border-radius: 0 6px 6px 0;">
                        🛒 <strong>Shopping Tip:</strong> ${insights.shoppingTip}
                    </div>
                `;
            }

            let volunteerHtml = '';
            if (insights.volunteerEstimate) {
                volunteerHtml = `
                    <div class="llm-tip-item" style="background: #f0fdf4; border-left: 3px solid #22c55e; padding: 10px 12px; margin: 10px 0; border-radius: 0 6px 6px 0;">
                        👥 <strong>Volunteer Estimate:</strong> ${insights.volunteerEstimate}
                    </div>
                `;
            }

            const costBadgeColors = {
                'great': { bg: '#dcfce7', text: '#166534', label: 'Great Value!' },
                'good': { bg: '#e0f2fe', text: '#0369a1', label: 'Good Value' },
                'fair': { bg: '#fef9c3', text: '#854d0e', label: 'Fair Value' },
                'high': { bg: '#fee2e2', text: '#991b1b', label: 'Higher Cost' }
            };
            const costBadge = costBadgeColors[insights.costAssessment] || costBadgeColors['good'];

            container.innerHTML = `
                <div class="llm-validation ${statusClass}">
                    <div class="llm-validation-header">
                        <span class="llm-status-icon">${statusIcon}</span>
                        <span class="llm-message">${insights.summary}</span>
                        <span style="margin-left: auto; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: 600; background: ${costBadge.bg}; color: ${costBadge.text};">${costBadge.label}</span>
                    </div>
                    ${warningsHtml}
                    ${recommendationsHtml}
                    ${shoppingHtml}
                    ${volunteerHtml}
                    ${insights.poweredByAI ? '<div style="text-align: right; font-size: 0.75em; color: #94a3b8; margin-top: 8px;">✨ Powered by AI</div>' : ''}
                </div>
            `;
            container.style.display = 'block';
        }

        // Helper function to get peanut butter info
        function getPBInfo(pbType) {
            const pbOptions = {
                'jif-40': { tbspPerJar: 75, price: 7.99, description: 'Jif Creamy 40 oz' },
                'skippy-40': { tbspPerJar: 75, price: 7.99, description: 'Skippy Creamy 40 oz' },
                'jif-16': { tbspPerJar: 30, price: 3.59, description: 'Jif Creamy 16 oz' },
                'skippy-16': { tbspPerJar: 31, price: 3.59, description: 'Skippy Creamy 16.3 oz' }
            };
            return pbOptions[pbType] || pbOptions['jif-40'];
        }

        // Helper function to get jelly info
        function getJellyInfo(jellyType) {
            const jellyOptions = {
                'smuckers-32': { tbspPerJar: 60, price: 4.99, description: "Smucker's Grape Jelly 32 oz" },
                'welchs-30': { tbspPerJar: 56, price: 3.59, description: "Welch's Grape Jelly 30 oz" },
                'smuckers-squeeze-20': { tbspPerJar: 38, price: 3.59, description: "Smucker's Squeeze Jelly 20 oz" },
                'welchs-squeeze-18': { tbspPerJar: 34, price: 3.83, description: "Welch's Squeeze Jelly 18 oz" }
            };
            return jellyOptions[jellyType] || jellyOptions['smuckers-32'];
        }

        // Custom Package Calculator - Toggle between slice count and oz/servings input
        // Custom Package Calculator - Update ingredient type
        function updateCustomIngredientType() {
            const ingredientType = document.querySelector('input[name="customIngredientType"]:checked').value;
            document.getElementById('customIngredientTypeValue').value = ingredientType;
            
            // Update slices per sandwich based on ingredient type
            let slicesPerSandwich, labelText, hintText, inputMethodLabel, inputMethodLabelOz;
            if (ingredientType === 'meat') {
                slicesPerSandwich = 3;
                labelText = 'Number of slices in package';
                hintText = 'Count the slices or check the label';
                inputMethodLabel = 'I can count the slices';
                inputMethodLabelOz = 'I only have oz/servings info';
            } else if (ingredientType === 'cheese') {
                slicesPerSandwich = 2;
                labelText = 'Number of slices in package';
                hintText = 'Count the slices or check the label';
                inputMethodLabel = 'I can count the slices';
                inputMethodLabelOz = 'I only have oz/servings info';
            } else { // bread
                slicesPerSandwich = 1; // Special case: bread uses sandwiches per package
                labelText = 'Number of sandwiches per bread package';
                hintText = 'A double loaf typically makes 20 sandwiches';
                inputMethodLabel = 'I know how many sandwiches this package makes';
                inputMethodLabelOz = 'I only have oz/weight info';
            }
            
            document.getElementById('customIngredientSlicesPerSandwich').value = slicesPerSandwich;
            document.getElementById('customPackageSlicesLabel').textContent = labelText;
            document.getElementById('customPackageSlicesHint').textContent = hintText;
            document.getElementById('customInputMethodLabel').textContent = inputMethodLabel;
            document.getElementById('customInputMethodLabelOz').textContent = inputMethodLabelOz;
            
            // For bread, hide oz input method (not applicable)
            if (ingredientType === 'bread') {
                document.querySelector('input[name="customInputMethod"][value="oz"]').parentElement.parentElement.style.display = 'none';
                document.querySelector('input[name="customInputMethod"][value="slices"]').checked = true;
                toggleCustomInputMethod();
            } else {
                document.querySelector('input[name="customInputMethod"][value="oz"]').parentElement.parentElement.style.display = 'flex';
            }
        }

        function toggleCustomInputMethod() {
            const method = document.querySelector('input[name="customInputMethod"]:checked').value;
            const ingredientType = document.querySelector('input[name="customIngredientType"]:checked').value;
            const sliceGroup = document.getElementById('sliceInputGroup');
            const ozGroup = document.getElementById('ozInputGroup');

            if (method === 'slices' || ingredientType === 'bread') {
                sliceGroup.style.display = 'flex';
                ozGroup.style.display = 'none';
            } else {
                sliceGroup.style.display = 'none';
                ozGroup.style.display = 'block';
            }
        }

        // Estimate slices from oz + thickness
        function estimateSlicesFromOz() {
            const packageOz = parseFloat(document.getElementById('customPackageOz').value);
            const thickness = document.getElementById('customSliceThickness').value;

            if (!packageOz || packageOz <= 0) {
                document.getElementById('sliceEstimate').style.display = 'none';
                return;
            }

            // Oz per slice based on thickness
            let ozPerSlice;
            switch (thickness) {
                case 'thin': ozPerSlice = 0.5; break;
                case 'regular': ozPerSlice = 0.75; break;
                case 'thick': ozPerSlice = 1.0; break;
                default: ozPerSlice = 0.5;
            }

            // Calculate estimated slices
            const estimatedSlices = Math.round(packageOz / ozPerSlice);

            // Show the estimate
            document.getElementById('estimatedSliceCount').textContent = estimatedSlices;
            document.getElementById('sliceEstimate').style.display = 'block';

            // Store the estimate for later use
            document.getElementById('sliceEstimate').dataset.estimate = estimatedSlices;
        }

        // Use the estimated slice count
        function useEstimatedSlices() {
            const estimate = document.getElementById('sliceEstimate').dataset.estimate;
            if (estimate) {
                document.getElementById('customPackageSlices').value = estimate;
                // Switch back to slice input method to show the value
                document.querySelector('input[name="customInputMethod"][value="slices"]').checked = true;
                toggleCustomInputMethod();
            }
        }

        // Add event listeners for oz estimation inputs
        document.addEventListener('DOMContentLoaded', function() {
            const ozInputs = ['customPackageOz', 'customSliceThickness'];
            ozInputs.forEach(function(id) {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', estimateSlicesFromOz);
                    element.addEventListener('change', estimateSlicesFromOz);
                }
            });
            
            // Initialize custom ingredient type
            if (document.querySelector('input[name="customIngredientType"]')) {
                updateCustomIngredientType();
            }
            
            // Check if we should pre-populate wizard from Interactive Calculator
            if (window.interactiveCalcData) {
                // Small delay to ensure wizard is rendered
                setTimeout(() => {
                    prePopulateWizardFromInteractive();
                }, 100);
            }
        });

        // Custom Package Calculator - Single Package
        function calculateCustomPackage() {
            const ingredientType = document.querySelector('input[name="customIngredientType"]:checked').value;
            const inputMethod = document.querySelector('input[name="customInputMethod"]:checked').value;
            let slicesInPackage;
            let ingredientName, ingredientIcon;

            if (ingredientType === 'bread') {
                // Bread uses sandwiches per package directly
                slicesInPackage = parseInt(document.getElementById('customPackageSlices').value);
                ingredientName = 'bread';
                ingredientIcon = '🍞';
            } else {
                if (inputMethod === 'slices') {
                    slicesInPackage = parseInt(document.getElementById('customPackageSlices').value);
                } else {
                    // Use oz-based estimation
                    const packageOz = parseFloat(document.getElementById('customPackageOz').value);
                    const thickness = document.getElementById('customSliceThickness').value;

                    if (!packageOz || packageOz <= 0) {
                        alert('Please enter the package weight in oz');
                        return;
                    }

                    let ozPerSlice;
                    switch (thickness) {
                        case 'thin': ozPerSlice = 0.5; break;
                        case 'regular': ozPerSlice = 0.75; break;
                        case 'thick': ozPerSlice = 1.0; break;
                        default: ozPerSlice = 0.5;
                    }
                    slicesInPackage = Math.round(packageOz / ozPerSlice);
                }
                
                if (ingredientType === 'meat') {
                    ingredientName = 'meat';
                    ingredientIcon = '🥩';
                } else {
                    ingredientName = 'cheese';
                    ingredientIcon = '🧀';
                }
            }

            const packagePrice = parseFloat(document.getElementById('customPackagePrice').value);
            const slicesPerSandwich = parseInt(document.getElementById('customIngredientSlicesPerSandwich').value);

            if (!slicesInPackage || slicesInPackage <= 0) {
                alert(ingredientType === 'bread' 
                    ? 'Please enter a valid number of sandwiches per package'
                    : 'Please enter a valid number of slices or package oz');
                return;
            }

            // For bread, slicesInPackage is actually sandwiches per package
            let sandwichesPossible, leftoverSlices, displayUnit;
            if (ingredientType === 'bread') {
                sandwichesPossible = slicesInPackage; // Bread package makes X sandwiches
                leftoverSlices = 0;
                displayUnit = 'sandwiches';
            } else {
                // Check if package has enough slices for at least one sandwich
                if (slicesInPackage < slicesPerSandwich) {
                    alert(`This package only has ${slicesInPackage} slice(s), but you need ${slicesPerSandwich} slice(s) to make one sandwich. You'll need a larger package or multiple packages.`);
                    return;
                }
                sandwichesPossible = Math.floor(slicesInPackage / slicesPerSandwich);
                leftoverSlices = slicesInPackage % slicesPerSandwich;
                displayUnit = 'slices';
            }
            
            const costPerSandwich = (packagePrice && sandwichesPossible > 0)
                ? (packagePrice / sandwichesPossible).toFixed(2)
                : 'N/A';
            const costPerSlice = packagePrice && ingredientType !== 'bread' ? (packagePrice / slicesInPackage).toFixed(2) : 'N/A';
            const isEstimate = inputMethod === 'oz' && ingredientType !== 'bread';

            // Store data for transfer to wizard
            window.customPackageResult = {
                ingredientType: ingredientType,
                slicesInPackage: slicesInPackage,
                packagePrice: packagePrice,
                sandwichesPossible: sandwichesPossible
            };

            // Display result
            const ingredientLabel = ingredientType === 'meat' ? 'meat' : ingredientType === 'cheese' ? 'cheese' : 'bread';
            const ingredientLabelCap = ingredientType === 'meat' ? 'Meat' : ingredientType === 'cheese' ? 'Cheese' : 'Bread';
            
            document.getElementById('customResult').innerHTML = `
                ${isEstimate ? `
                <div style="background: rgba(251,173,63,0.25); border: 1px solid #FBAD3F; padding: 12px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                    <span style="color: #fff;">📊 Based on estimated <strong>${slicesInPackage} ${displayUnit}</strong> (from oz + thickness)</span>
                </div>
                ` : ''}
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Sandwiches from This Package</h4>
                        <div class="number">${sandwichesPossible}</div>
                        <div class="description">${ingredientType === 'bread' ? 'sandwiches per package' : `at ${slicesPerSandwich} slice${slicesPerSandwich === 1 ? '' : 's'} per sandwich (standard recipe)`}</div>
                    </div>
                    ${ingredientType !== 'bread' ? `
                    <div class="result-item">
                        <h4>Leftover ${displayUnit === 'slices' ? 'Slices' : ''}</h4>
                        <div class="number">${leftoverSlices}</div>
                        <div class="description">${displayUnit} remaining after full sandwiches</div>
                    </div>
                    ` : ''}
                    ${packagePrice ? `
                    <div class="result-item">
                        <h4>Cost Per Sandwich</h4>
                        <div class="number">$${costPerSandwich}</div>
                        <div class="description">${ingredientLabel} cost only</div>
                    </div>
                    ${ingredientType !== 'bread' ? `
                    <div class="result-item">
                        <h4>Cost Per Slice</h4>
                        <div class="number">$${costPerSlice}</div>
                        <div class="description">compare with other products</div>
                    </div>
                    ` : ''}
                    ` : ''}
                </div>
                ${ingredientType !== 'bread' ? `
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 10px;">
                    <h4 style="color: #FBAD3F; margin-bottom: 10px;">Need Multiple Packages?</h4>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 10px;">To make <strong>100 sandwiches</strong> with this product:</p>
                    <div style="font-size: 1.3em; color: #fff; font-weight: 600;">
                        You would need <strong>${Math.ceil((100 * slicesPerSandwich) / slicesInPackage)}</strong> packages
                        ${packagePrice ? `(≈ $${(Math.ceil((100 * slicesPerSandwich) / slicesInPackage) * packagePrice).toFixed(2)} for ${ingredientLabel})` : ''}
                    </div>
                </div>
                ` : ''}
                <div style="margin-top: 20px; padding: 18px; background: rgba(251,173,63,0.3); border: 2px solid #FBAD3F; border-radius: 12px; text-align: center;">
                    <p style="color: #fff; font-weight: 600; margin-bottom: 12px; font-size: 1.05em;">Want to use this in the Full Shopping Builder?</p>
                    <button onclick="transferToWizard('${ingredientType}')" style="padding: 12px 24px; background: #FBAD3F; color: #333; border: none; border-radius: 8px; font-weight: 700; font-size: 1.05em; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        📊 Use This in Full Shopping Builder →
                    </button>
                </div>
            `;
            document.getElementById('customResult').style.display = 'block';
        }

        // Transfer quick calculator result to wizard
        function transferToWizard(ingredientType) {
            if (!window.customPackageResult) {
                alert('Please calculate a package first');
                return;
            }

            const result = window.customPackageResult;
            
            // Pre-populate wizard with Interactive Calculator data if available
            prePopulateWizardFromInteractive();
            
            // Scroll to wizard
            document.querySelector('#custom-calculator .wizard-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Auto-advance to the appropriate step
            if (ingredientType === 'meat') {
                // Go to step 2 (meat)
                if (currentWizardStep !== 2) {
                    // Advance to step 2
                    document.getElementById('wizard-step-1').classList.remove('active');
                    document.getElementById('step-indicator-1').classList.remove('active');
                    document.getElementById('step-indicator-1').classList.add('completed');
                    currentWizardStep = 2;
                    document.getElementById('wizard-step-2').classList.add('active');
                    document.getElementById('step-indicator-2').classList.add('active');
                }
                document.getElementById('wizardMeatSlices').value = result.slicesInPackage;
                document.getElementById('wizardMeatPrice').value = result.packagePrice || '';
                updateWizardStep2();
            } else if (ingredientType === 'cheese') {
                // Go to step 3 (cheese & bread)
                if (currentWizardStep !== 3) {
                    // Advance to step 3
                    if (currentWizardStep === 1) {
                        document.getElementById('wizard-step-1').classList.remove('active');
                        document.getElementById('step-indicator-1').classList.remove('active');
                        document.getElementById('step-indicator-1').classList.add('completed');
                        currentWizardStep = 2;
                        document.getElementById('wizard-step-2').classList.add('active');
                        document.getElementById('step-indicator-2').classList.add('active');
                    }
                    document.getElementById('wizard-step-2').classList.remove('active');
                    document.getElementById('step-indicator-2').classList.remove('active');
                    document.getElementById('step-indicator-2').classList.add('completed');
                    currentWizardStep = 3;
                    document.getElementById('wizard-step-3').classList.add('active');
                    document.getElementById('step-indicator-3').classList.add('active');
                }
                document.getElementById('wizardCheeseSlices').value = result.slicesInPackage;
                document.getElementById('wizardCheesePrice').value = result.packagePrice || '';
                updateWizardStep3();
            } else if (ingredientType === 'bread') {
                // Go to step 3 (cheese & bread)
                if (currentWizardStep !== 3) {
                    // Advance to step 3
                    if (currentWizardStep === 1) {
                        document.getElementById('wizard-step-1').classList.remove('active');
                        document.getElementById('step-indicator-1').classList.remove('active');
                        document.getElementById('step-indicator-1').classList.add('completed');
                        currentWizardStep = 2;
                        document.getElementById('wizard-step-2').classList.add('active');
                        document.getElementById('step-indicator-2').classList.add('active');
                    }
                    document.getElementById('wizard-step-2').classList.remove('active');
                    document.getElementById('step-indicator-2').classList.remove('active');
                    document.getElementById('step-indicator-2').classList.add('completed');
                    currentWizardStep = 3;
                    document.getElementById('wizard-step-3').classList.add('active');
                    document.getElementById('step-indicator-3').classList.add('active');
                }
                document.getElementById('wizardBreadSandwiches').value = result.slicesInPackage; // For bread, this is sandwiches per package
                document.getElementById('wizardBreadPrice').value = result.packagePrice || '';
                updateWizardStep3();
            }
        }

        // Wizard navigation and validation
        let currentWizardStep = 1;
        const totalWizardSteps = 3;

        function updateWizardStep1() {
            const planMode = document.querySelector('input[name="wizardPlanMode"]:checked').value;
            const sandwichCount = document.getElementById('wizardTargetSandwiches').value;
            const budgetAmount = document.getElementById('wizardBudgetAmount').value;
            
            // Show/hide appropriate input
            if (planMode === 'sandwiches') {
                document.getElementById('wizardSandwichCountGroup').style.display = 'flex';
                document.getElementById('wizardBudgetGroup').style.display = 'none';
                document.getElementById('wizard-next-1').disabled = !sandwichCount || parseInt(sandwichCount) <= 0;
            } else {
                document.getElementById('wizardSandwichCountGroup').style.display = 'none';
                document.getElementById('wizardBudgetGroup').style.display = 'flex';
                document.getElementById('wizard-next-1').disabled = !budgetAmount || parseFloat(budgetAmount) <= 0;
            }
        }

        function updateWizardStep2() {
            const meatSlices = document.getElementById('wizardMeatSlices').value;
            const meatPrice = document.getElementById('wizardMeatPrice').value;
            document.getElementById('wizard-next-2').disabled = !meatSlices || parseInt(meatSlices) <= 0 || !meatPrice || parseFloat(meatPrice) <= 0;
        }

        function updateWizardStep3() {
            const cheeseSlices = document.getElementById('wizardCheeseSlices').value;
            const cheesePrice = document.getElementById('wizardCheesePrice').value;
            const breadSandwiches = document.getElementById('wizardBreadSandwiches').value;
            const breadPrice = document.getElementById('wizardBreadPrice').value;
            
            const isValid = cheeseSlices && parseInt(cheeseSlices) > 0 && 
                           cheesePrice && parseFloat(cheesePrice) > 0 &&
                           breadSandwiches && parseInt(breadSandwiches) > 0 &&
                           breadPrice && parseFloat(breadPrice) > 0;
            
            document.getElementById('wizard-calculate').disabled = !isValid;
        }

        function nextWizardStep() {
            if (currentWizardStep < totalWizardSteps) {
                // Hide current step
                document.getElementById(`wizard-step-${currentWizardStep}`).classList.remove('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.remove('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.add('completed');
                
                // Show next step
                currentWizardStep++;
                document.getElementById(`wizard-step-${currentWizardStep}`).classList.add('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.add('active');
            }
        }

        function prevWizardStep() {
            if (currentWizardStep > 1) {
                // Hide current step
                document.getElementById(`wizard-step-${currentWizardStep}`).classList.remove('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.remove('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.remove('completed');
                
                // Show previous step
                currentWizardStep--;
                document.getElementById(`wizard-step-${currentWizardStep}`).classList.add('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.add('active');
                document.getElementById(`step-indicator-${currentWizardStep}`).classList.remove('completed');
            }
        }

        function calculateWizardFullCustom() {
            const bySandwiches = document.getElementById('wizardPlanBySandwiches').checked;
            const meatSlicesPerPkg = parseInt(document.getElementById('wizardMeatSlices').value);
            const meatPricePerPkg = parseFloat(document.getElementById('wizardMeatPrice').value) || 0;
            const cheeseSlicesPerPkg = parseInt(document.getElementById('wizardCheeseSlices').value);
            const cheesePricePerPkg = parseFloat(document.getElementById('wizardCheesePrice').value) || 0;
            const breadSandwichesPerPkg = parseInt(document.getElementById('wizardBreadSandwiches').value);
            const breadPricePerPkg = parseFloat(document.getElementById('wizardBreadPrice').value) || 0;

            // Validate required package info fields
            if (!meatSlicesPerPkg || meatSlicesPerPkg <= 0) {
                alert('Please enter the number of meat slices per package');
                return;
            }
            if (!cheeseSlicesPerPkg || cheeseSlicesPerPkg <= 0) {
                alert('Please enter the number of cheese slices per package');
                return;
            }
            if (!breadSandwichesPerPkg || breadSandwichesPerPkg <= 0) {
                alert('Please enter the number of sandwiches per bread package');
                return;
            }

            // Standard recipe: 3 slices meat, 2 slices cheese per sandwich
            const meatSlicesPerSandwich = 3;
            const cheeseSlicesPerSandwich = 2;
            const bagPrice = 7.99;

            let targetSandwiches;
            let budget = null;

            if (bySandwiches) {
                targetSandwiches = parseInt(document.getElementById('wizardTargetSandwiches').value);
                if (!targetSandwiches || targetSandwiches <= 0) {
                    alert('Please enter a valid target number of sandwiches');
                    return;
                }
            } else {
                // Budget mode
                budget = parseFloat(document.getElementById('wizardBudgetAmount').value);
                if (!budget || budget <= 0) {
                    alert('Please enter a valid budget amount');
                    return;
                }
                // Require prices in budget mode
                if (!meatPricePerPkg || !cheesePricePerPkg || !breadPricePerPkg) {
                    alert('Budget mode requires all package prices to be entered');
                    return;
                }

                // Use binary search to find optimal sandwich count within budget
                let low = 1;
                let high = Math.floor(budget / 0.50); // Assume minimum $0.50 per sandwich
                let bestSandwichCount = 0;

                while (low <= high) {
                    const mid = Math.floor((low + high) / 2);

                    // Calculate packages needed for mid sandwiches
                    const testMeatPkgs = Math.ceil((mid * meatSlicesPerSandwich) / meatSlicesPerPkg);
                    const testCheesePkgs = Math.ceil((mid * cheeseSlicesPerSandwich) / cheeseSlicesPerPkg);
                    const testBreadPkgs = Math.ceil(mid / breadSandwichesPerPkg);
                    const testBagPkgs = Math.ceil(mid / 480);

                    const testCost = Math.round(
                        (testMeatPkgs * meatPricePerPkg) +
                        (testCheesePkgs * cheesePricePerPkg) +
                        (testBreadPkgs * breadPricePerPkg) +
                        (testBagPkgs * bagPrice)
                    );

                    if (testCost <= budget) {
                        bestSandwichCount = mid;
                        low = mid + 1;
                    } else {
                        high = mid - 1;
                    }
                }

                if (bestSandwichCount < 1) {
                    alert('Budget too low for even 1 sandwich with these packages. Try increasing your budget or finding cheaper ingredients.');
                    return;
                }

                targetSandwiches = bestSandwichCount;
            }

            // Calculate packages needed
            const totalMeatSlicesNeeded = targetSandwiches * meatSlicesPerSandwich;
            const totalCheeseSlicesNeeded = targetSandwiches * cheeseSlicesPerSandwich;

            const meatPackagesNeeded = Math.ceil(totalMeatSlicesNeeded / meatSlicesPerPkg);
            const cheesePackagesNeeded = Math.ceil(totalCheeseSlicesNeeded / cheeseSlicesPerPkg);
            const breadPackagesNeeded = Math.ceil(targetSandwiches / breadSandwichesPerPkg);
            const bagPackagesNeeded = Math.ceil(targetSandwiches / 480);

            // Calculate costs
            const meatCost = meatPackagesNeeded * meatPricePerPkg;
            const cheeseCost = cheesePackagesNeeded * cheesePricePerPkg;
            const breadCost = breadPackagesNeeded * breadPricePerPkg;
            const bagCost = bagPackagesNeeded * bagPrice;
            const totalCost = meatCost + cheeseCost + breadCost + bagCost;

            // Calculate extras (leftover slices)
            const meatSlicesProvided = meatPackagesNeeded * meatSlicesPerPkg;
            const cheeseSlicesProvided = cheesePackagesNeeded * cheeseSlicesPerPkg;
            const breadSandwichesProvided = breadPackagesNeeded * breadSandwichesPerPkg;

            const extraMeatSlices = meatSlicesProvided - totalMeatSlicesNeeded;
            const extraCheeseSlices = cheeseSlicesProvided - totalCheeseSlicesNeeded;
            const extraBreadSlots = breadSandwichesProvided - targetSandwiches;

            // Calculate possible extra sandwiches
            const extraFromMeat = Math.floor(extraMeatSlices / meatSlicesPerSandwich);
            const extraFromCheese = Math.floor(extraCheeseSlices / cheeseSlicesPerSandwich);
            const extraFromBread = extraBreadSlots;
            const possibleExtraSandwiches = Math.min(extraFromMeat, extraFromCheese, extraFromBread);
            const totalSandwichesPossible = targetSandwiches + possibleExtraSandwiches;

            // Build budget status message for budget mode
            let budgetStatusMessage = '';
            if (!bySandwiches && budget) {
                const remaining = Math.round((budget - totalCost) * 100) / 100;
                const savingsPercent = Math.round((remaining / budget) * 100);

                let tightBudgetWarning = '';
                if (budget <= 50) {
                    tightBudgetWarning = `
                        <p style="color: #E65100; margin-top: 12px; font-size: 1em; font-weight: 600;">
                            ⚠️ Note: Budgets under $50 are quite tight and yield limited quantities. Consider increasing your budget for better value.
                        </p>
                    `;
                }

                if (remaining > 5) {
                    budgetStatusMessage = `
                        <div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">✅</div>
                            <h4 style="color: #2E7D32; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Optimal Budget Planning!</h4>
                            <p style="color: #1B5E20; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost.toFixed(2)}</strong> |
                                Remaining budget: <strong>$${remaining.toFixed(2)}</strong> (${savingsPercent}% under budget)
                            </p>
                            <p style="color: #2E7D32; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                Maximum sandwiches possible within your $${budget.toFixed(2)} budget with these custom packages.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else if (remaining >= 0) {
                    budgetStatusMessage = `
                        <div style="background: rgba(255,193,63,0.15); border: 3px solid #FFC107; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">💰</div>
                            <h4 style="color: #F57C00; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Budget Optimized!</h4>
                            <p style="color: #E65100; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost.toFixed(2)}</strong> |
                                Remaining: <strong>$${remaining.toFixed(2)}</strong>
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else {
                    budgetStatusMessage = `
                        <div style="background: rgba(244,67,54,0.15); border: 3px solid #F44336; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">⚠️</div>
                            <h4 style="color: #C62828; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Over Budget</h4>
                            <p style="color: #B71C1C; margin: 0; font-size: 1.2em; font-weight: 500;">
                                Cost: <strong>$${totalCost.toFixed(2)}</strong> | Budget: <strong>$${budget.toFixed(2)}</strong> | Over by: <strong>$${Math.abs(remaining).toFixed(2)}</strong>
                            </p>
                        </div>
                    `;
                }
            }

            // Build results display
            const resultHTML = `
                ${budgetStatusMessage}
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Meat Packages</h4>
                        <div class="number">${meatPackagesNeeded}</div>
                        <div class="description">${meatSlicesPerPkg} slices per package</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${meatCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Cheese Packages</h4>
                        <div class="number">${cheesePackagesNeeded}</div>
                        <div class="description">${cheeseSlicesPerPkg} slices per package</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${cheeseCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Bread Packages</h4>
                        <div class="number">${breadPackagesNeeded}</div>
                        <div class="description">${breadSandwichesPerPkg} sandwiches per package</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${breadCost.toFixed(2)}</div>
                    </div>
                    <div class="result-item">
                        <h4>Sandwich Bags</h4>
                        <div class="number">${bagPackagesNeeded}</div>
                        <div class="description">480 count boxes</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${bagCost.toFixed(2)}</div>
                    </div>
                </div>
                <div style="margin-top: 25px; padding: 20px; background: rgba(251,173,63,0.2); border-radius: 12px; text-align: center;">
                    <h4 style="color: #fff; font-size: 1.4em; margin-bottom: 10px;">Total Estimated Cost</h4>
                    <div style="font-size: 3em; font-weight: 700; color: #fff;">$${totalCost.toFixed(2)}</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-top: 8px;">
                        for ${targetSandwiches} sandwiches${possibleExtraSandwiches > 0 ? ` (up to ${totalSandwichesPossible} possible with extras)` : ''}<br>
                        (≈ $${(totalCost / targetSandwiches).toFixed(2)} per sandwich)
                    </div>
                </div>
            `;

            // Show results and hide wizard
            document.getElementById('wizardFullCustomResult').innerHTML = resultHTML;
            document.getElementById('wizardFullCustomResult').style.display = 'block';
            
            // Scroll to results
            document.getElementById('wizardFullCustomResult').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Full Custom Shopping Calculator
        function calculateFullCustom() {
            const bySandwiches = document.getElementById('customPlanBySandwiches').checked;
            const meatSlicesPerPkg = parseInt(document.getElementById('customMeatSlices').value);
            const meatPricePerPkg = parseFloat(document.getElementById('customMeatPrice').value) || 0;
            const cheeseSlicesPerPkg = parseInt(document.getElementById('customCheeseSlices').value);
            const cheesePricePerPkg = parseFloat(document.getElementById('customCheesePrice').value) || 0;
            const breadSandwichesPerPkg = parseInt(document.getElementById('customBreadSandwiches').value);
            const breadPricePerPkg = parseFloat(document.getElementById('customBreadPrice').value) || 0;

            // Validate required package info fields
            if (!meatSlicesPerPkg || meatSlicesPerPkg <= 0) {
                alert('Please enter the number of meat slices per package');
                return;
            }
            if (!cheeseSlicesPerPkg || cheeseSlicesPerPkg <= 0) {
                alert('Please enter the number of cheese slices per package');
                return;
            }
            if (!breadSandwichesPerPkg || breadSandwichesPerPkg <= 0) {
                alert('Please enter the number of sandwiches per bread package');
                return;
            }

            // Standard recipe: 3 slices meat, 2 slices cheese per sandwich
            const meatSlicesPerSandwich = 3;
            const cheeseSlicesPerSandwich = 2;
            const bagPrice = 7.99;

            let targetSandwiches;
            let budget = null;

            if (bySandwiches) {
                targetSandwiches = parseInt(document.getElementById('customTargetSandwiches').value);
                if (!targetSandwiches || targetSandwiches <= 0) {
                    alert('Please enter a valid target number of sandwiches');
                    return;
                }
            } else {
                // Budget mode
                budget = parseFloat(document.getElementById('customBudgetAmount').value);
                if (!budget || budget <= 0) {
                    alert('Please enter a valid budget amount');
                    return;
                }
                // Require prices in budget mode
                if (!meatPricePerPkg || !cheesePricePerPkg || !breadPricePerPkg) {
                    alert('Budget mode requires all package prices to be entered');
                    return;
                }

                // Use binary search to find optimal sandwich count within budget
                let low = 1;
                let high = Math.floor(budget / 0.50); // Assume minimum $0.50 per sandwich
                let bestSandwichCount = 0;

                while (low <= high) {
                    const mid = Math.floor((low + high) / 2);

                    // Calculate packages needed for mid sandwiches
                    const testMeatPkgs = Math.ceil((mid * meatSlicesPerSandwich) / meatSlicesPerPkg);
                    const testCheesePkgs = Math.ceil((mid * cheeseSlicesPerSandwich) / cheeseSlicesPerPkg);
                    const testBreadPkgs = Math.ceil(mid / breadSandwichesPerPkg);
                    const testBagPkgs = Math.ceil(mid / 480);

                    const testCost = Math.round(
                        (testMeatPkgs * meatPricePerPkg) +
                        (testCheesePkgs * cheesePricePerPkg) +
                        (testBreadPkgs * breadPricePerPkg) +
                        (testBagPkgs * bagPrice)
                    );

                    if (testCost <= budget) {
                        bestSandwichCount = mid;
                        low = mid + 1;
                    } else {
                        high = mid - 1;
                    }
                }

                if (bestSandwichCount < 1) {
                    alert('Budget too low for even 1 sandwich with these packages. Try increasing your budget or finding cheaper ingredients.');
                    return;
                }

                targetSandwiches = bestSandwichCount;
            }

            // Calculate packages needed
            const totalMeatSlicesNeeded = targetSandwiches * meatSlicesPerSandwich;
            const totalCheeseSlicesNeeded = targetSandwiches * cheeseSlicesPerSandwich;

            const meatPackagesNeeded = Math.ceil(totalMeatSlicesNeeded / meatSlicesPerPkg);
            const cheesePackagesNeeded = Math.ceil(totalCheeseSlicesNeeded / cheeseSlicesPerPkg);
            const breadPackagesNeeded = Math.ceil(targetSandwiches / breadSandwichesPerPkg);
            const bagPackagesNeeded = Math.ceil(targetSandwiches / 480);

            // Calculate costs
            const meatCost = meatPackagesNeeded * meatPricePerPkg;
            const cheeseCost = cheesePackagesNeeded * cheesePricePerPkg;
            const breadCost = breadPackagesNeeded * breadPricePerPkg;
            const bagCost = bagPackagesNeeded * bagPrice;
            const totalCost = meatCost + cheeseCost + breadCost + bagCost;

            // Calculate extras (leftover slices)
            const meatSlicesProvided = meatPackagesNeeded * meatSlicesPerPkg;
            const cheeseSlicesProvided = cheesePackagesNeeded * cheeseSlicesPerPkg;
            const breadSandwichesProvided = breadPackagesNeeded * breadSandwichesPerPkg;

            const extraMeatSlices = meatSlicesProvided - totalMeatSlicesNeeded;
            const extraCheeseSlices = cheeseSlicesProvided - totalCheeseSlicesNeeded;
            const extraBreadSlots = breadSandwichesProvided - targetSandwiches;

            // Calculate possible extra sandwiches
            const extraFromMeat = Math.floor(extraMeatSlices / meatSlicesPerSandwich);
            const extraFromCheese = Math.floor(extraCheeseSlices / cheeseSlicesPerSandwich);
            const extraFromBread = extraBreadSlots;
            const possibleExtraSandwiches = Math.min(extraFromMeat, extraFromCheese, extraFromBread);
            const totalSandwichesPossible = targetSandwiches + possibleExtraSandwiches;

            // Build budget status message for budget mode
            let budgetStatusMessage = '';
            if (!bySandwiches && budget) {
                const remaining = Math.round((budget - totalCost) * 100) / 100;
                const savingsPercent = Math.round((remaining / budget) * 100);

                let tightBudgetWarning = '';
                if (budget <= 50) {
                    tightBudgetWarning = `
                        <p style="color: #E65100; margin-top: 12px; font-size: 1em; font-weight: 600;">
                            ⚠️ Note: Budgets under $50 are quite tight and yield limited quantities. Consider increasing your budget for better value.
                        </p>
                    `;
                }

                if (remaining > 5) {
                    budgetStatusMessage = `
                        <div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">✅</div>
                            <h4 style="color: #2E7D32; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Optimal Budget Planning!</h4>
                            <p style="color: #1B5E20; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost.toFixed(2)}</strong> |
                                Remaining budget: <strong>$${remaining.toFixed(2)}</strong> (${savingsPercent}% under budget)
                            </p>
                            <p style="color: #2E7D32; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                Maximum sandwiches possible within your $${budget.toFixed(2)} budget with these custom packages.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else if (remaining > 0) {
                    budgetStatusMessage = `
                        <div style="background: rgba(255,152,0,0.2); border: 3px solid #FF9800; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">⚠️</div>
                            <h4 style="color: #E65100; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Budget Optimized!</h4>
                            <p style="color: #BF360C; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for <strong>$${totalCost.toFixed(2)}</strong> |
                                Only <strong>$${remaining.toFixed(2)}</strong> remaining
                            </p>
                            <p style="color: #E65100; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                This maximizes your sandwich count within your $${budget.toFixed(2)} budget.
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                } else {
                    budgetStatusMessage = `
                        <div style="background: rgba(76,175,80,0.15); border: 3px solid #4CAF50; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 12px;">🎯</div>
                            <h4 style="color: #2E7D32; margin-bottom: 12px; font-size: 1.4em; font-weight: 700;">Perfect Budget Match!</h4>
                            <p style="color: #1B5E20; margin: 0; font-size: 1.2em; font-weight: 500;">
                                <strong>${totalSandwichesPossible} sandwiches</strong> for exactly <strong>$${totalCost.toFixed(2)}</strong>
                            </p>
                            <p style="color: #2E7D32; font-size: 1em; margin: 12px 0 0 0; font-weight: 400;">
                                This is the maximum number of sandwiches you can make with your selected ingredients and $${budget.toFixed(2)} budget (uses your entire budget).
                            </p>
                            ${tightBudgetWarning}
                        </div>
                    `;
                }
            }

            // Display results
            document.getElementById('fullCustomResult').innerHTML = `
                ${budgetStatusMessage}
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Meat Packages</h4>
                        <div class="number">${meatPackagesNeeded}</div>
                        <div class="description">${meatSlicesPerPkg} slices each<br>(${extraMeatSlices} extra slices)</div>
                        ${meatPricePerPkg ? `<div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${meatCost.toFixed(2)}</div>` : ''}
                    </div>
                    <div class="result-item">
                        <h4>Cheese Packages</h4>
                        <div class="number">${cheesePackagesNeeded}</div>
                        <div class="description">${cheeseSlicesPerPkg} slices each<br>(${extraCheeseSlices} extra slices)</div>
                        ${cheesePricePerPkg ? `<div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${cheeseCost.toFixed(2)}</div>` : ''}
                    </div>
                    <div class="result-item">
                        <h4>Bread Packages</h4>
                        <div class="number">${breadPackagesNeeded}</div>
                        <div class="description">${breadSandwichesPerPkg} sandwiches each<br>(${extraBreadSlots} extra spots)</div>
                        ${breadPricePerPkg ? `<div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${breadCost.toFixed(2)}</div>` : ''}
                    </div>
                    <div class="result-item">
                        <h4>Sandwich Bags</h4>
                        <div class="number">${bagPackagesNeeded}</div>
                        <div class="description">480-count boxes</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: rgba(255,255,255,0.95);">$${bagCost.toFixed(2)}</div>
                    </div>
                </div>
                ${(meatPricePerPkg || cheesePricePerPkg || breadPricePerPkg) && bySandwiches ? `
                <div style="margin-top: 25px; padding: 20px; background: rgba(251,173,63,0.2); border-radius: 12px; text-align: center;">
                    <h4 style="color: #fff; font-size: 1.4em; margin-bottom: 10px;">Total Estimated Cost</h4>
                    <div style="font-size: 3em; font-weight: 700; color: #fff;">$${totalCost.toFixed(2)}</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-top: 8px;">
                        for ${targetSandwiches} sandwiches<br>
                        (≈ $${(totalCost / targetSandwiches).toFixed(2)} per sandwich)
                    </div>
                </div>
                ` : ''}
                ${possibleExtraSandwiches > 0 && bySandwiches ? `
                <div style="margin-top: 15px; padding: 15px; background: rgba(76,175,80,0.2); border-radius: 10px; text-align: center;">
                    <p style="color: #fff; font-size: 1.1em; margin: 0;">
                        <strong>Bonus:</strong> You'll have enough leftover ingredients to make <strong>${possibleExtraSandwiches}</strong> extra sandwiches!
                    </p>
                </div>
                ` : ''}
            `;
            document.getElementById('fullCustomResult').style.display = 'block';
        }

    </script>
</div>
</body>
</html>

